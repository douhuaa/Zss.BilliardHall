{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/douhuaa/Zss.BilliardHall/schemas/api-responses.json",
  "title": "API 响应格式架构 (API Response Schema)",
  "description": "定义所有 API 响应的标准格式和结构",
  
  "definitions": {
    "ApiResponse": {
      "type": "object",
      "properties": {
        "success": {
          "type": "boolean",
          "description": "请求是否成功"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "响应时间戳"
        },
        "requestId": {
          "type": "string",
          "format": "uuid",
          "description": "请求追踪ID"
        },
        "version": {
          "type": "string",
          "pattern": "^v\\d+(\\.\\d+)*$",
          "description": "API 版本"
        }
      },
      "required": ["success", "timestamp", "requestId"]
    },
    
    "SuccessResponse": {
      "allOf": [
        { "$ref": "#/definitions/ApiResponse" },
        {
          "type": "object",
          "properties": {
            "success": { "const": true },
            "data": {
              "description": "响应数据"
            },
            "message": {
              "type": "string",
              "description": "成功消息"
            }
          },
          "required": ["data"]
        }
      ]
    },
    
    "ErrorResponse": {
      "allOf": [
        { "$ref": "#/definitions/ApiResponse" },
        {
          "type": "object",
          "properties": {
            "success": { "const": false },
            "error": {
              "$ref": "#/definitions/ErrorDetails"
            }
          },
          "required": ["error"]
        }
      ]
    },
    
    "ErrorDetails": {
      "type": "object",
      "properties": {
        "code": {
          "type": "string",
          "enum": [
            "VALIDATION_ERROR",
            "NOT_FOUND",
            "UNAUTHORIZED",
            "FORBIDDEN", 
            "CONFLICT",
            "BUSINESS_RULE_VIOLATION",
            "INTERNAL_SERVER_ERROR",
            "SERVICE_UNAVAILABLE",
            "RATE_LIMIT_EXCEEDED"
          ],
          "description": "错误代码"
        },
        "message": {
          "type": "string",
          "description": "错误消息"
        },
        "details": {
          "type": "object",
          "description": "错误详细信息"
        },
        "field": {
          "type": "string",
          "description": "相关字段(验证错误时)"
        },
        "stackTrace": {
          "type": "string",
          "description": "堆栈跟踪(仅开发环境)"
        }
      },
      "required": ["code", "message"]
    },
    
    "PagedResponse": {
      "allOf": [
        { "$ref": "#/definitions/SuccessResponse" },
        {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "properties": {
                "items": {
                  "type": "array",
                  "description": "数据项列表"
                },
                "pagination": {
                  "$ref": "#/definitions/PaginationInfo"
                }
              },
              "required": ["items", "pagination"]
            }
          }
        }
      ]
    },
    
    "PaginationInfo": {
      "type": "object",
      "properties": {
        "currentPage": {
          "type": "integer",
          "minimum": 1,
          "description": "当前页码"
        },
        "pageSize": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "每页大小"
        },
        "totalItems": {
          "type": "integer",
          "minimum": 0,
          "description": "总记录数"
        },
        "totalPages": {
          "type": "integer",
          "minimum": 0,
          "description": "总页数"
        },
        "hasNext": {
          "type": "boolean",
          "description": "是否有下一页"
        },
        "hasPrevious": {
          "type": "boolean",
          "description": "是否有上一页"
        }
      },
      "required": ["currentPage", "pageSize", "totalItems", "totalPages", "hasNext", "hasPrevious"]
    },
    
    "ValidationErrorResponse": {
      "allOf": [
        { "$ref": "#/definitions/ErrorResponse" },
        {
          "type": "object",
          "properties": {
            "error": {
              "type": "object",
              "properties": {
                "code": { "const": "VALIDATION_ERROR" },
                "message": { "const": "输入数据验证失败" },
                "details": {
                  "type": "object",
                  "properties": {
                    "fieldErrors": {
                      "type": "array",
                      "items": {
                        "$ref": "#/definitions/FieldError"
                      }
                    }
                  },
                  "required": ["fieldErrors"]
                }
              }
            }
          }
        }
      ]
    },
    
    "FieldError": {
      "type": "object",
      "properties": {
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "value": {
          "description": "字段值"
        },
        "message": {
          "type": "string",
          "description": "错误消息"
        },
        "code": {
          "type": "string",
          "enum": [
            "REQUIRED",
            "INVALID_FORMAT",
            "OUT_OF_RANGE",
            "TOO_SHORT",
            "TOO_LONG",
            "DUPLICATE",
            "INVALID_REFERENCE"
          ],
          "description": "错误类型"
        }
      },
      "required": ["field", "message", "code"]
    },
    
    "BilliardTableResponse": {
      "allOf": [
        { "$ref": "#/definitions/SuccessResponse" },
        {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "properties": {
                "id": { "type": "string", "format": "uuid" },
                "number": { "type": "integer" },
                "type": { "type": "string" },
                "status": { "type": "string" },
                "hourlyRate": {
                  "type": "object",
                  "properties": {
                    "amount": { "type": "number" },
                    "currency": { "type": "string" }
                  }
                },
                "location": {
                  "type": "object",
                  "properties": {
                    "x": { "type": "number" },
                    "y": { "type": "number" },
                    "floor": { "type": "integer" },
                    "zone": { "type": "string" }
                  }
                },
                "features": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "createdAt": { "type": "string", "format": "date-time" },
                "updatedAt": { "type": "string", "format": "date-time" }
              }
            }
          }
        }
      ]
    },
    
    "BilliardTableListResponse": {
      "allOf": [
        { "$ref": "#/definitions/PagedResponse" },
        {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "properties": {
                "items": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": { "type": "string", "format": "uuid" },
                      "number": { "type": "integer" },
                      "type": { "type": "string" },
                      "status": { "type": "string" },
                      "hourlyRate": {
                        "type": "object",
                        "properties": {
                          "amount": { "type": "number" },
                          "currency": { "type": "string" }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      ]
    },
    
    "ReservationResponse": {
      "allOf": [
        { "$ref": "#/definitions/SuccessResponse" },
        {
          "type": "object",
          "properties": {
            "data": {
              "type": "object",
              "properties": {
                "id": { "type": "string", "format": "uuid" },
                "customerId": { "type": "string", "format": "uuid" },
                "tableId": { "type": "string", "format": "uuid" },
                "startTime": { "type": "string", "format": "date-time" },
                "endTime": { "type": "string", "format": "date-time" },
                "duration": { "type": "integer" },
                "totalAmount": {
                  "type": "object",
                  "properties": {
                    "amount": { "type": "number" },
                    "currency": { "type": "string" }
                  }
                },
                "status": { "type": "string" },
                "paymentStatus": { "type": "string" },
                "table": {
                  "type": "object",
                  "properties": {
                    "number": { "type": "integer" },
                    "type": { "type": "string" }
                  }
                },
                "customer": {
                  "type": "object", 
                  "properties": {
                    "name": { "type": "string" },
                    "membershipNumber": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      ]
    }
  },
  
  "examples": {
    "successfulTableCreation": {
      "success": true,
      "timestamp": "2023-12-01T10:30:00Z",
      "requestId": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
      "version": "v1.0",
      "data": {
        "id": "123e4567-e89b-12d3-a456-426614174000",
        "number": 5,
        "type": "Chinese8Ball",
        "status": "Available",
        "hourlyRate": {
          "amount": 35.00,
          "currency": "CNY"
        },
        "location": {
          "x": 10.5,
          "y": 5.2,
          "floor": 1,
          "zone": "A"
        },
        "features": ["LED_Lighting", "Ball_Return_System"],
        "createdAt": "2023-12-01T10:30:00Z",
        "updatedAt": "2023-12-01T10:30:00Z"
      },
      "message": "台球桌创建成功"
    },
    
    "validationError": {
      "success": false,
      "timestamp": "2023-12-01T10:35:00Z",
      "requestId": "f47ac10b-58cc-4372-a567-0e02b2c3d480",
      "version": "v1.0",
      "error": {
        "code": "VALIDATION_ERROR",
        "message": "输入数据验证失败",
        "details": {
          "fieldErrors": [
            {
              "field": "number",
              "value": -1,
              "message": "台球桌编号必须大于0",
              "code": "OUT_OF_RANGE"
            },
            {
              "field": "hourlyRate.amount",
              "value": null,
              "message": "小时费率不能为空",
              "code": "REQUIRED"
            }
          ]
        }
      }
    }
  }
}