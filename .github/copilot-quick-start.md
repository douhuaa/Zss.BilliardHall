# Copilot å¿«é€Ÿå¼€å§‹æŒ‡å—

> **5åˆ†é’Ÿå­¦ä¼šä½¿ç”¨ Copilot æ¨¡æ¿ç”Ÿæˆä»£ç **

---

## å¿«é€Ÿæ­¥éª¤

### 1. åˆ›å»ºä¸€ä¸ªæ–°åŠŸèƒ½ï¼ˆæœ€å¸¸ç”¨ï¼‰

**åœºæ™¯**: æˆ‘è¦åˆ›å»ºä¸€ä¸ª"æš‚åœå°çƒæ¡Œä¼šè¯"çš„åŠŸèƒ½

**æ­¥éª¤**:

1. åœ¨ `Modules/Sessions/` ä¸‹åˆ›å»º `PauseSession` æ–‡ä»¶å¤¹
2. åˆ›å»º `PauseSession.cs` æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹æ³¨é‡Šï¼š

```csharp
// åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å‚ç›´åˆ‡ç‰‡åŠŸèƒ½ï¼šæš‚åœå°çƒæ¡Œä¼šè¯
// æ¨¡å—ï¼šSessions
// åŠŸèƒ½ï¼šPauseSession
// Command å‚æ•°ï¼šGuid sessionId, string? reason
// ä¸šåŠ¡é€»è¾‘ï¼š
//   1. åŠ è½½ TableSession èšåˆæ ¹
//   2. éªŒè¯ä¼šè¯çŠ¶æ€å¿…é¡»æ˜¯ Active
//   3. æš‚åœä¼šè¯ï¼Œè®°å½•æš‚åœæ—¶é—´
//   4. è¿”å› Result<Unit> å’Œ SessionPaused äº‹ä»¶
// Handler ä½¿ç”¨ [Transactional]
// Endpoint ä½¿ç”¨ WolverinePutï¼Œè·¯å¾„ /api/sessions/{sessionId}/pause
// æ·»åŠ  FluentValidation éªŒè¯å™¨
```

3. æŒ‰ `Tab` æˆ– `Enter`ï¼ŒCopilot ä¼šè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ä»£ç 
4. æ£€æŸ¥å¹¶è°ƒæ•´ç”Ÿæˆçš„ä»£ç 

### 2. åªéœ€è¦ Handlerï¼ˆå·²æœ‰ Commandï¼‰

**åœºæ™¯**: Command å·²ç»å®šä¹‰å¥½äº†ï¼Œåªéœ€è¦å®ç° Handler

åœ¨ `{Feature}Handler.cs` æ–‡ä»¶ä¸­è¾“å…¥ï¼š

```csharp
// åˆ›å»º PauseSession å‘½ä»¤çš„ Handler
// ä½¿ç”¨ [Transactional] ç‰¹æ€§
// æ³¨å…¥ IDocumentSessionã€ILogger
// ä¸šåŠ¡é€»è¾‘ï¼š
//   1. åŠ è½½ TableSession
//   2. æ£€æŸ¥çŠ¶æ€æ˜¯å¦ä¸º Active
//   3. è°ƒç”¨ session.Pause()
//   4. è¿”å› Result å’Œ SessionPaused äº‹ä»¶
```

### 3. æ·»åŠ æŸ¥è¯¢åŠŸèƒ½

**åœºæ™¯**: æŸ¥è¯¢ä¼šè¯è¯¦æƒ…

åœ¨ `GetSession.cs` æ–‡ä»¶ä¸­è¾“å…¥ï¼š

```csharp
// åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢åŠŸèƒ½ï¼šè·å–ä¼šè¯è¯¦æƒ…
// Queryï¼šGetSessionï¼Œå‚æ•° Guid sessionId
// Handlerï¼šä½¿ç”¨ Marten LoadAsync
// è¿”å›ï¼šSessionDtoï¼ˆåŒ…å« Id, TableId, MemberId, StartTime, Status, TotalAmountï¼‰
// Endpointï¼šGET /api/sessions/{sessionId}
```

### 4. æ·»åŠ äº‹ä»¶å¤„ç†å™¨

**åœºæ™¯**: ç›‘å¬ SessionPaused äº‹ä»¶ï¼Œè®°å½•å®¡è®¡æ—¥å¿—

åœ¨ `Handlers/SessionPausedHandler.cs` æ–‡ä»¶ä¸­è¾“å…¥ï¼š

```csharp
// åˆ›å»ºäº‹ä»¶å¤„ç†å™¨ï¼šç›‘å¬ SessionPaused äº‹ä»¶
// åŠŸèƒ½ï¼šè®°å½•ä¼šè¯æš‚åœçš„å®¡è®¡æ—¥å¿—
// Handler æ³¨å…¥ IAuditLogService å’Œ ILogger
// è®°å½•ï¼šSessionId, PausedAt, Reason
```

---

## å¸¸è§åœºæ™¯é€ŸæŸ¥

### åœºæ™¯ 1: åˆ›å»ºå®Œæ•´åŠŸèƒ½åˆ‡ç‰‡

```
// åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å‚ç›´åˆ‡ç‰‡åŠŸèƒ½ï¼š{åŠŸèƒ½æè¿°}
// æ¨¡å—ï¼š{æ¨¡å—å}
// åŠŸèƒ½ï¼š{åŠŸèƒ½å}
// åŒ…å«ï¼šCommandã€Handlerã€Endpointã€Validator
// ä½¿ç”¨ Wolverine + Marten + FluentValidation
// Handler ä½¿ç”¨ [Transactional] ç‰¹æ€§
// è¿”å› Result<{è¿”å›ç±»å‹}> å’Œçº§è”äº‹ä»¶ {äº‹ä»¶å}
// Endpoint ä½¿ç”¨ {HTTPæ–¹æ³•}ï¼Œè·¯å¾„ {è·¯å¾„}
```

### åœºæ™¯ 2: åªåˆ›å»º Command

```
// åˆ›å»ºä¸€ä¸ª Command record ç±»å‹
// åŠŸèƒ½ï¼š{åŠŸèƒ½æè¿°}
// å‘½ä»¤åï¼š{CommandName}
// å‚æ•°ï¼š{å‚æ•°åˆ—è¡¨}
// å‘½åç©ºé—´ï¼šZss.BilliardHall.Modules.{Module}.{Feature}
// æ·»åŠ  XML æ³¨é‡Šï¼ˆä¸­è‹±æ–‡ï¼‰
```

### åœºæ™¯ 3: åªåˆ›å»º Handler

```
// åˆ›å»ºä¸€ä¸ª Wolverine Handler
// åŠŸèƒ½ï¼šå¤„ç† {CommandName} å‘½ä»¤
// ä½¿ç”¨ [Transactional] ç‰¹æ€§
// æ³¨å…¥ {ä¾èµ–åˆ—è¡¨}
// ä¸šåŠ¡é€»è¾‘ï¼š
//   {æ­¥éª¤åˆ—è¡¨}
// è¿”å› Result<{ç±»å‹}> å’Œ {äº‹ä»¶å} äº‹ä»¶
```

### åœºæ™¯ 4: åˆ›å»ºæŸ¥è¯¢

```
// åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢åŠŸèƒ½
// åŠŸèƒ½ï¼š{æŸ¥è¯¢æè¿°}
// Queryï¼š{QueryName}ï¼Œå‚æ•°ï¼š{å‚æ•°åˆ—è¡¨}
// Handlerï¼šä½¿ç”¨ Marten {æŸ¥è¯¢æ–¹æ³•}
// è¿”å›ï¼š{DTOç±»å‹}
// Endpointï¼š{HTTPæ–¹æ³•} {è·¯å¾„}
```

### åœºæ™¯ 5: åˆ›å»ºäº‹ä»¶

```
// åˆ›å»ºä¸€ä¸ªé¢†åŸŸäº‹ä»¶ record
// äº‹ä»¶åï¼š{EventName}
// å‚æ•°ï¼š{å‚æ•°åˆ—è¡¨}
// å‘½åç©ºé—´ï¼šZss.BilliardHall.Modules.{Module}.Events
// æ·»åŠ  XML æ³¨é‡Šï¼ˆä¸­è‹±æ–‡ï¼‰
```

### åœºæ™¯ 6: åˆ›å»ºèšåˆæ ¹

```
// åˆ›å»ºä¸€ä¸ªèšåˆæ ¹å®ä½“
// å®ä½“åï¼š{EntityName}
// å±æ€§ï¼š{å±æ€§åˆ—è¡¨}
// ä¸šåŠ¡æ–¹æ³•ï¼š{æ–¹æ³•åˆ—è¡¨}
// å‘½åç©ºé—´ï¼šZss.BilliardHall.Modules.{Module}
```

### åœºæ™¯ 7: åˆ›å»ºæµ‹è¯•

```
// åˆ›å»ºä¸€ä¸ª xUnit æµ‹è¯•ç±»
// æµ‹è¯•ç›®æ ‡ï¼š{HandlerName}
// ä½¿ç”¨ In-Memory Marten å­˜å‚¨
// æµ‹è¯•ç”¨ä¾‹ï¼š{ç”¨ä¾‹åˆ—è¡¨}
// ä½¿ç”¨ FluentAssertions è¿›è¡Œæ–­è¨€
```

---

## æç¤ºè¯æ¨¡æ¿å˜é‡è¯´æ˜

ä½¿ç”¨æ¨¡æ¿æ—¶ï¼Œæ›¿æ¢ä»¥ä¸‹å ä½ç¬¦ï¼š

| å ä½ç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `{åŠŸèƒ½æè¿°}` | åŠŸèƒ½çš„ä¸­æ–‡æè¿° | "æš‚åœå°çƒæ¡Œä¼šè¯" |
| `{æ¨¡å—å}` | æ¨¡å—åç§°ï¼ˆPascalCaseï¼‰ | "Sessions", "Members", "Tables" |
| `{åŠŸèƒ½å}` | åŠŸèƒ½åç§°ï¼ˆPascalCaseï¼‰ | "PauseSession", "RegisterMember" |
| `{CommandName}` | Command ç±»å | "PauseSession", "TopUpBalance" |
| `{QueryName}` | Query ç±»å | "GetSession", "ListMembers" |
| `{EventName}` | Event ç±»å | "SessionPaused", "MemberRegistered" |
| `{HandlerName}` | Handler ç±»å | "PauseSessionHandler" |
| `{EntityName}` | å®ä½“ç±»å | "Table", "Member", "Session" |
| `{å‚æ•°åˆ—è¡¨}` | å‚æ•°åˆ—è¡¨ | "Guid sessionId, string? reason" |
| `{è¿”å›ç±»å‹}` | è¿”å›å€¼ç±»å‹ | "Guid", "Unit", "SessionDto" |
| `{HTTPæ–¹æ³•}` | HTTP æ–¹æ³• | "WolverinePost", "WolverineGet", "WolverinePut" |
| `{è·¯å¾„}` | API è·¯å¾„ | "/api/sessions/{sessionId}/pause" |
| `{ä¾èµ–åˆ—è¡¨}` | æ³¨å…¥çš„ä¾èµ– | "IDocumentSession, IMessageBus, ILogger" |
| `{æ­¥éª¤åˆ—è¡¨}` | ä¸šåŠ¡å¤„ç†æ­¥éª¤ | ç”¨ç¼©è¿›åˆ—è¡¨æè¿°æ­¥éª¤ |

---

## æç¤ºï¼šå¦‚ä½•å†™å¥½ Copilot æŒ‡ä»¤

### âœ… å¥½çš„æŒ‡ä»¤ï¼ˆå…·ä½“ã€ç»“æ„åŒ–ï¼‰

```
// åˆ›å»ºä¸€ä¸ª Command record
// å‘½ä»¤åï¼šCancelOrder
// å‚æ•°ï¼šGuid orderId, string reason
// éªŒè¯ï¼šreason ä¸èƒ½ä¸ºç©ºä¸”ä¸è¶…è¿‡200å­—ç¬¦
// å‘½åç©ºé—´ï¼šZss.BilliardHall.Modules.Orders.CancelOrder
```

### âŒ ä¸å¥½çš„æŒ‡ä»¤ï¼ˆæ¨¡ç³Šã€ç¼ºå°‘ä¸Šä¸‹æ–‡ï¼‰

```
// åˆ›å»ºä¸€ä¸ªå–æ¶ˆè®¢å•çš„åŠŸèƒ½
```

### å…³é”®è¦ç´ 

1. **æ˜ç¡®ç±»å‹**: Command / Query / Handler / Event
2. **æŒ‡å®šå‘½åç©ºé—´**: è®© Copilot çŸ¥é“æ–‡ä»¶ä½ç½®
3. **åˆ—å‡ºå‚æ•°**: å®Œæ•´çš„å‚æ•°åˆ—è¡¨å’Œç±»å‹
4. **æè¿°é€»è¾‘**: å…³é”®ä¸šåŠ¡æ­¥éª¤ï¼ˆä¸éœ€è¦å¤ªè¯¦ç»†ï¼‰
5. **æŒ‡å®šæ¡†æ¶ç‰¹æ€§**: `[Transactional]`, `[WolverinePost]` ç­‰

---

## å·¥ä½œæµå»ºè®®

### æ¨èå·¥ä½œæµç¨‹

1. **å…ˆå®šä¹‰ Command/Query** â†’ ä½¿ç”¨æ¨¡æ¿ç”ŸæˆåŸºæœ¬ç»“æ„
2. **å†å®ç° Handler** â†’ ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæ¡†æ¶ï¼Œæ‰‹åŠ¨è¡¥å……ä¸šåŠ¡é€»è¾‘
3. **æ·»åŠ  Endpoint** â†’ ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆ HTTP æ˜ å°„
4. **æ·»åŠ  Validator** â†’ ä½¿ç”¨æ¨¡æ¿ç”ŸæˆéªŒè¯è§„åˆ™
5. **å®šä¹‰ Eventï¼ˆå¦‚éœ€è¦ï¼‰** â†’ ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆäº‹ä»¶å®šä¹‰
6. **ç¼–å†™æµ‹è¯•** â†’ ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæµ‹è¯•æ¡†æ¶

### æé«˜æ•ˆç‡çš„æŠ€å·§

- âœ… ä¸€æ¬¡åªç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œé€æ­¥æ„å»º
- âœ… ç”Ÿæˆåç«‹å³æ£€æŸ¥ï¼Œç¡®è®¤ç¬¦åˆé¢„æœŸ
- âœ… å…ˆç”Ÿæˆæ¡†æ¶ä»£ç ï¼Œå†æ‰‹åŠ¨è¡¥å……æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- âœ… å¤ç”¨ç›¸ä¼¼åŠŸèƒ½çš„æç¤ºè¯
- âŒ ä¸è¦ä¸€æ¬¡æ€§ç”Ÿæˆæ•´ä¸ªæ¨¡å—
- âŒ ä¸è¦ç›²ç›®ä¿¡ä»»ç”Ÿæˆçš„ä»£ç 

---

## å¸¸è§é—®é¢˜

### Q1: Copilot ç”Ÿæˆçš„ä»£ç ä¸ç¬¦åˆé¡¹ç›®è§„èŒƒæ€ä¹ˆåŠï¼Ÿ

**A**: åœ¨æç¤ºè¯ä¸­æ˜ç¡®æŒ‡å®šï¼š
- ä½¿ç”¨ `[Transactional]` ç‰¹æ€§
- è¿”å› `Result<T>` ç±»å‹
- ä½¿ç”¨çº§è”æ¶ˆæ¯ï¼ˆtuple è¿”å›å€¼ï¼‰
- å‘½åç©ºé—´éµå¾ª `Zss.BilliardHall.Modules.{Module}.{Feature}` æ ¼å¼

### Q2: å¦‚ä½•è®© Copilot ç”Ÿæˆç¬¦åˆå‚ç›´åˆ‡ç‰‡æ¶æ„çš„ä»£ç ï¼Ÿ

**A**: åœ¨æç¤ºè¯ä¸­å¼ºè°ƒï¼š
- "åˆ›å»ºå®Œæ•´çš„å‚ç›´åˆ‡ç‰‡åŠŸèƒ½"
- "åŒ…å« Commandã€Handlerã€Endpointã€Validator"
- "ä¸è¦åˆ›å»º Service æˆ– Repository æ¥å£"

### Q3: ç”Ÿæˆçš„ Handler å¤ªç®€å•ï¼Œç¼ºå°‘ä¸šåŠ¡é€»è¾‘ï¼Ÿ

**A**: è¿™æ˜¯æ­£å¸¸çš„ã€‚Copilot åªèƒ½ç”Ÿæˆæ¡†æ¶ä»£ç ï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘éœ€è¦æ‰‹åŠ¨å®ç°ã€‚
å»ºè®®åœ¨æç¤ºè¯ä¸­åˆ—å‡ºå…³é”®ä¸šåŠ¡æ­¥éª¤ï¼Œè®© Copilot ç”Ÿæˆæ³¨é‡Šæ¡†æ¶ã€‚

### Q4: å¦‚ä½•ç”Ÿæˆä¸ç°æœ‰ä»£ç é£æ ¼ä¸€è‡´çš„ä»£ç ï¼Ÿ

**A**: 
1. åœ¨å½“å‰æ–‡ä»¶ä¸Šä¸‹æ–‡ä¸­æä¾›ç¤ºä¾‹ä»£ç 
2. å‚è€ƒé¡¹ç›®ä¸­å·²æœ‰çš„ç±»ä¼¼åŠŸèƒ½
3. åœ¨æç¤ºè¯ä¸­å¼•ç”¨ç°æœ‰ä»£ç ï¼š"å‚è€ƒ RegisterMember çš„å®ç°æ–¹å¼"

---

## æ›´å¤šèµ„æº

- ğŸ“– [å®Œæ•´æ¨¡æ¿æ–‡æ¡£](./.github/copilot-templates.md) - è¯¦ç»†çš„æ¨¡æ¿å’Œç¤ºä¾‹
- ğŸ“– [Copilot æŒ‡ä»¤è¯´æ˜](./.github/copilot-instructions.md) - é¡¹ç›®æ¶æ„è§„èŒƒ
- ğŸ“– [Wolverine å¿«é€Ÿä¸Šæ‰‹æŒ‡å—](../docs/03_ç³»ç»Ÿæ¶æ„è®¾è®¡/Wolverineå¿«é€Ÿä¸Šæ‰‹æŒ‡å—.md) - æ¡†æ¶ä½¿ç”¨æŒ‡å—
- ğŸ“– [Wolverine æ¨¡å—åŒ–æ¶æ„è“å›¾](../docs/03_ç³»ç»Ÿæ¶æ„è®¾è®¡/Wolverineæ¨¡å—åŒ–æ¶æ„è“å›¾.md) - å®Œæ•´æ¶æ„æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2026-01-13  
**æç¤º**: ç†Ÿç»ƒä½¿ç”¨è¿™äº›æ¨¡æ¿åï¼Œä½ çš„å¼€å‘æ•ˆç‡å°†æå‡ 3-5 å€ï¼
