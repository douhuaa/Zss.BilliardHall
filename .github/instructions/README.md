# GitHub Copilot 指令

本目录包含基于角色的 GitHub Copilot 指令，以确保与项目架构治理保持一致的行为。

## 目的

这些指令文件定义了**Copilot 在此仓库中的个性和行为边界**。它们回答："你是什么样的助手？"

这与 `docs/copilot/` 不同，后者包含**详细的工作手册**，回答："你如何帮助完成特定任务？"

## 结构

```
.github/instructions/
  ├─ base.instructions.md                 ← 核心行为（始终激活）
  ├─ backend.instructions.md              ← 后端开发
  ├─ testing.instructions.md              ← 测试编写
  ├─ documentation.instructions.md        ← 文档编写
  └─ architecture-review.instructions.md  ← PR 评审（最高风险）
```

## 工作原理

### 基础指令（始终激活）

`base.instructions.md` 建立 Copilot 的基本行为：
- 尊重 ADR 作为宪法级法律
- 将架构测试视为硬性约束
- 绝不发明规则或绕过 CI
- 放大理解能力，不替代理解

### 角色特定指令（根据上下文）

根据你的工作内容应用额外指令：

| 工作内容... | 额外指令 |
|---------------|------------------------|
| Handler、用例、领域模型 | `backend.instructions.md` |
| 单元测试、集成测试 | `testing.instructions.md` |
| ADR、指南、Prompt | `documentation.instructions.md` |
| PR 评审、架构评估 | `architecture-review.instructions.md` |

## 与 docs/copilot/ 的关系

这两个系统协同工作但目的不同：

| `.github/instructions/` | `docs/copilot/` |
|------------------------|-----------------|
| Copilot **是谁** | Copilot **如何**工作 |
| 个性与边界 | 具体程序 |
| 行为约束 | 详细场景 |
| 绝不做什么 | 何时做什么 |
| 很少变更 | 随经验演进 |

### 示例

**基础指令说**：
> "绝不引入跨模块依赖"

**Copilot Prompt（docs/copilot/adr-0001.prompts.md）说**：
> "当开发者想访问另一个模块时：
> - ✅ 使用领域事件：`await _eventBus.Publish(...)`
> - ✅ 使用契约：`await _queryBus.Send(...)`
> - ✅ 使用原始类型：`Guid memberId`
> - ❌ 不要使用直接引用"

## 何时更新

### 更新基础指令的时机：
- 项目采用新架构原则
- 基本约束发生变化
- 出现新的"绝不做这个"规则

### 更新角色特定指令的时机：
- 某个模式变得足够常见需要正式化
- 角色边界需要澄清
- 风险等级发生变化

### 不要更新的情况：
- 具体示例（放入 `docs/copilot/`）
- 临时例外
- 个别用例

## 三层架构治理

```
┌─────────────────────────────────────────────────┐
│ 第 1 层：ADR（docs/adr/）                        │
│ - 宪法级法律                                     │
│ - 架构决策记录                                   │
│ - 最高权威                                       │
└─────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────┐
│ 第 2 层：指令（.github/instructions/）          │
│ - Copilot 的个性                                 │
│ - 行为边界                                       │
│ - "我是什么样的助手？"                           │
└─────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────┐
│ 第 3 层：Prompt（docs/copilot/）                │
│ - 详细工作手册                                   │
│ - 场景特定指导                                   │
│ - "我如何处理情况 X？"                           │
└─────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────┐
│ 执行：ArchitectureTests                          │
│ - 自动化验证                                     │
│ - CI/CD 门禁                                     │
│ - 不可协商                                       │
└─────────────────────────────────────────────────┘
```

## 使用指南

### 对于开发者

与 Copilot 交互时：
1. Copilot 将自动遵循这些指令
2. 如果需要具体帮助，参考相关的 `docs/copilot/` 文件
3. 如果 Copilot 显得过于谨慎，这是有意为之——它在保护架构

### 对于维护者

更新指令时：
1. 确保所有文件之间的一致性
2. 更新版本号和日期
3. 测试变更不与现有 ADR 冲突
4. 在 PR 中记录重大变更

## 关键原则

> **Copilot 放大理解能力，不替代理解**

这些指令确保 Copilot：
- ✅ 帮助你更快理解 ADR
- ✅ 更早捕获违规
- ✅ 建议合规解决方案
- ❌ 不让你绕过学习
- ❌ 不替代人工判断
- ❌ 不覆盖架构测试

## 快速参考

| 场景 | 查看文件 |
|----------|------------|
| "我能在模块中做 X 吗？" | `backend.instructions.md` |
| "我应该如何测试这个？" | `testing.instructions.md` |
| "我应该如何记录这个？" | `documentation.instructions.md` |
| "这个 PR 架构上合理吗？" | `architecture-review.instructions.md` |
| "核心规则是什么？" | `base.instructions.md` |

对于详细的"如何做"指导，始终参考 `docs/copilot/` 文件。

## 版本

当前版本：1.0
最后更新：2026-01-21

对这些指令的更改应该是罕见且深思熟虑的，因为它们定义了 Copilot 在此仓库中的基本行为。
