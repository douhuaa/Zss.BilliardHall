---
title: "ä¼šå‘˜ç®¡ç†æ¨¡å—"
description: "è‡ªåŠ©å°çƒç³»ç»Ÿä¼šå‘˜ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡è¯´æ˜"
version: "2.0.0"
author: "ä¸šåŠ¡æ¶æ„å¸ˆ"
maintainer: "åç«¯å¼€å‘å›¢é˜Ÿ"
created: "2024-01-01"
updated: "2024-01-15"
category: "æ¨¡å—è®¾è®¡"
level: "æ ¸å¿ƒ"
audience: ["åç«¯å¼€å‘å·¥ç¨‹å¸ˆ", "ä¸šåŠ¡åˆ†æå¸ˆ"]
keywords: ["ä¼šå‘˜ç®¡ç†", "ç”¨æˆ·ç³»ç»Ÿ", "ç§¯åˆ†ä½“ç³»", "ç­‰çº§ç®¡ç†", "Wolverine", "å‚ç›´åˆ‡ç‰‡"]
tags: ["member", "user", "points", "authentication", "vertical-slice"]
dependencies: ["ç”¨æˆ·è®¤è¯", "æ•°æ®åº“è®¾è®¡"]
estimated_reading_time: "15åˆ†é’Ÿ"
architecture_status: "æ¶æ„å®ç°å·²æ›´æ–°è‡³ Wolverine"
---

# 4.1 ä¼šå‘˜ç®¡ç†æ¨¡å—ï¼ˆMembersï¼‰

<!-- Breadcrumb Navigation -->
**å¯¼èˆªè·¯å¾„**: [ğŸ  é¡¹ç›®æ–‡æ¡£](../è‡ªåŠ©å°çƒç³»ç»Ÿé¡¹ç›®æ–‡æ¡£.md) > [ğŸ“¦ æ¨¡å—è®¾è®¡](README.md) > ğŸƒ ä¼šå‘˜ç®¡ç†æ¨¡å—

<!-- Keywords for Search -->
**å…³é”®è¯**: `ä¼šå‘˜ç®¡ç†` `ç”¨æˆ·ç³»ç»Ÿ` `ç§¯åˆ†ä½“ç³»` `ç­‰çº§ç®¡ç†` `Wolverine` `å‚ç›´åˆ‡ç‰‡`

---

> ## âš ï¸ æ¶æ„å®ç°è¯´æ˜
> 
> æœ¬æ–‡æ¡£æè¿°ä¼šå‘˜ç®¡ç†æ¨¡å—çš„**ä¸šåŠ¡éœ€æ±‚å’ŒåŠŸèƒ½è¯´æ˜**ã€‚
> 
> **æ¶æ„å®ç°å·²è¿ç§»è‡³ Wolverine + å‚ç›´åˆ‡ç‰‡æ¶æ„**ã€‚ä¸‹æ–‡ä¸­çš„æ¶æ„å›¾å’Œä»£ç ç¤ºä¾‹ä½¿ç”¨æ—§çš„ ABP åˆ†å±‚æ¶æ„æœ¯è¯­ä½œä¸ºä¸šåŠ¡ç†è§£å‚è€ƒã€‚
> 
> ### ğŸ“š å®é™…æ¶æ„å®ç°è¯·å‚è€ƒï¼š
> 
> 1. **[Wolverineæ¨¡å—åŒ–æ¶æ„è“å›¾](../03_ç³»ç»Ÿæ¶æ„è®¾è®¡/Wolverineæ¨¡å—åŒ–æ¶æ„è“å›¾.md)** â­â­â­
>    - æŸ¥çœ‹ Members æ¨¡å—çš„å®Œæ•´å‚ç›´åˆ‡ç‰‡å®ç°æ–¹å¼
> 
> 2. **[ç³»ç»Ÿæ¨¡å—åˆ’åˆ† - Members æ¨¡å—](../03_ç³»ç»Ÿæ¶æ„è®¾è®¡/ç³»ç»Ÿæ¨¡å—åˆ’åˆ†.md#7-members-æ¨¡å—ä¼šå‘˜ä½“ç³»)** â­â­
>    - Members æ¨¡å—çš„åŠŸèƒ½åˆ‡ç‰‡ã€é¢†åŸŸæ¨¡å‹ã€äº‹ä»¶å®šä¹‰
> 
> 3. **[Wolverineå¿«é€Ÿä¸Šæ‰‹æŒ‡å—](../03_ç³»ç»Ÿæ¶æ„è®¾è®¡/Wolverineå¿«é€Ÿä¸Šæ‰‹æŒ‡å—.md)** â­â­â­
>    - å¦‚ä½•å®ç°ä¼šå‘˜ç›¸å…³åŠŸèƒ½ï¼ˆRegisterMemberã€TopUpBalance ç­‰ï¼‰
> 
> ### ğŸ”„ æ¶æ„å˜æ›´è¦ç‚¹ï¼š
> 
> | æ—§æ¶æ„ï¼ˆæœ¬æ–‡æ¡£ï¼‰ | æ–°æ¶æ„ï¼ˆWolverineï¼‰ | è¯´æ˜ |
> |----------------|-------------------|------|
> | åº”ç”¨æœåŠ¡å±‚ (Application) | Handler | Handler å³åº”ç”¨æœåŠ¡ |
> | é¢†åŸŸæœåŠ¡å±‚ (Domain Service) | Handler å†…è”æˆ–å…±äº« Domain Service | æŒ‰éœ€å†³å®š |
> | ä»“å‚¨ (Repository) | IDocumentSession (Marten) | ç›´æ¥ä½¿ç”¨ Marten ä¼šè¯ |
> | `IUserAppService` | `RegisterMemberHandler` ç­‰ | æŒ‰åŠŸèƒ½åˆ‡ç‰‡ç»„ç»‡ |
> | `UserController` | `RegisterMemberEndpoint` | Wolverine HTTP ç«¯ç‚¹ |
> 
> ### ğŸ“ æ–°æ¶æ„ç›®å½•ç»“æ„ï¼š
> 
> ```
> src/Modules/Members/
> â”œâ”€â”€ RegisterMember/
> â”‚   â”œâ”€â”€ RegisterMember.cs          # Command
> â”‚   â”œâ”€â”€ RegisterMemberHandler.cs   # Handler
> â”‚   â”œâ”€â”€ RegisterMemberEndpoint.cs  # HTTP ç«¯ç‚¹
> â”‚   â””â”€â”€ RegisterMemberValidator.cs # éªŒè¯å™¨
> â”œâ”€â”€ TopUpBalance/
> â”‚   â”œâ”€â”€ TopUpBalance.cs
> â”‚   â””â”€â”€ TopUpBalanceHandler.cs
> â”œâ”€â”€ UpdateMemberProfile/
> â”œâ”€â”€ GetMember/
> â”œâ”€â”€ Events/
> â”‚   â”œâ”€â”€ MemberRegistered.cs
> â”‚   â””â”€â”€ BalanceToppedUp.cs
> â””â”€â”€ Member.cs                      # èšåˆæ ¹
> ```

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

ä¼šå‘˜ç®¡ç†æ¨¡å—æ˜¯è‡ªåŠ©å°çƒç³»ç»Ÿçš„æ ¸å¿ƒç”¨æˆ·æ¨¡å—ï¼Œè´Ÿè´£ç”¨æˆ·çš„æ³¨å†Œç™»å½•ã€ä¼šå‘˜ç­‰çº§ç®¡ç†ã€ç§¯åˆ†ç´¯è®¡æ¶ˆè´¹ã€ç”¨æˆ·ç”»åƒåˆ†æç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—ä¸ºå…¶ä»–ä¸šåŠ¡æ¨¡å—æä¾›ç»Ÿä¸€çš„ç”¨æˆ·èº«ä»½è®¤è¯å’Œæƒé™ç®¡ç†æœåŠ¡ã€‚

### æ ¸å¿ƒèŒè´£

- ğŸ” **ç”¨æˆ·èº«ä»½ç®¡ç†**: æ³¨å†Œã€ç™»å½•ã€è®¤è¯æˆæƒ
- ğŸ† **ä¼šå‘˜ç­‰çº§ä½“ç³»**: ç­‰çº§åˆ’åˆ†ã€æƒç›Šç®¡ç†ã€å‡çº§è§„åˆ™
- ğŸ¯ **ç§¯åˆ†ç³»ç»Ÿ**: ç§¯åˆ†è·å–ã€æ¶ˆè´¹ã€å…‘æ¢ç®¡ç†
- ğŸ‘¥ **ç”¨æˆ·ç”»åƒ**: è¡Œä¸ºåˆ†æã€åå¥½ç»Ÿè®¡ã€ç²¾å‡†è¥é”€
- ğŸ“± **å¤šç«¯è´¦æˆ·**: æ”¯æŒWebã€ç§»åŠ¨ç«¯ã€å°ç¨‹åºç»Ÿä¸€è´¦æˆ·

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ¨¡å—æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ä¼šå‘˜ç®¡ç†æ¨¡å—"
        subgraph "åº”ç”¨æœåŠ¡å±‚"
            AS1[ç”¨æˆ·æœåŠ¡]
            AS2[ä¼šå‘˜æœåŠ¡]
            AS3[ç§¯åˆ†æœåŠ¡]
            AS4[æƒé™æœåŠ¡]
        end
        
        subgraph "é¢†åŸŸæœåŠ¡å±‚"
            DS1[ç”¨æˆ·é¢†åŸŸæœåŠ¡]
            DS2[ç­‰çº§è®¡ç®—æœåŠ¡]
            DS3[ç§¯åˆ†è§„åˆ™æœåŠ¡]
        end
        
        subgraph "é¢†åŸŸæ¨¡å‹å±‚"
            E1[ç”¨æˆ·å®ä½“]
            E2[ä¼šå‘˜å®ä½“]
            E3[ç§¯åˆ†è®°å½•å®ä½“]
            VO1[ä¼šå‘˜ç­‰çº§å€¼å¯¹è±¡]
        end
        
        subgraph "åŸºç¡€è®¾æ–½å±‚"
            R1[ç”¨æˆ·ä»“å‚¨]
            R2[ä¼šå‘˜ä»“å‚¨]
            R3[ç§¯åˆ†ä»“å‚¨]
            C1[ç¼“å­˜æœåŠ¡]
        end
    end
    
    AS1 --> DS1
    AS2 --> DS2
    AS3 --> DS3
    AS4 --> DS1
    
    DS1 --> E1
    DS2 --> E2
    DS2 --> VO1
    DS3 --> E3
    
    E1 --> R1
    E2 --> R2
    E3 --> R3
    
    R1 --> C1
    R2 --> C1
```

### ä¸šåŠ¡æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant A as è®¤è¯æœåŠ¡
    participant M as ä¼šå‘˜æœåŠ¡
    participant P as ç§¯åˆ†æœåŠ¡
    participant D as æ•°æ®åº“
    
    U->>A: æ³¨å†Œ/ç™»å½•è¯·æ±‚
    A->>D: éªŒè¯ç”¨æˆ·ä¿¡æ¯
    D-->>A: è¿”å›ç”¨æˆ·æ•°æ®
    A->>M: è·å–ä¼šå‘˜ä¿¡æ¯
    M->>D: æŸ¥è¯¢ä¼šå‘˜ç­‰çº§
    D-->>M: è¿”å›ç­‰çº§ä¿¡æ¯
    M-->>A: è¿”å›ä¼šå‘˜çŠ¶æ€
    A-->>U: è¿”å›è®¤è¯ç»“æœ
    
    Note over U,P: ç§¯åˆ†æ“ä½œæµç¨‹
    U->>P: æ¶ˆè´¹ç§¯åˆ†
    P->>M: æ£€æŸ¥ä¼šå‘˜æƒç›Š
    M-->>P: ç¡®è®¤æƒç›ŠçŠ¶æ€
    P->>D: æ›´æ–°ç§¯åˆ†è®°å½•
    P->>M: æ£€æŸ¥ç­‰çº§å˜æ›´
    M->>D: æ›´æ–°ä¼šå‘˜ç­‰çº§
    P-->>U: è¿”å›æ“ä½œç»“æœ
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒå®ä½“

#### ç”¨æˆ·å®ä½“ (User)

```csharp
public class User : AuditedAggregateRoot<Guid>
{
    public string UserName { get; set; }
    public string Email { get; set; }
    public string PhoneNumber { get; set; }
    public string NickName { get; set; }
    public string Avatar { get; set; }
    public UserStatus Status { get; set; }
    public DateTime? LastLoginTime { get; set; }
    public string LastLoginIp { get; set; }
    
    // å¯¼èˆªå±æ€§
    public Member Member { get; set; }
    public ICollection<UserRole> UserRoles { get; set; }
}

public enum UserStatus
{
    Active = 1,      // æ¿€æ´»
    Inactive = 0,    // æœªæ¿€æ´»
    Suspended = -1   // åœç”¨
}
```

#### ä¼šå‘˜å®ä½“ (Member)

```csharp
public class Member : AuditedEntity<Guid>
{
    public Guid UserId { get; set; }
    public MemberLevel Level { get; set; }
    public int Points { get; set; }
    public decimal Balance { get; set; }
    public DateTime JoinDate { get; set; }
    public DateTime? ExpireDate { get; set; }
    public int TotalConsumption { get; set; }
    public int TotalPlayTime { get; set; }
    
    // å¯¼èˆªå±æ€§
    public User User { get; set; }
    public ICollection<PointsRecord> PointsRecords { get; set; }
}

public enum MemberLevel
{
    Bronze = 1,   // é“œç‰Œä¼šå‘˜
    Silver = 2,   // é“¶ç‰Œä¼šå‘˜
    Gold = 3,     // é‡‘ç‰Œä¼šå‘˜
    Platinum = 4, // ç™½é‡‘ä¼šå‘˜
    Diamond = 5   // é’»çŸ³ä¼šå‘˜
}
```

#### ç§¯åˆ†è®°å½•å®ä½“ (PointsRecord)

```csharp
public class PointsRecord : CreationAuditedEntity<Guid>
{
    public Guid MemberId { get; set; }
    public PointsType Type { get; set; }
    public int Points { get; set; }
    public string Description { get; set; }
    public string RelatedOrderId { get; set; }
    public DateTime ExpireDate { get; set; }
    
    // å¯¼èˆªå±æ€§
    public Member Member { get; set; }
}

public enum PointsType
{
    Earned = 1,    // è·å¾—
    Consumed = 2,  // æ¶ˆè´¹
    Expired = 3,   // è¿‡æœŸ
    Gift = 4       // èµ é€
}
```

### å®ä½“å…³ç³»å›¾

```mermaid
erDiagram
    User ||--|| Member : has
    Member ||--o{ PointsRecord : has
    User ||--o{ UserRole : has
    Role ||--o{ UserRole : belongs
    
    User {
        guid Id PK
        string UserName
        string Email
        string PhoneNumber
        string NickName
        string Avatar
        int Status
        datetime LastLoginTime
    }
    
    Member {
        guid Id PK
        guid UserId FK
        int Level
        int Points
        decimal Balance
        datetime JoinDate
        datetime ExpireDate
        int TotalConsumption
    }
    
    PointsRecord {
        guid Id PK
        guid MemberId FK
        int Type
        int Points
        string Description
        datetime ExpireDate
    }
```

---

## ğŸ”§ æ¥å£è®¾è®¡

### ç”¨æˆ·ç®¡ç†æ¥å£

```csharp
public interface IUserAppService : IApplicationService
{
    Task<UserDto> RegisterAsync(RegisterDto input);
    Task<LoginResultDto> LoginAsync(LoginDto input);
    Task<UserDto> GetCurrentUserAsync();
    Task<UserDto> UpdateProfileAsync(UpdateUserDto input);
    Task ChangePasswordAsync(ChangePasswordDto input);
    Task SendVerificationCodeAsync(string phoneNumber);
    Task ResetPasswordAsync(ResetPasswordDto input);
}
```

### ä¼šå‘˜ç®¡ç†æ¥å£

```csharp
public interface IMemberAppService : IApplicationService
{
    Task<MemberDto> GetMemberInfoAsync(Guid userId);
    Task<MemberDto> UpgradeMemberLevelAsync(Guid memberId);
    Task<List<MemberBenefitDto>> GetMemberBenefitsAsync(MemberLevel level);
    Task<MemberStatisticsDto> GetMemberStatisticsAsync(Guid memberId);
    Task<PagedResultDto<MemberDto>> GetMemberListAsync(GetMemberListDto input);
}
```

### ç§¯åˆ†ç®¡ç†æ¥å£

```csharp
public interface IPointsAppService : IApplicationService
{
    Task<int> GetPointsBalanceAsync(Guid memberId);
    Task<PointsRecordDto> AddPointsAsync(AddPointsDto input);
    Task<PointsRecordDto> ConsumePointsAsync(ConsumePointsDto input);
    Task<PagedResultDto<PointsRecordDto>> GetPointsHistoryAsync(GetPointsHistoryDto input);
    Task<List<PointsRuleDto>> GetPointsRulesAsync();
}
```

---

## ğŸ“‹ ä¸šåŠ¡è§„åˆ™

### ä¼šå‘˜ç­‰çº§è§„åˆ™

| ç­‰çº§ | æ¡ä»¶ | æƒç›Š |
|------|------|------|
| é“œç‰Œ | æ–°ç”¨æˆ·é»˜è®¤ | åŸºç¡€æŠ˜æ‰£5% |
| é“¶ç‰Œ | æ¶ˆè´¹æ»¡500å…ƒ | æŠ˜æ‰£8%ï¼Œç”Ÿæ—¥ä¼˜æƒ åˆ¸ |
| é‡‘ç‰Œ | æ¶ˆè´¹æ»¡2000å…ƒ | æŠ˜æ‰£10%ï¼Œå…è´¹æ—¶é•¿30åˆ†é’Ÿ/æœˆ |
| ç™½é‡‘ | æ¶ˆè´¹æ»¡5000å…ƒ | æŠ˜æ‰£12%ï¼Œå…è´¹æ—¶é•¿60åˆ†é’Ÿ/æœˆ |
| é’»çŸ³ | æ¶ˆè´¹æ»¡10000å…ƒ | æŠ˜æ‰£15%ï¼Œå…è´¹æ—¶é•¿120åˆ†é’Ÿ/æœˆ |

### ç§¯åˆ†è§„åˆ™

**è·å–è§„åˆ™**:
- ğŸ’° æ¶ˆè´¹1å…ƒè·å¾—1ç§¯åˆ†
- ğŸ‚ ç”Ÿæ—¥å½“å¤©é¢å¤–100ç§¯åˆ†
- ğŸ“ å®Œæˆè¯„ä»·è·å¾—10ç§¯åˆ†
- ğŸ‘¥ é‚€è¯·å¥½å‹æ³¨å†Œè·å¾—50ç§¯åˆ†

**æ¶ˆè´¹è§„åˆ™**:
- ğŸ’µ 100ç§¯åˆ† = 1å…ƒç°é‡‘
- â° 500ç§¯åˆ† = å…è´¹æ¸¸æˆ1å°æ—¶
- ğŸ 1000ç§¯åˆ† = ä¸“å±ç¤¼å“å…‘æ¢
- ğŸ† ç§¯åˆ†æœ‰æ•ˆæœŸä¸ºè·å¾—å12ä¸ªæœˆ

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

```csharp
// ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ï¼ˆ30åˆ†é’Ÿï¼‰
[CachePut(CacheNames.User, "{userId}", Duration = 1800)]
public async Task<UserDto> GetUserAsync(Guid userId)

// ä¼šå‘˜ç­‰çº§ç¼“å­˜ï¼ˆ1å°æ—¶ï¼‰
[CachePut(CacheNames.MemberLevel, "{memberId}", Duration = 3600)]
public async Task<MemberLevel> GetMemberLevelAsync(Guid memberId)

// ç§¯åˆ†ä½™é¢ç¼“å­˜ï¼ˆ10åˆ†é’Ÿï¼‰
[CachePut(CacheNames.Points, "{memberId}", Duration = 600)]
public async Task<int> GetPointsBalanceAsync(Guid memberId)
```

### æ€§èƒ½æŒ‡æ ‡

- ğŸ‘¤ ç”¨æˆ·ç™»å½•å“åº”æ—¶é—´ < 200ms
- ğŸ” ä¼šå‘˜ä¿¡æ¯æŸ¥è¯¢ < 100ms
- ğŸ“Š ç§¯åˆ†è®¡ç®—å¤„ç† < 50ms
- ğŸ“ˆ å¹¶å‘ç”¨æˆ·æ”¯æŒ > 10000

---

## ğŸ”’ å®‰å…¨æ§åˆ¶

### æƒé™è®¾è®¡

```csharp
public static class MemberPermissions
{
    public const string Default = GroupName + ".Default";
    public const string ViewProfile = GroupName + ".ViewProfile";
    public const string EditProfile = GroupName + ".EditProfile";
    public const string ManagePoints = GroupName + ".ManagePoints";
    public const string ViewStatistics = GroupName + ".ViewStatistics";
}
```

### æ•°æ®ä¿æŠ¤

- ğŸ” å¯†ç ä½¿ç”¨BCryptåŠ å¯†å­˜å‚¨
- ğŸ›¡ï¸ æ•æ„Ÿä¿¡æ¯ï¼ˆæ‰‹æœºå·ã€é‚®ç®±ï¼‰è„±æ•æ˜¾ç¤º
- ğŸš« APIæ¥å£å®ç°é¢‘ç‡é™åˆ¶
- ğŸ“± çŸ­ä¿¡éªŒè¯ç 5åˆ†é’Ÿæœ‰æ•ˆæœŸ

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### ä¸šåŠ¡æŒ‡æ ‡

- ğŸ‘¥ æ—¥æ´»è·ƒç”¨æˆ·æ•° (DAU)
- ğŸ“Š ä¼šå‘˜æ³¨å†Œè½¬åŒ–ç‡
- ğŸ’° ä¼šå‘˜æ¶ˆè´¹é¢‘æ¬¡
- ğŸ¯ ç§¯åˆ†ä½¿ç”¨ç‡

### æŠ€æœ¯æŒ‡æ ‡

- âš¡ æ¥å£å¹³å‡å“åº”æ—¶é—´
- ğŸ”„ ç¼“å­˜å‘½ä¸­ç‡
- âŒ é”™è¯¯ç‡ç»Ÿè®¡
- ğŸ“Š å¹¶å‘è¿æ¥æ•°

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **ä¸Šçº§æ–‡æ¡£**: [æ¨¡å—è®¾è®¡æ€»è§ˆ](README.md)
- **å…³è”æ–‡æ¡£**: [æ”¯ä»˜æ¨¡å—](æ”¯ä»˜æ¨¡å—.md) | [å°çƒæ¡Œè®¡è´¹æ¨¡å—](å°çƒæ¡Œè®¡è´¹æ¨¡å—.md)
- **æŠ€æœ¯æ–‡æ¡£**: [ç”¨æˆ·è®¤è¯è®¾è®¡](../07_APIæ–‡æ¡£/è®¤è¯æˆæƒ.md)
- **è¿”å›**: [é¡¹ç›®æ–‡æ¡£é¦–é¡µ](../è‡ªåŠ©å°çƒç³»ç»Ÿé¡¹ç›®æ–‡æ¡£.md)

---

*æœ€åæ›´æ–°: 2024-01-15 | ç‰ˆæœ¬: v1.0.0*
