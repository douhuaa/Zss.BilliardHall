---
title: "æŠ¥è¡¨ä¸ç»Ÿè®¡æ¨¡å—"
description: "è‡ªåŠ©å°çƒç³»ç»ŸæŠ¥è¡¨ä¸ç»Ÿè®¡æ¨¡å—è¯¦ç»†è®¾è®¡è¯´æ˜"
version: "2.0.0"
author: "æ•°æ®åˆ†æå¸ˆ"
maintainer: "åç«¯å¼€å‘å›¢é˜Ÿ"
created: "2024-01-01"
updated: "2024-01-15"
category: "æ¨¡å—è®¾è®¡"
level: "é‡è¦"
audience: ["åç«¯å¼€å‘å·¥ç¨‹å¸ˆ", "æ•°æ®åˆ†æå¸ˆ", "äº§å“ç»ç†"]
keywords: ["æŠ¥è¡¨ç»Ÿè®¡", "æ•°æ®åˆ†æ", "ä¸šåŠ¡æŒ‡æ ‡", "å¯è§†åŒ–", "Wolverine", "å‚ç›´åˆ‡ç‰‡"]
tags: ["report", "analytics", "statistics", "visualization", "vertical-slice"]
dependencies: ["æ‰€æœ‰ä¸šåŠ¡æ¨¡å—"]
estimated_reading_time: "12åˆ†é’Ÿ"
architecture_status: "æ¶æ„å®ç°å·²æ›´æ–°è‡³ Wolverine"
---

# 4.5 æŠ¥è¡¨ä¸ç»Ÿè®¡æ¨¡å—ï¼ˆReportsï¼‰

<!-- Breadcrumb Navigation -->
**å¯¼èˆªè·¯å¾„**: [ğŸ  é¡¹ç›®æ–‡æ¡£](../è‡ªåŠ©å°çƒç³»ç»Ÿé¡¹ç›®æ–‡æ¡£.md) > [ğŸ“¦ æ¨¡å—è®¾è®¡](README.md) > ğŸ“Š æŠ¥è¡¨ä¸ç»Ÿè®¡æ¨¡å—

<!-- Keywords for Search -->
**å…³é”®è¯**: `æŠ¥è¡¨ç»Ÿè®¡` `æ•°æ®åˆ†æ` `ä¸šåŠ¡æŒ‡æ ‡` `å¯è§†åŒ–` `Wolverine` `å‚ç›´åˆ‡ç‰‡`

---

> ## âš ï¸ æ¶æ„å®ç°è¯´æ˜
> 
> æœ¬æ–‡æ¡£æè¿°æŠ¥è¡¨ä¸ç»Ÿè®¡æ¨¡å—çš„**ä¸šåŠ¡éœ€æ±‚å’ŒåŠŸèƒ½è¯´æ˜**ã€‚
> 
> **æ¶æ„å®ç°å·²è¿ç§»è‡³ Wolverine + å‚ç›´åˆ‡ç‰‡æ¶æ„**ã€‚ä¸‹æ–‡ä¸­çš„æ¶æ„å›¾å’Œä»£ç ç¤ºä¾‹ä½¿ç”¨æ—§çš„ ABP åˆ†å±‚æ¶æ„æœ¯è¯­ä½œä¸ºä¸šåŠ¡ç†è§£å‚è€ƒã€‚
> 
> ### ğŸ“š å®é™…æ¶æ„å®ç°è¯·å‚è€ƒï¼š
> 
> 1. **[Wolverineæ¨¡å—åŒ–æ¶æ„è“å›¾](../03_ç³»ç»Ÿæ¶æ„è®¾è®¡/Wolverineæ¨¡å—åŒ–æ¶æ„è“å›¾.md)** â­â­â­
>    - æŸ¥çœ‹ Reports æ¨¡å—çš„å®Œæ•´å‚ç›´åˆ‡ç‰‡å®ç°æ–¹å¼ï¼ˆå®šæ—¶ä»»åŠ¡ã€æ•°æ®èšåˆï¼‰
> 
> 2. **[Wolverineæ¡†æ¶ä»‹ç» - 2.5èŠ‚ åå°ä»»åŠ¡](../03_ç³»ç»Ÿæ¶æ„è®¾è®¡/Wolverineæ¡†æ¶ä»‹ç».md#25-åå°ä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡)** â­â­
>    - ä½¿ç”¨ Wolverine å®šæ—¶ä»»åŠ¡ç”ŸæˆæŠ¥è¡¨
> 
> 3. **[Martenæ•°æ®è®¿é—®](../03_ç³»ç»Ÿæ¶æ„è®¾è®¡/Martenæ•°æ®è®¿é—®.md)** â­â­
>    - ä½¿ç”¨ Marten è¿›è¡Œå¤æ‚æ•°æ®æŸ¥è¯¢å’Œèšåˆ
> 
> ### ğŸ“ æ–°æ¶æ„ç›®å½•ç»“æ„ï¼š
> 
> ```
> src/Modules/Reports/
> â”œâ”€â”€ GenerateDailyReport/
> â”‚   â”œâ”€â”€ GenerateDailyReport.cs
> â”‚   â”œâ”€â”€ GenerateDailyReportHandler.cs
> â”‚   â””â”€â”€ DailyReportScheduledJob.cs  # å®šæ—¶ä»»åŠ¡
> â”œâ”€â”€ GetRevenueStatistics/
> â”‚   â”œâ”€â”€ GetRevenueStatistics.cs
> â”‚   â”œâ”€â”€ GetRevenueStatisticsHandler.cs
> â”‚   â””â”€â”€ GetRevenueStatisticsEndpoint.cs
> â”œâ”€â”€ GetMemberStatistics/
> â”œâ”€â”€ GetTableUsageStatistics/
> â””â”€â”€ DailyReport.cs                   # æŠ¥è¡¨èšåˆæ ¹
> ```
> 
> ### ğŸ”„ æ¶æ„å˜æ›´è¦ç‚¹ï¼š
> 
> | æ—§æ¶æ„ï¼ˆæœ¬æ–‡æ¡£ï¼‰ | æ–°æ¶æ„ï¼ˆWolverineï¼‰ | è¯´æ˜ |
> |----------------|-------------------|------|
> | æŠ¥è¡¨æœåŠ¡ (ReportAppService) | GenerateDailyReportHandler | æŒ‰åŠŸèƒ½åˆ‡ç‰‡ |
> | å®šæ—¶ä»»åŠ¡ (Background Job) | Wolverine Scheduled Job | æ¡†æ¶çº§æ”¯æŒ |
> | æ•°æ®èšåˆæŸ¥è¯¢ | Marten SQL æŸ¥è¯¢ | ä½¿ç”¨ PostgreSQL èšåˆèƒ½åŠ› |
> | ä»“å‚¨ (Repository) | IDocumentSession (Marten) | ç›´æ¥ä½¿ç”¨ Marten |
> 
> ### ğŸ’¡ å®šæ—¶ä»»åŠ¡ç¤ºä¾‹ï¼š
> 
> ```csharp
> // æ¯å¤©å‡Œæ™¨ 1 ç‚¹ç”Ÿæˆæ—¥æŠ¥
> [Schedule("0 1 * * *")]  // Cron è¡¨è¾¾å¼
> public static async Task GenerateDailyReportJob(
>     IDocumentSession session,
>     ILogger<GenerateDailyReportHandler> logger)
> {
>     // ç”Ÿæˆæ˜¨æ—¥æŠ¥è¡¨
>     var yesterday = DateOnly.FromDateTime(DateTime.UtcNow.AddDays(-1));
>     await session.InvokeAsync(new GenerateDailyReport(yesterday));
> }
> ```

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

æŠ¥è¡¨ä¸ç»Ÿè®¡æ¨¡å—ä¸ºè‡ªåŠ©å°çƒç³»ç»Ÿæä¾›å…¨æ–¹ä½çš„æ•°æ®åˆ†æå’ŒæŠ¥è¡¨æœåŠ¡ï¼ŒåŒ…æ‹¬ä¸šåŠ¡æ•°æ®ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æã€ç”¨æˆ·è¡Œä¸ºåˆ†æã€è´¢åŠ¡æŠ¥è¡¨ç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—ä¸ºè¿è¥å†³ç­–æä¾›æ•°æ®æ”¯æ’‘ï¼Œå¸®åŠ©ä¼˜åŒ–ä¸šåŠ¡è¿è¥å’Œæå‡ç”¨æˆ·ä½“éªŒã€‚

### æ ¸å¿ƒèŒè´£

- ğŸ“ˆ **ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡**: æ”¶å…¥ã€å®¢æµé‡ã€è®¾å¤‡åˆ©ç”¨ç‡ç­‰æ ¸å¿ƒæŒ‡æ ‡
- ğŸ‘¥ **ç”¨æˆ·è¡Œä¸ºåˆ†æ**: ç”¨æˆ·ç”»åƒã€æ¶ˆè´¹ä¹ æƒ¯ã€æ´»è·ƒåº¦åˆ†æ
- ğŸ’° **è´¢åŠ¡æŠ¥è¡¨**: æ”¶æ”¯æ˜ç»†ã€å¯¹è´¦æŠ¥è¡¨ã€åˆ©æ¶¦åˆ†æ
- ğŸª **è¿è¥åˆ†æ**: é—¨åº—å¯¹æ¯”ã€æ—¶æ®µåˆ†æã€è¶‹åŠ¿é¢„æµ‹
- ğŸ“Š **å¯è§†åŒ–å±•ç¤º**: å›¾è¡¨å±•ç¤ºã€ä»ªè¡¨æ¿ã€æ•°æ®å¯¼å‡º

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ¨¡å—æ¶æ„å›¾

```mermaid
graph TB
    subgraph "æŠ¥è¡¨ç»Ÿè®¡æ¨¡å—"
        subgraph "åº”ç”¨æœåŠ¡å±‚"
            AS1[æŠ¥è¡¨æœåŠ¡]
            AS2[ç»Ÿè®¡æœåŠ¡]
            AS3[åˆ†ææœåŠ¡]
            AS4[å¯¼å‡ºæœåŠ¡]
        end
        
        subgraph "é¢†åŸŸæœåŠ¡å±‚"
            DS1[æ•°æ®èšåˆå™¨]
            DS2[æŒ‡æ ‡è®¡ç®—å™¨]
            DS3[è¶‹åŠ¿åˆ†æå™¨]
            DS4[æŠ¥è¡¨ç”Ÿæˆå™¨]
        end
        
        subgraph "é¢†åŸŸæ¨¡å‹å±‚"
            E1[æŠ¥è¡¨å®šä¹‰å®ä½“]
            E2[ç»Ÿè®¡æ•°æ®å®ä½“]
            E3[åˆ†æç»“æœå®ä½“]
            VO1[ç»Ÿè®¡æŒ‡æ ‡å€¼å¯¹è±¡]
        end
        
        subgraph "åŸºç¡€è®¾æ–½å±‚"
            R1[æŠ¥è¡¨ä»“å‚¨]
            R2[ç»Ÿè®¡æ•°æ®ä»“å‚¨]
            DW[æ•°æ®ä»“åº“]
            CACHE[ç¼“å­˜æœåŠ¡]
            EXPORT[å¯¼å‡ºå¼•æ“]
        end
    end
    
    AS1 --> DS4
    AS2 --> DS1
    AS3 --> DS3
    AS4 --> EXPORT
    
    DS1 --> DS2
    DS2 --> VO1
    DS3 --> E3
    DS4 --> E1
    
    E1 --> R1
    E2 --> R2
    E3 --> R2
    
    DS1 --> DW
    DS2 --> CACHE
    EXPORT --> DW
```

### æ•°æ®å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant S as ä¸šåŠ¡ç³»ç»Ÿ
    participant C as æ•°æ®æ”¶é›†å™¨
    participant P as æ•°æ®å¤„ç†å™¨
    participant A as æ•°æ®èšåˆå™¨
    participant R as æŠ¥è¡¨ç”Ÿæˆå™¨
    participant U as ç”¨æˆ·ç•Œé¢
    
    S->>C: ä¸šåŠ¡æ•°æ®äº§ç”Ÿ
    C->>C: æ•°æ®æ¸…æ´—è½¬æ¢
    C->>P: å­˜å‚¨åŸå§‹æ•°æ®
    
    Note over P,A: å®šæ—¶ä»»åŠ¡å¤„ç†
    P->>A: å®šæ—¶æ•°æ®èšåˆ
    A->>A: è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
    A->>P: å­˜å‚¨èšåˆç»“æœ
    
    U->>R: è¯·æ±‚æŠ¥è¡¨
    R->>A: è·å–èšåˆæ•°æ®
    A-->>R: è¿”å›ç»Ÿè®¡ç»“æœ
    R->>R: ç”ŸæˆæŠ¥è¡¨å›¾è¡¨
    R-->>U: è¿”å›å¯è§†åŒ–æŠ¥è¡¨
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒå®ä½“

#### æŠ¥è¡¨å®šä¹‰å®ä½“ (ReportDefinition)

```csharp
public class ReportDefinition : AuditedAggregateRoot<Guid>
{
    public string Name { get; set; }
    public string Title { get; set; }
    public string Description { get; set; }
    public ReportCategory Category { get; set; }
    public ReportType Type { get; set; }
    public string DataSource { get; set; }
    public string QueryTemplate { get; set; }
    public string ParametersConfig { get; set; }
    public string ChartConfig { get; set; }
    public string[] RequiredRoles { get; set; }
    public bool IsEnabled { get; set; }
    public int SortOrder { get; set; }
    public TimeSpan? CacheTimeout { get; set; }
    
    // å¯¼èˆªå±æ€§
    public ICollection<ReportExecution> Executions { get; set; }
}

public enum ReportCategory
{
    Business = 1,    // ä¸šåŠ¡æŠ¥è¡¨
    Financial = 2,   // è´¢åŠ¡æŠ¥è¡¨
    Operational = 3, // è¿è¥æŠ¥è¡¨
    Technical = 4    // æŠ€æœ¯æŠ¥è¡¨
}

public enum ReportType
{
    Table = 1,      // è¡¨æ ¼æŠ¥è¡¨
    Chart = 2,      // å›¾è¡¨æŠ¥è¡¨
    Dashboard = 3   // ä»ªè¡¨æ¿
}
```

#### ç»Ÿè®¡æ•°æ®å®ä½“ (StatisticsData)

```csharp
public class StatisticsData : CreationAuditedEntity<Guid>
{
    public string MetricName { get; set; }
    public StatisticsType Type { get; set; }
    public DateTime StatisticsDate { get; set; }
    public TimeGranularity Granularity { get; set; }
    public string Dimensions { get; set; }
    public decimal Value { get; set; }
    public string Unit { get; set; }
    public string AdditionalData { get; set; }
    public Guid? StoreId { get; set; }
}

public enum StatisticsType
{
    Revenue = 1,        // æ”¶å…¥
    UserCount = 2,      // ç”¨æˆ·æ•°
    SessionCount = 3,   // ä¼šè¯æ•°
    TableUtilization = 4, // å°çƒæ¡Œåˆ©ç”¨ç‡
    DeviceStatus = 5    // è®¾å¤‡çŠ¶æ€
}

public enum TimeGranularity
{
    Hour = 1,    // å°æ—¶
    Day = 2,     // æ—¥
    Week = 3,    // å‘¨
    Month = 4,   // æœˆ
    Quarter = 5, // å­£åº¦
    Year = 6     // å¹´
}
```

#### åˆ†æç»“æœå®ä½“ (AnalysisResult)

```csharp
public class AnalysisResult : CreationAuditedEntity<Guid>
{
    public string AnalysisName { get; set; }
    public AnalysisType Type { get; set; }
    public DateTime AnalysisDate { get; set; }
    public string InputParameters { get; set; }
    public string ResultData { get; set; }
    public string Summary { get; set; }
    public string Recommendations { get; set; }
    public decimal Confidence { get; set; }
    public DateTime? ExpiryDate { get; set; }
}

public enum AnalysisType
{
    TrendAnalysis = 1,      // è¶‹åŠ¿åˆ†æ
    UserSegmentation = 2,   // ç”¨æˆ·åˆ†ç¾¤
    PredictiveAnalysis = 3, // é¢„æµ‹åˆ†æ
    AnomalyDetection = 4    // å¼‚å¸¸æ£€æµ‹
}
```

---

## ğŸ”§ æ¥å£è®¾è®¡

### æŠ¥è¡¨ç®¡ç†æ¥å£

```csharp
public interface IReportAppService : IApplicationService
{
    Task<List<ReportDefinitionDto>> GetReportsAsync(GetReportsDto input);
    Task<ReportResultDto> ExecuteReportAsync(ExecuteReportDto input);
    Task<ReportDefinitionDto> CreateReportAsync(CreateReportDto input);
    Task<ReportDefinitionDto> UpdateReportAsync(Guid reportId, UpdateReportDto input);
    Task DeleteReportAsync(Guid reportId);
    Task<byte[]> ExportReportAsync(ExportReportDto input);
}
```

### ç»Ÿè®¡åˆ†ææ¥å£

```csharp
public interface IStatisticsAppService : IApplicationService
{
    Task<BusinessMetricsDto> GetBusinessMetricsAsync(GetMetricsDto input);
    Task<UserAnalyticsDto> GetUserAnalyticsAsync(GetUserAnalyticsDto input);
    Task<RevenueStatisticsDto> GetRevenueStatisticsAsync(GetRevenueStatsDto input);
    Task<DeviceUtilizationDto> GetDeviceUtilizationAsync(GetUtilizationDto input);
    Task<List<TrendDataDto>> GetTrendAnalysisAsync(GetTrendDto input);
}
```

### ä»ªè¡¨æ¿æ¥å£

```csharp
public interface IDashboardAppService : IApplicationService
{
    Task<DashboardDataDto> GetDashboardDataAsync(GetDashboardDto input);
    Task<List<KpiCardDto>> GetKpiCardsAsync();
    Task<List<ChartDataDto>> GetChartDataAsync(GetChartsDto input);
    Task<AlertSummaryDto> GetAlertSummaryAsync();
    Task RefreshDashboardCacheAsync();
}
```

---

## ğŸ“ˆ æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡

### æ”¶å…¥ç›¸å…³æŒ‡æ ‡

```csharp
public class RevenueMetrics
{
    // æ€»æ”¶å…¥
    public decimal TotalRevenue { get; set; }
    
    // æ—¥æ”¶å…¥
    public decimal DailyRevenue { get; set; }
    
    // å¹³å‡å®¢å•ä»·
    public decimal AverageOrderValue { get; set; }
    
    // æ”¶å…¥å¢é•¿ç‡
    public decimal RevenueGrowthRate { get; set; }
    
    // æŒ‰æ—¶æ®µæ”¶å…¥åˆ†å¸ƒ
    public Dictionary<string, decimal> HourlyRevenue { get; set; }
    
    // æŒ‰æ”¯ä»˜æ–¹å¼åˆ†å¸ƒ
    public Dictionary<string, decimal> PaymentMethodRevenue { get; set; }
}
```

### ç”¨æˆ·ç›¸å…³æŒ‡æ ‡

```csharp
public class UserMetrics
{
    // æ€»ç”¨æˆ·æ•°
    public int TotalUsers { get; set; }
    
    // æ´»è·ƒç”¨æˆ·æ•°
    public int ActiveUsers { get; set; }
    
    // æ–°å¢ç”¨æˆ·æ•°
    public int NewUsers { get; set; }
    
    // ç”¨æˆ·ç•™å­˜ç‡
    public decimal UserRetentionRate { get; set; }
    
    // ç”¨æˆ·æ´»è·ƒåº¦åˆ†å¸ƒ
    public Dictionary<string, int> UserActivityDistribution { get; set; }
    
    // ä¼šå‘˜ç­‰çº§åˆ†å¸ƒ
    public Dictionary<MemberLevel, int> MemberLevelDistribution { get; set; }
}
```

### è®¾å¤‡åˆ©ç”¨ç‡æŒ‡æ ‡

```csharp
public class DeviceUtilizationMetrics
{
    // æ€»ä½“åˆ©ç”¨ç‡
    public decimal OverallUtilizationRate { get; set; }
    
    // æŒ‰å°çƒæ¡Œç±»å‹åˆ©ç”¨ç‡
    public Dictionary<TableType, decimal> UtilizationByTableType { get; set; }
    
    // æŒ‰æ—¶æ®µåˆ©ç”¨ç‡
    public Dictionary<string, decimal> HourlyUtilization { get; set; }
    
    // å¹³å‡ä½¿ç”¨æ—¶é•¿
    public TimeSpan AverageUsageDuration { get; set; }
    
    // è®¾å¤‡æ•…éšœç‡
    public decimal DeviceFailureRate { get; set; }
}
```

---

## ğŸ“Š æŠ¥è¡¨ç±»å‹

### è´¢åŠ¡æŠ¥è¡¨

```mermaid
graph LR
    A[è´¢åŠ¡æŠ¥è¡¨] --> B[æ”¶å…¥æŠ¥è¡¨]
    A --> C[æˆæœ¬æŠ¥è¡¨]
    A --> D[åˆ©æ¶¦æŠ¥è¡¨]
    A --> E[å¯¹è´¦æŠ¥è¡¨]
    
    B --> B1[æ—¥æ”¶å…¥æ˜ç»†]
    B --> B2[æœˆåº¦æ”¶å…¥æ±‡æ€»]
    B --> B3[æ”¶å…¥è¶‹åŠ¿åˆ†æ]
    
    C --> C1[è¿è¥æˆæœ¬ç»Ÿè®¡]
    C --> C2[è®¾å¤‡ç»´æŠ¤æˆæœ¬]
    C --> C3[äººå‘˜æˆæœ¬åˆ†æ]
    
    D --> D1[æ¯›åˆ©æ¶¦è®¡ç®—]
    D --> D2[å‡€åˆ©æ¶¦ç»Ÿè®¡]
    D --> D3[åˆ©æ¶¦ç‡åˆ†æ]
    
    E --> E1[æ”¯ä»˜å¯¹è´¦å•]
    E --> E2[ç¬¬ä¸‰æ–¹å¯¹è´¦]
    E --> E3[å·®å¼‚åˆ†ææŠ¥å‘Š]
```

### è¿è¥æŠ¥è¡¨

```mermaid
graph LR
    A[è¿è¥æŠ¥è¡¨] --> B[å®¢æµåˆ†æ]
    A --> C[è®¾å¤‡ç›‘æ§]
    A --> D[æœåŠ¡è´¨é‡]
    A --> E[å¸‚åœºåˆ†æ]
    
    B --> B1[å®¢æµé‡ç»Ÿè®¡]
    B --> B2[é«˜å³°æ—¶æ®µåˆ†æ]
    B --> B3[å®¢æˆ·è¡Œä¸ºåˆ†æ]
    
    C --> C1[è®¾å¤‡åˆ©ç”¨ç‡]
    C --> C2[æ•…éšœç»Ÿè®¡æŠ¥å‘Š]
    C --> C3[ç»´æŠ¤è®¡åˆ’è·Ÿè¸ª]
    
    D --> D1[æœåŠ¡æ»¡æ„åº¦]
    D --> D2[æŠ•è¯‰å¤„ç†ç»Ÿè®¡]
    D --> D3[å“åº”æ—¶é—´åˆ†æ]
    
    E --> E1[å¸‚åœºå æœ‰ç‡]
    E --> E2[ç«å“å¯¹æ¯”åˆ†æ]
    E --> E3[ç”¨æˆ·å¢é•¿é¢„æµ‹]
```

---

## ğŸ¯ æ•°æ®åˆ†æç®—æ³•

### è¶‹åŠ¿åˆ†æ

```csharp
public class TrendAnalysisService
{
    public async Task<TrendAnalysisResult> AnalyzeTrendAsync(TrendAnalysisRequest request)
    {
        var data = await GetHistoricalDataAsync(request.MetricName, request.TimeRange);
        
        // ç§»åŠ¨å¹³å‡è®¡ç®—
        var movingAverage = CalculateMovingAverage(data, request.WindowSize);
        
        // è¶‹åŠ¿æ–¹å‘è®¡ç®—
        var trendDirection = CalculateTrendDirection(movingAverage);
        
        // å­£èŠ‚æ€§åˆ†æ
        var seasonality = AnalyzeSeasonality(data);
        
        // é¢„æµ‹æœªæ¥å€¼
        var forecast = GenerateForecast(data, request.ForecastPeriods);
        
        return new TrendAnalysisResult
        {
            TrendDirection = trendDirection,
            Seasonality = seasonality,
            MovingAverage = movingAverage,
            Forecast = forecast,
            Confidence = CalculateConfidence(data, forecast)
        };
    }
    
    private List<decimal> CalculateMovingAverage(List<decimal> data, int windowSize)
    {
        var result = new List<decimal>();
        for (int i = windowSize - 1; i < data.Count; i++)
        {
            var window = data.Skip(i - windowSize + 1).Take(windowSize);
            result.Add(window.Average());
        }
        return result;
    }
}
```

### ç”¨æˆ·åˆ†ç¾¤ç®—æ³•

```csharp
public class UserSegmentationService
{
    public async Task<UserSegmentationResult> SegmentUsersAsync()
    {
        var users = await GetUsersWithBehaviorDataAsync();
        
        // RFMåˆ†æï¼ˆæœ€è¿‘ä¸€æ¬¡æ¶ˆè´¹ã€æ¶ˆè´¹é¢‘ç‡ã€æ¶ˆè´¹é‡‘é¢ï¼‰
        var rfmScores = CalculateRFMScores(users);
        
        // K-meansèšç±»
        var clusters = PerformKMeansClustering(rfmScores, clusterCount: 5);
        
        // ç”¨æˆ·åˆ†ç¾¤æ ‡ç­¾
        var segments = AssignSegmentLabels(clusters);
        
        return new UserSegmentationResult
        {
            Segments = segments,
            SegmentStatistics = CalculateSegmentStatistics(segments),
            Recommendations = GenerateMarketingRecommendations(segments)
        };
    }
    
    private Dictionary<Guid, RFMScore> CalculateRFMScores(List<UserBehaviorData> users)
    {
        var result = new Dictionary<Guid, RFMScore>();
        
        foreach (var user in users)
        {
            result[user.UserId] = new RFMScore
            {
                Recency = CalculateRecencyScore(user.LastPurchaseDate),
                Frequency = CalculateFrequencyScore(user.PurchaseCount),
                Monetary = CalculateMonetaryScore(user.TotalAmount)
            };
        }
        
        return result;
    }
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®é¢„èšåˆ

```csharp
public class DataAggregationService
{
    // å®šæ—¶ä»»åŠ¡ï¼šæ¯å°æ—¶èšåˆæ•°æ®
    [Hangfire.RecurringJob("0 * * * *")]
    public async Task AggregateHourlyDataAsync()
    {
        var endTime = DateTime.Now.AddHours(-1);
        var startTime = endTime.AddHours(-1);
        
        // èšåˆæ”¶å…¥æ•°æ®
        await AggregateRevenueDataAsync(startTime, endTime, TimeGranularity.Hour);
        
        // èšåˆç”¨æˆ·æ´»åŠ¨æ•°æ®
        await AggregateUserActivityAsync(startTime, endTime, TimeGranularity.Hour);
        
        // èšåˆè®¾å¤‡ä½¿ç”¨æ•°æ®
        await AggregateDeviceUsageAsync(startTime, endTime, TimeGranularity.Hour);
    }
    
    private async Task AggregateRevenueDataAsync(DateTime start, DateTime end, TimeGranularity granularity)
    {
        var revenueData = await _paymentRepository
            .GetPaymentsInPeriodAsync(start, end);
            
        var aggregated = revenueData
            .GroupBy(p => new { p.CreationTime.Hour, p.Channel })
            .Select(g => new StatisticsData
            {
                MetricName = "hourly_revenue",
                Type = StatisticsType.Revenue,
                StatisticsDate = new DateTime(start.Year, start.Month, start.Day, g.Key.Hour, 0, 0),
                Granularity = granularity,
                Dimensions = $"channel:{g.Key.Channel}",
                Value = g.Sum(p => p.Amount)
            });
            
        await _statisticsRepository.BulkInsertAsync(aggregated);
    }
}
```

### ç¼“å­˜ç­–ç•¥

```csharp
// æŠ¥è¡¨ç»“æœç¼“å­˜ï¼ˆ30åˆ†é’Ÿï¼‰
[CachePut(CacheNames.ReportResult, "{reportId}_{parameters}", Duration = 1800)]
public async Task<ReportResultDto> ExecuteReportAsync(ExecuteReportDto input)

// å®æ—¶æŒ‡æ ‡ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
[CachePut(CacheNames.RealTimeMetrics, Duration = 300)]
public async Task<BusinessMetricsDto> GetRealTimeMetricsAsync()
```

---

## ğŸ“‹ æŠ¥è¡¨é…ç½®ç¤ºä¾‹

### æ”¶å…¥è¶‹åŠ¿æŠ¥è¡¨é…ç½®

```json
{
  "reportId": "revenue_trend",
  "name": "æ”¶å…¥è¶‹åŠ¿åˆ†æ",
  "category": "Business",
  "type": "Chart",
  "dataSource": "statistics_data",
  "queryTemplate": "SELECT statistics_date, SUM(value) as revenue FROM statistics_data WHERE metric_name = 'daily_revenue' AND statistics_date BETWEEN @startDate AND @endDate GROUP BY statistics_date ORDER BY statistics_date",
  "parameters": [
    {
      "name": "startDate",
      "type": "date",
      "required": true,
      "defaultValue": "30DaysAgo"
    },
    {
      "name": "endDate", 
      "type": "date",
      "required": true,
      "defaultValue": "Today"
    }
  ],
  "chartConfig": {
    "type": "line",
    "xAxis": "statistics_date",
    "yAxis": "revenue",
    "title": "æ¯æ—¥æ”¶å…¥è¶‹åŠ¿"
  }
}
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **ä¸Šçº§æ–‡æ¡£**: [æ¨¡å—è®¾è®¡æ€»è§ˆ](README.md)
- **å…³è”æ–‡æ¡£**: [æ‰€æœ‰ä¸šåŠ¡æ¨¡å—](README.md#æ¨¡å—è¯¦ç»†è¯´æ˜)
- **æŠ€æœ¯æ–‡æ¡£**: [æ•°æ®ä»“åº“è®¾è®¡](../05_æ•°æ®åº“è®¾è®¡/æ•°æ®ä»“åº“.md)
- **è¿”å›**: [é¡¹ç›®æ–‡æ¡£é¦–é¡µ](../è‡ªåŠ©å°çƒç³»ç»Ÿé¡¹ç›®æ–‡æ¡£.md)

---

*æœ€åæ›´æ–°: 2024-01-15 | ç‰ˆæœ¬: v1.0.0*
