# Wolverine 架构规划总览

> **定位**: Wolverine 架构文档的统一入口
> 
> **适用范围**: 所有使用 Wolverine 框架的项目

---

## 📚 文档索引

### 核心文档（必读）

本文档集合将原有的 `Wolverine模块化架构蓝图.md` (1115行) 拆分为 6 个聚焦的文档，便于查阅和维护。

| 文档 | 内容概要 | 阅读时间 | 适合人群 |
|------|---------|---------|---------|
| [01_核心架构原则](./01_核心架构原则.md) | 垂直切片、Handler、约束规则 | 30分钟 | 所有人 ⭐⭐⭐ |
| [02_解决方案结构设计](./02_解决方案结构设计.md) | Solution 结构、模块拆分 | 30分钟 | 架构师/Tech Lead ⭐⭐ |
| [03_模块设计指南](./03_模块设计指南.md) | 单个模块结构、Slice 模板 | 45分钟 | 开发者 ⭐⭐⭐ |
| [04_Saga工作流设计](./04_Saga工作流设计.md) | Saga 使用场景与实现 | 30分钟 | 开发者 ⭐⭐ |
| [05_跨模块通信指南](./05_跨模块通信指南.md) | 同步/异步通信、反模式 | 30分钟 | 开发者 ⭐⭐⭐ |
| [06_实战建议与最佳实践](./06_实战建议与最佳实践.md) | 经验总结、常见错误 | 30分钟 | 所有人 ⭐⭐ |

---

## 🎯 快速导航

### 场景 1: 我是新成员，第一次接触 Wolverine

**推荐路径**（3-4 小时）:
1. [01_核心架构原则](./01_核心架构原则.md) - 理解核心理念（30分钟）
2. [Wolverine快速上手指南](../Wolverine快速上手指南.md) - 动手实践（2小时）
3. [03_模块设计指南](./03_模块设计指南.md) - 学习标准结构（45分钟）

### 场景 2: 我需要实现一个新功能

**直接跳转**:
1. [03_模块设计指南 - 完整 Slice 形态](./03_模块设计指南.md#二完整-slice-的标准形态) - 代码模板
2. [02_解决方案结构设计](./02_解决方案结构设计.md#三推荐模块拆分自助台球系统) - 确定所属模块

### 场景 3: 我需要跨模块通信

**直接跳转**:
1. [05_跨模块通信指南 - 通信方式选择](./05_跨模块通信指南.md#一通信方式选择)
2. [05_跨模块通信指南 - 实现示例](./05_跨模块通信指南.md#二同步通信command-bus)

### 场景 4: 我需要实现长流程/工作流

**直接跳转**:
1. [04_Saga工作流设计 - 何时使用](./04_Saga工作流设计.md#一何时使用-saga)
2. [04_Saga工作流设计 - 实现示例](./04_Saga工作流设计.md#二saga-实现示例)

### 场景 5: 我遇到了问题

**直接跳转**:
1. [06_实战建议 - 常见错误](./06_实战建议与最佳实践.md#七常见错误与解决)
2. [Wolverine快速上手指南 - 调试技巧](../Wolverine快速上手指南.md#四调试技巧)

---

## 📖 核心概念速查

### 垂直切片架构

**定义**: 按业务功能组织代码，而非技术层次

**核心原则**:
- ❌ 不要 Application/Domain/Infrastructure 分层
- ✅ 一个 Use Case = 一个文件夹
- ✅ Command + Handler + Endpoint + Validator 放在一起

**详见**: [01_核心架构原则 - 原则 1](./01_核心架构原则.md#原则-1-100-垂直切片vertical-slice)

### Handler 是 Application Service

**定义**: Handler 直接处理业务逻辑，不需要单独的 Service 层

**核心能力**:
- 自动依赖注入（方法参数）
- 自动事务管理（`[Transactional]`）
- 自动 Outbox 模式

**详见**: [01_核心架构原则 - 原则 4](./01_核心架构原则.md#原则-4-handler-就是-application-service)

### 模块边界

**定义**: 每个模块代表一个业务能力（Bounded Context）

**通信规则**:
- ✅ 模块间只能通过消息通信
- ❌ 禁止跨模块直接数据库访问
- ❌ 禁止创建 Shared Service 层

**详见**: [02_解决方案结构设计 - 关键设计原则](./02_解决方案结构设计.md#二关键设计原则)

---

## 🏗️ 标准实现模板

### 完整 Slice 结构

```text
ReserveTable/
├── ReserveTable.cs              # Command 定义
├── ReserveTableEndpoint.cs      # HTTP 端点
├── ReserveTableHandler.cs       # 业务处理器
├── ReserveTableValidator.cs     # 输入验证（可选）
└── TableReserved.cs             # 领域事件
```

**详见**: [03_模块设计指南 - 完整 Slice](./03_模块设计指南.md#二完整-slice-的标准形态)

### 跨模块通信

```csharp
// 同步调用
var result = await bus.InvokeAsync<BillResult>(
    new CalculateBill(sessionId, duration)
);

// 异步事件
await bus.PublishAsync(
    new MemberRegistered(memberId, name, phone)
);
```

**详见**: [05_跨模块通信指南](./05_跨模块通信指南.md)

---

## ❓ 常见问题

### Q1: Wolverine 与 MediatR 如何选择？

**选择 Wolverine**:
- 需要消息持久化（Outbox 模式）
- 需要跨进程通信（RabbitMQ/Kafka）
- 需要后台任务/定时任务
- 需要 Saga/工作流

**详见**: [Wolverine框架介绍 - 与 MediatR 对比](../Wolverine框架介绍.md)

### Q2: 垂直切片会导致代码重复吗？

**简答**: 适度重复是可接受的，真正的核心领域逻辑仍然可以共享。

**详见**: [06_实战建议 - 不要重复洁癖](./06_实战建议与最佳实践.md#二不要重复洁癖)

### Q3: 如何从 ABP 分层架构迁移？

**简答**: 新功能使用新架构，老功能逐步迁移，保持领域模型共享。

**详见**: [垂直切片架构说明 - 迁移指南](../垂直切片架构说明.md)

### Q4: Handler 复杂度过高怎么办？

**简答**: 
1. 拆分 Handler
2. 引入领域服务
3. 使用 Saga

**详见**: [06_实战建议 - Handler 复杂度信号](./06_实战建议与最佳实践.md#四handler-复杂度信号)

---

## 🔗 相关文档

### 架构理念
- [垂直切片架构说明](../垂直切片架构说明.md) - 垂直切片 vs. 传统分层
- [设计原则](../设计原则.md) - CQRS、DDD Light、消息驱动
- [架构变更摘要](../架构变更摘要.md) - 从 ABP 到 Wolverine

### 快速上手
- [Wolverine快速上手指南](../Wolverine快速上手指南.md) ⭐⭐⭐ - 15分钟上手教程
- [系统模块划分](../系统模块划分.md) - 6大核心模块

### 技术框架
- [Wolverine框架介绍](../Wolverine框架介绍.md) - 框架特性与能力
- [Marten数据访问](../Marten数据访问.md) - 数据访问方式
- [Aspire编排架构](../Aspire编排架构.md) - 编排与可观测性

### 开发规范
- [Saga使用指南](../../06_开发规范/Saga使用指南.md) - Saga 详细指南
- [FluentValidation集成指南](../../06_开发规范/FluentValidation集成指南.md) - 输入验证
- [代码风格](../../06_开发规范/代码风格.md) - 代码规范

### 模块设计
- [会员管理模块](../../04_模块设计/会员管理模块.md) - Members 模块示例
- [打球时段模块](../../04_模块设计/打球时段模块.md) - Sessions 模块 + Saga
- [计费管理模块](../../04_模块设计/计费管理模块.md) - Billing 模块示例

---

## 📝 文档组织原则

### 为什么拆分？

**原问题**:
- `Wolverine模块化架构蓝图.md` 有 1115 行 (29KB)
- 内容过多，难以快速定位
- 维护困难，修改影响范围大

**拆分收益**:
- 每个文档聚焦单一主题
- 便于独立维护和更新
- 支持按需查阅
- 降低认知负担

### 文档关系

```
架构规划总览 (本文档)
├─ 01_核心架构原则          # 理念与约束
├─ 02_解决方案结构设计       # Solution 级别组织
├─ 03_模块设计指南           # 模块级别组织
├─ 04_Saga工作流设计         # 长流程编排
├─ 05_跨模块通信指南         # 模块间交互
└─ 06_实战建议与最佳实践     # 经验总结
```

---

## 🎓 学习路径

### 新成员（3-5天）

**Day 1**: 架构理念
- [架构变更摘要](../架构变更摘要.md) (30分钟)
- [垂直切片架构说明](../垂直切片架构说明.md) (1小时)
- [01_核心架构原则](./01_核心架构原则.md) (30分钟)

**Day 2**: 动手实践
- [Wolverine快速上手指南](../Wolverine快速上手指南.md) (2小时)
- 实现第一个 Handler (2小时)

**Day 3**: 深入学习
- [03_模块设计指南](./03_模块设计指南.md) (45分钟)
- [05_跨模块通信指南](./05_跨模块通信指南.md) (30分钟)
- [02_解决方案结构设计](./02_解决方案结构设计.md) (30分钟)

**Day 4**: 高级主题
- [04_Saga工作流设计](./04_Saga工作流设计.md) (30分钟)
- [06_实战建议与最佳实践](./06_实战建议与最佳实践.md) (30分钟)

**Day 5**: 实战练习
- 实现完整功能切片
- 代码评审与反馈

### 架构师/Tech Lead（1-2周）

**Week 1**: 完整架构理解
- 阅读所有架构规划文档
- 阅读相关模块设计示例
- 阅读开发规范文档

**Week 2**: 深入技术细节
- Wolverine 官方文档
- Marten 官方文档
- 实践项目架构设计

---

## 📞 获取帮助

### 内部资源
- **问题反馈**: 提交 GitHub Issue
- **架构讨论**: 联系架构团队
- **代码评审**: 提交 Pull Request

### 外部资源
- [Wolverine 官方文档](https://wolverine.netlify.app/)
- [Wolverine GitHub](https://github.com/JasperFx/wolverine)
- [Marten 官方文档](https://martendb.io/)
- [Vertical Slice Architecture - Jimmy Bogard](https://www.jimmybogard.com/vertical-slice-architecture/)

---

## 🔄 文档维护

### 版本历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 1.0.0 | 2024-01-15 | 将 Wolverine模块化架构蓝图 拆分为 6 个文档 |

### 贡献指南
- 架构变更需经过架构团队评审
- 文档更新遵循 Markdown 规范
- 示例代码必须可运行
- 保持文档简洁聚焦

### 联系方式
- **负责人**: 架构团队
- **反馈渠道**: 提交 Issue 或 PR
- **审核周期**: 每周五统一评审

---

**最后更新**: 2024-01-15  
**负责人**: 架构团队  
**审核状态**: ✅ 已审核
