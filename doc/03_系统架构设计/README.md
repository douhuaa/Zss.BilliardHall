# 3. 系统架构设计

本目录包含自助台球系统的架构设计文档，采用 **垂直切片架构** + **Wolverine** + **Marten** 技术栈。

> 📍 **快速导航**: 不知道从哪里开始？查看 [文档导航指南](./文档导航.md)

---

## 📚 核心文档

### 🎯 快速开始（推荐阅读顺序）

1. **[架构变更摘要](./架构变更摘要.md)** ⭐  
   了解从 ABP 分层架构到 Wolverine 垂直切片架构的变更

2. **[Wolverine快速上手指南](./Wolverine快速上手指南.md)** ⭐⭐⭐  
   15分钟上手 Wolverine，包含完整示例代码

3. **[Wolverine模块化架构蓝图](./Wolverine模块化架构蓝图.md)** ⭐⭐⭐  
   可直接落地的实战型架构规划，**必读**

4. **[系统模块划分](./系统模块划分.md)** ⭐⭐  
   6大核心模块的职责边界与通信规则

---

## 📖 架构理念

### [垂直切片架构说明](./垂直切片架构说明.md)
- 垂直切片 vs. 传统分层架构
- 按业务功能组织代码
- 高内聚、低耦合的实现方式
- 从 ABP 迁移指南

### [设计原则](./设计原则.md)
- CQRS 原则
- DDD Light 原则
- 消息驱动架构
- 可测试性和可观测性

---

## 🛠️ 技术框架

### [Wolverine框架介绍](./Wolverine框架介绍.md)
- 核心特性：命令/查询处理、消息总线、HTTP 集成
- 中间件与生命周期
- 持久化收件箱/发件箱（Outbox 模式）
- 与 MediatR 对比

### [Marten数据访问](./Marten数据访问.md)
- PostgreSQL 文档存储
- 强类型 LINQ 查询
- 事件溯源支持
- 与 EF Core 对比

### [技术选型](./技术选型.md)
- 技术栈选择理由
- Wolverine vs MediatR
- Marten vs EF Core
- 技术决策记录

---

## 🏗️ 系统设计

### [总体架构图](./总体架构图.md)
- 逻辑架构图
- 物理部署架构
- 容器架构（Aspire）

### [外部接口](./外部接口.md)
- 支付网关集成
- 硬件设备 API
- 第三方服务对接

---

## 📂 文档结构

```
03_系统架构设计/
├── README.md                       # 本文件
├── 架构变更摘要.md                  # 架构演进历史
├── Wolverine模块化架构蓝图.md       # ⭐ 核心：实战架构指南
├── Wolverine快速上手指南.md         # ⭐ 入门：15分钟上手
├── 系统模块划分.md                  # 模块边界与职责
├── 垂直切片架构说明.md              # 架构理念
├── Wolverine框架介绍.md            # 框架特性
├── Marten数据访问.md               # 数据访问
├── 技术选型.md                     # 技术决策
├── 设计原则.md                     # 设计指导原则
├── 总体架构图.md                   # 架构图示
└── 外部接口.md                     # 外部集成
```

---

## 🎓 学习路径

### 新成员入职

1. **第1天**: 阅读 [架构变更摘要](./架构变更摘要.md) + [垂直切片架构说明](./垂直切片架构说明.md)
2. **第2天**: 学习 [Wolverine快速上手指南](./Wolverine快速上手指南.md)，跑通第一个示例
3. **第3天**: 深入阅读 [Wolverine模块化架构蓝图](./Wolverine模块化架构蓝图.md)
4. **第4天**: 了解 [系统模块划分](./系统模块划分.md)，熟悉模块边界
5. **第5天**: 实现第一个功能切片（在导师指导下）

### 架构师/Tech Lead

1. 完整阅读 [Wolverine模块化架构蓝图](./Wolverine模块化架构蓝图.md)
2. 学习 [设计原则](./设计原则.md) 和 [系统模块划分](./系统模块划分.md)
3. 参考 [技术选型](./技术选型.md) 了解技术决策背景
4. 阅读 Wolverine 和 Marten 官方文档深入理解

---

## ❓ 常见问题

### Q1: 为什么选择 Wolverine 而非 MediatR？

参见 [Wolverine框架介绍 - 第5节](./Wolverine框架介绍.md#5-与-mediatr-的对比)

**简答**: Wolverine 提供了消息持久化、跨进程通信、Saga 等 MediatR 不具备的能力。

### Q2: 垂直切片架构会导致代码重复吗？

参见 [垂直切片架构说明 - 第5.2节](./垂直切片架构说明.md#52-共享代码原则)

**简答**: 适度重复是可接受的，真正的核心领域逻辑仍然可以共享。

### Q3: 如何从 ABP 分层架构迁移？

参见 [垂直切片架构说明 - 第6节](./垂直切片架构说明.md#6-迁移指南)

**简答**: 新功能使用新架构，老功能逐步迁移，保持领域模型共享。

### Q4: 模块间如何通信？

参见 [Wolverine模块化架构蓝图 - 第六章](./Wolverine模块化架构蓝图.md#六跨模块通信底线规则)

**简答**: 
- 同步：`IMessageBus.InvokeAsync(command)`
- 异步：`IMessageBus.PublishAsync(event)`
- 禁止直接调用其他模块的 Handler

### Q5: 如何开始实现第一个功能？

参见 [Wolverine快速上手指南 - 第一章](./Wolverine快速上手指南.md#一5-分钟上手)

**简答**: 5步搞定：创建目录 → 定义Command → 实现Handler → 添加Endpoint → 运行测试

---

## 🔗 相关文档

- [04_模块设计](../04_模块设计/) - 各模块的详细设计
- [05_数据库设计](../05_数据库设计/) - Marten 开发工作流程
- [06_开发规范](../06_开发规范/) - 切片约束与代码规范
- [07_API文档](../07_API文档/) - API 接口文档

---

## 📝 文档维护

### 版本历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 2.0.0 | 2024-01-15 | 新增 Wolverine 模块化架构完整蓝图 |
| 1.5.0 | 2024-01-15 | 新增快速上手指南 |
| 1.0.0 | 2024-01-15 | 完成垂直切片架构基础文档 |

### 贡献指南

- 架构变更需经过架构团队评审
- 文档更新遵循 Markdown 规范
- 示例代码必须可运行
- 图表使用 Mermaid 或 PlantUML

### 联系方式

- **负责人**: 架构团队
- **反馈渠道**: 提交 Issue 或 PR
- **审核周期**: 每周五统一评审

---

**最后更新**: 2024-01-15  
**状态**: ✅ 已审核
