# ABP Framework 项目搭建指南

本文档记录了如何使用 ABP CLI 创建 Blazor WebApp 项目基础框架的过程。

## 1. 环境准备

### 1.1 安装 .NET SDK

确保已安装 .NET 9 SDK：

```bash
dotnet --version
# 输出: 9.0.305 或更高版本
```

如果未安装，请访问 [https://dotnet.microsoft.com/download](https://dotnet.microsoft.com/download) 下载安装。

### 1.2 安装 ABP CLI

```bash
dotnet tool install -g Volo.Abp.Cli
```

验证安装：

```bash
abp --version
# 输出: ABP CLI 9.3.5
```

### 1.3 安装 PostgreSQL

- 下载并安装 PostgreSQL 12 或更高版本
- 记录数据库连接信息（主机、端口、用户名、密码）

## 2. 创建 ABP 项目

### 2.1 使用 ABP CLI 创建项目（在线方式）

如果网络可以访问 abp.io，可以使用以下命令：

```bash
abp new Zss.BilliardHall \
  -t app \
  -u blazor \
  -d ef \
  --dbms PostgreSQL \
  --version 9.3.5
```

参数说明：
- `-t app`: 使用应用程序模板
- `-u blazor`: 使用 Blazor UI
- `-d ef`: 使用 Entity Framework Core
- `--dbms PostgreSQL`: 使用 PostgreSQL 数据库
- `--version 9.3.5`: 指定 ABP 版本

### 2.2 手动创建项目（离线方式）

如果无法访问 abp.io，可以手动创建项目结构：

#### 步骤 1: 创建解决方案

```bash
# 创建目录结构
mkdir -p src test

# 创建解决方案文件
dotnet new sln -n Zss.BilliardHall
```

#### 步骤 2: 创建各层项目

```bash
# Domain.Shared 层
cd src
dotnet new classlib -n Zss.BilliardHall.Domain.Shared -f net9.0

# Domain 层
dotnet new classlib -n Zss.BilliardHall.Domain -f net9.0

# Application.Contracts 层
dotnet new classlib -n Zss.BilliardHall.Application.Contracts -f net9.0

# Application 层
dotnet new classlib -n Zss.BilliardHall.Application -f net9.0

# EntityFrameworkCore 层
dotnet new classlib -n Zss.BilliardHall.EntityFrameworkCore -f net9.0

# HttpApi 层
dotnet new classlib -n Zss.BilliardHall.HttpApi -f net9.0

# HttpApi.Host 层
dotnet new webapi -n Zss.BilliardHall.HttpApi.Host -f net9.0

# Blazor 层
dotnet new blazor -n Zss.BilliardHall.Blazor -f net9.0

# 测试项目
cd ../test
dotnet new xunit -n Zss.BilliardHall.Application.Tests -f net9.0
```

#### 步骤 3: 添加项目到解决方案

```bash
cd ..
dotnet sln add src/Zss.BilliardHall.Domain.Shared/Zss.BilliardHall.Domain.Shared.csproj
dotnet sln add src/Zss.BilliardHall.Domain/Zss.BilliardHall.Domain.csproj
dotnet sln add src/Zss.BilliardHall.Application.Contracts/Zss.BilliardHall.Application.Contracts.csproj
dotnet sln add src/Zss.BilliardHall.Application/Zss.BilliardHall.Application.csproj
dotnet sln add src/Zss.BilliardHall.EntityFrameworkCore/Zss.BilliardHall.EntityFrameworkCore.csproj
dotnet sln add src/Zss.BilliardHall.HttpApi/Zss.BilliardHall.HttpApi.csproj
dotnet sln add src/Zss.BilliardHall.HttpApi.Host/Zss.BilliardHall.HttpApi.Host.csproj
dotnet sln add src/Zss.BilliardHall.Blazor/Zss.BilliardHall.Blazor.csproj
dotnet sln add test/Zss.BilliardHall.Application.Tests/Zss.BilliardHall.Application.Tests.csproj
```

#### 步骤 4: 添加 ABP NuGet 包

```bash
# Domain.Shared
cd src/Zss.BilliardHall.Domain.Shared
dotnet add package Volo.Abp.Validation

# Domain
cd ../Zss.BilliardHall.Domain
dotnet add package Volo.Abp.Ddd.Domain

# Application.Contracts
cd ../Zss.BilliardHall.Application.Contracts
dotnet add package Volo.Abp.Ddd.Application.Contracts

# Application
cd ../Zss.BilliardHall.Application
dotnet add package Volo.Abp.Ddd.Application

# EntityFrameworkCore
cd ../Zss.BilliardHall.EntityFrameworkCore
dotnet add package Volo.Abp.EntityFrameworkCore.PostgreSql

# HttpApi
cd ../Zss.BilliardHall.HttpApi
dotnet add package Volo.Abp.AspNetCore.Mvc

# HttpApi.Host
cd ../Zss.BilliardHall.HttpApi.Host
dotnet add package Volo.Abp.AspNetCore.Mvc
dotnet add package Volo.Abp.Autofac
dotnet add package Volo.Abp.Swashbuckle
```

## 3. 项目结构说明

创建完成后的项目结构：

```
Zss.BilliardHall/
├── Zss.BilliardHall.sln                      # 解决方案文件
├── src/
│   ├── Zss.BilliardHall.Domain.Shared/       # 共享常量、枚举
│   ├── Zss.BilliardHall.Domain/              # 实体、仓储接口
│   ├── Zss.BilliardHall.Application.Contracts/ # 应用服务接口、DTO
│   ├── Zss.BilliardHall.Application/         # 应用服务实现
│   ├── Zss.BilliardHall.EntityFrameworkCore/ # EF Core 配置
│   ├── Zss.BilliardHall.HttpApi/             # API 控制器
│   ├── Zss.BilliardHall.HttpApi.Host/        # Web API 主机
│   └── Zss.BilliardHall.Blazor/              # Blazor UI
└── test/
    └── Zss.BilliardHall.Application.Tests/   # 单元测试
```

## 4. 配置数据库

### 4.1 配置连接字符串

编辑 `src/Zss.BilliardHall.HttpApi.Host/appsettings.json`:

```json
{
  "ConnectionStrings": {
    "Default": "Host=localhost;Port=5432;Database=ZssBilliardHall;Username=postgres;Password=your_password"
  }
}
```

### 4.2 创建数据库迁移

```bash
# 安装 EF Core 工具
dotnet tool install -g dotnet-ef

# 创建初始迁移
cd src/Zss.BilliardHall.EntityFrameworkCore
dotnet ef migrations add InitialCreate

# 应用迁移到数据库
dotnet ef database update
```

## 5. 运行项目

### 5.1 运行 API

```bash
cd src/Zss.BilliardHall.HttpApi.Host
dotnet run
```

访问 Swagger UI: `https://localhost:5001/swagger`

### 5.2 运行 Blazor 应用

在新终端中：

```bash
cd src/Zss.BilliardHall.Blazor
dotnet run
```

访问应用: `https://localhost:5002`

### 5.3 运行测试

```bash
cd test/Zss.BilliardHall.Application.Tests
dotnet test
```

## 6. 常见问题

### Q1: ABP CLI 无法访问网络

**解决方案**: 使用手动创建项目的方式（参见 2.2 节）

### Q2: 数据库连接失败

**检查清单**:
1. PostgreSQL 服务是否运行
2. 连接字符串是否正确
3. 用户名密码是否正确
4. 数据库是否已创建

### Q3: 端口被占用

**解决方案**: 在 `Properties/launchSettings.json` 中修改端口配置

## 7. 下一步

- [x] 项目基础框架搭建完成
- [ ] 配置 ABP 模块
- [ ] 实现领域实体
- [ ] 创建应用服务
- [ ] 开发 Blazor UI 组件
- [ ] 编写单元测试
- [ ] 配置 CI/CD

## 8. 参考资源

- [ABP 官方文档](https://abp.io/docs/latest)
- [ABP CLI 文档](https://abp.io/docs/latest/cli)
- [Entity Framework Core 文档](https://docs.microsoft.com/ef/core/)
- [Blazor 文档](https://docs.microsoft.com/aspnet/core/blazor)
- [PostgreSQL 文档](https://www.postgresql.org/docs/)

## 9. 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| 1.0 | 2025-10-01 | 初始版本，完成基础框架搭建 |
