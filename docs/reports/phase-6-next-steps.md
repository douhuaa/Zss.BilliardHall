# 后续阶段行动计划

> **制定日期**：2026-02-04  
> **版本**：1.0  
> **状态**：待执行  
> **基于**：阶段 5 验证报告

---

## 📋 执行摘要

本文档基于阶段 5 验证报告，制定后续阶段的详细行动计划，包括测试失败修复和剩余 ADR 对齐工作。

---

## 1. 优先级排序

### 1.1 P0 - 紧急修复（1-2 周）

#### 任务 1：修复文档格式问题（18 个测试失败）

**目标**：解决所有文档格式相关的测试失败

**具体问题**：
- README 文档缺少无裁决力声明（4 处）
- 关系声明区格式不规范（5 处）
- 案例文档结构不完整（3 处）
- 工程标准文档缺少章节（3 处）
- 其他文档格式问题（3 处）

**执行策略**：
1. 使用 documentation-maintainer agent 批量检查文档
2. 按类型分组修复（README → 关系声明 → 案例文档 → 工程标准）
3. 每次修复后运行对应测试验证
4. 更新文档模板避免将来重现

**预估工期**：3-5 天

**负责人建议**：documentation-maintainer agent + 人工审核

---

#### 任务 2：修复关系声明问题（5 个测试失败）

**目标**：确保所有 ADR 关系声明双向一致

**具体问题**：
- DependsOn/DependedBy 关系不一致（3 处）
- Supersedes/SupersededBy 关系不一致（2 处）
- 可能存在循环依赖

**执行策略**：
1. 使用 adr-reviewer agent 分析所有关系声明
2. 生成关系不一致报告
3. 手动或自动修正关系声明
4. 运行 ADR-940 测试验证
5. 更新 ADR-RELATIONSHIP-MAP.md

**预估工期**：2-3 天

**负责人建议**：adr-reviewer agent + architecture-guardian

---

#### 任务 3：完善测试映射（7 个测试失败）

**目标**：确保所有测试与 ADR 正确映射

**具体问题**：
- 部分 ADR 缺少对应测试类
- 测试失败消息格式不符合规范
- RuleId 映射不完整

**执行策略**：
1. 使用 test-generator agent 识别缺失的测试类
2. 为缺失的 ADR 创建测试类骨架
3. 更新测试失败消息格式
4. 验证 RuleId 引用完整性
5. 运行 ADR-900 和 ADR-907 测试验证

**预估工期**：3-4 天

**负责人建议**：test-generator agent

---

#### 任务 4：更新 Agent 配置（2 个测试失败）

**目标**：确保所有 Agent 配置符合规范

**具体问题**：
- Instructions 文件缺少权威依据声明
- Agent 边界声明不完整

**执行策略**：
1. 审查所有 `.github/instructions/*.yaml` 文件
2. 添加缺失的权威依据声明
3. 补充 Agent 边界声明
4. 运行 ADR-007 测试验证

**预估工期**：1-2 天

**负责人建议**：人工修改 + architecture-guardian 验证

---

### 1.2 P1 - 后续对齐（6-8 周）

#### 阶段 3：运行层 ADR 对齐（5 个 ADR）

**目标 ADR**：
- ADR-120：Domain Event 命名约定
- ADR-121：Contract/DTO 命名组织
- ADR-122：测试组织命名
- ADR-123：Repository 接口分层
- ADR-124：Endpoint 命名约束

**执行策略**：
1. **批次 1**（2-3 周）：ADR-120, ADR-121, ADR-122
   - 这三个 ADR 相对独立，可以并行对齐
   - 重点：命名规范和组织结构
   - 测试：NetArchTest 规则验证

2. **批次 2**（1-2 周）：ADR-123, ADR-124
   - ADR-123 与 ADR-001/003 有依赖关系
   - ADR-124 与 ADR-005 有依赖关系
   - 测试：接口和端点规则验证

**验收标准**：
- 5 个 ADR 全部对齐到 Rule/Clause 结构
- 所有测试通过
- Front Matter 更新完整
- 关系声明准确

**预估工期**：3-4 周

---

#### 阶段 4：结构层 ADR 对齐（4 个 ADR）

**目标 ADR**：
- ADR-201：Handler 生命周期管理
- ADR-210：事件版本化与兼容性
- ADR-220：事件总线集成
- ADR-240：Handler 异常约束

**执行策略**：
1. **批次 1**（1-2 周）：ADR-201, ADR-240
   - 这两个 ADR 都与 Handler 相关
   - 可以使用 handler-pattern-enforcer agent
   - 测试：Handler 模式验证

2. **批次 2**（1-2 周）：ADR-210, ADR-220
   - 事件相关的 ADR
   - 与 ADR-120 有关联
   - 测试：事件处理验证

**验收标准**：
- 4 个 ADR 全部对齐到 Rule/Clause 结构
- 所有测试通过
- Handler 和事件规则明确
- 与其他 ADR 关系一致

**预估工期**：2-3 周

---

#### 阶段 5：技术层 ADR 对齐（4 个 ADR）

**目标 ADR**：
- ADR-301：集成测试自动化
- ADR-340：结构化日志与监控约束
- ADR-350：日志可观测性标准
- ADR-360：CI/CD 流水线标准化

**执行策略**：
1. **批次 1**（1 周）：ADR-301
   - 相对独立的测试规范
   - 测试：测试项目结构验证

2. **批次 2**（1 周）：ADR-340, ADR-350
   - 日志相关 ADR
   - 可以一起对齐
   - 测试：日志格式和内容验证

3. **批次 3**（1 周）：ADR-360
   - CI/CD 规范
   - 与现有 workflows 对齐
   - 测试：CI 配置验证

**验收标准**：
- 4 个 ADR 全部对齐到 Rule/Clause 结构
- 所有测试通过
- 技术规范明确可执行
- CI/CD 集成完整

**预估工期**：2-3 周

---

### 1.3 P2 - 持续改进（持续）

#### 任务 1：文档质量提升

**目标**：提升所有 ADR 文档的质量和可读性

**具体工作**：
1. 为每个 ADR 补充示例代码
2. 添加常见场景说明
3. 补充反例和错误示例
4. 完善 FAQ 章节

**执行方式**：
- 按需进行，每周处理 2-3 个 ADR
- 优先处理高频使用的 ADR
- 收集用户反馈持续改进

---

#### 任务 2：测试增强

**目标**：提升测试覆盖率和测试质量

**具体工作**：
1. 增加测试断言数量
2. 添加边界条件测试
3. 补充负面测试用例
4. 优化测试性能

**执行方式**：
- 在每次 ADR 对齐时同步改进
- 定期审查测试覆盖率报告
- 响应测试失败和缺陷

---

#### 任务 3：工具优化

**目标**：持续优化自动化工具

**具体工作**：
1. 改进健康报告准确性
2. 增加更多自动化检查
3. 优化脚本性能
4. 添加新的验证工具

**执行方式**：
- 根据实际使用反馈改进
- 每月评估工具效果
- 持续集成到 CI/CD

---

## 2. 时间表

```
Week 1-2: P0 紧急修复
├── Week 1: 文档格式问题 + 关系声明问题
└── Week 2: 测试映射问题 + Agent 配置问题

Week 3-6: Phase 3 运行层对齐
├── Week 3-5: Batch 1 (ADR-120/121/122)
└── Week 6: Batch 2 (ADR-123/124)

Week 7-9: Phase 4 结构层对齐
├── Week 7-8: Batch 1 (ADR-201/240)
└── Week 9: Batch 2 (ADR-210/220)

Week 10-12: Phase 5 技术层对齐
├── Week 10: ADR-301
├── Week 11: ADR-340/350
└── Week 12: ADR-360

Week 13: 最终验证与审批
├── 全量测试验证
├── 文档完整性检查
├── 生成最终报告
└── Architecture Board 审批
```

**总工期**：约 13 周（3 个月）

---

## 3. 人员分工建议

| 角色 | 职责 | 工作量 |
|------|------|--------|
| Architecture Guardian | 总协调、三态判定、最终审核 | 20% |
| ADR Reviewer | 文档格式检查、关系验证 | 25% |
| Test Generator | 测试生成、测试验证 | 25% |
| Documentation Maintainer | 文档维护、链接检查 | 15% |
| Human Reviewer | 人工审核、复杂决策 | 15% |

---

## 4. 验收标准

### 4.1 P0 完成标准

- ✅ 所有 32 个测试失败修复
- ✅ 测试通过率 100%
- ✅ 文档格式 100% 符合规范
- ✅ 关系声明 100% 双向一致
- ✅ 无循环依赖

### 4.2 Phase 3-5 完成标准

- ✅ 13 个 ADR 全部对齐到 Rule/Clause 结构
- ✅ 所有测试通过
- ✅ Front Matter 完整
- ✅ 关系声明准确
- ✅ 对齐清单更新

### 4.3 最终验收标准

- ✅ 43 个 ADR 100% 对齐
- ✅ 334+ 个测试 100% 通过
- ✅ 0 个格式违规
- ✅ 0 个关系不一致
- ✅ CI 全绿
- ✅ Architecture Board 批准

---

## 5. 风险管理

### 5.1 识别风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 修复引入新问题 | 中 | 高 | 每次修复后立即测试 |
| ADR 依赖关系复杂 | 高 | 中 | 使用关系映射分析 |
| 时间超期 | 中 | 中 | 按批次执行，可调整优先级 |
| 人力不足 | 低 | 高 | 合理使用 Agent 自动化 |

### 5.2 应急预案

**如果测试失败修复超期**：
- 降级策略：将部分测试标记为 L2 警告级别
- 创建跟踪 Issue 后续处理
- 不阻塞后续阶段执行

**如果 ADR 对齐超期**：
- 调整优先级：优先完成运行层和结构层
- 技术层可以推迟到下一个周期
- 确保核心架构规则先落地

---

## 6. 成功指标（KPI）

| 指标 | 当前值 | 目标值 | 衡量方式 |
|------|--------|--------|---------|
| ADR 对齐率 | 70% | 100% | 对齐清单统计 |
| 测试通过率 | 90.4% | 100% | CI 测试报告 |
| 文档格式合规率 | 约 80% | 100% | 格式检查脚本 |
| 关系一致性 | 约 95% | 100% | 关系检查脚本 |
| CI 通过率 | 100% | 100% | GitHub Actions |

---

## 7. 沟通计划

### 7.1 定期汇报

- **每周**：进度更新（更新对齐清单）
- **每批次**：完成报告（测试结果、问题记录）
- **每阶段**：里程碑报告（总结与反思）

### 7.2 决策升级

- **快速决策**：Guardian + Reviewer 协商
- **中等决策**：创建 Issue 讨论
- **重大决策**：提交 Architecture Board

### 7.3 知识共享

- 记录所有决策和理由
- 更新文档和示例
- 分享经验教训

---

## 8. 检查清单

### P0 阶段检查清单

- [ ] 18 个文档格式问题修复
- [ ] 5 个关系声明问题修复
- [ ] 7 个测试映射问题修复
- [ ] 2 个 Agent 配置问题修复
- [ ] 所有测试通过（100%）
- [ ] 验证报告更新

### Phase 3 检查清单

- [ ] ADR-120/121/122 对齐完成
- [ ] ADR-123/124 对齐完成
- [ ] 所有运行层测试通过
- [ ] 对齐清单更新
- [ ] 关系映射更新

### Phase 4 检查清单

- [ ] ADR-201/240 对齐完成
- [ ] ADR-210/220 对齐完成
- [ ] 所有结构层测试通过
- [ ] 对齐清单更新
- [ ] 关系映射更新

### Phase 5 检查清单

- [ ] ADR-301/340/350/360 对齐完成
- [ ] 所有技术层测试通过
- [ ] 对齐清单更新
- [ ] 关系映射更新

### 最终检查清单

- [ ] 43 个 ADR 100% 对齐
- [ ] 所有测试 100% 通过
- [ ] 文档完整性验证
- [ ] CI 全绿验证
- [ ] 最终报告生成
- [ ] Architecture Board 审批

---

**文档制定**：Copilot Agent  
**审核状态**：待 Architecture Board 审核  
**生效日期**：待批准后生效
