# 测试失败问题跟踪清单

> **创建日期**：2026-02-04  
> **版本**：1.0  
> **状态**：待修复  
> **基于**：阶段 5 全量测试结果

---

## 📊 概览

| 项目 | 数值 |
|------|------|
| 总测试数 | 334 |
| 通过测试 | 302 (90.4%) |
| 失败测试 | 32 (9.6%) |
| 测试执行时间 | 3.57 秒 |

---

## 🔴 失败测试详细清单

### 1. 文档格式问题（18 个失败）

#### 1.1 README 文档问题（4 个）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 1 | ADR-910_1_2: 禁用裁决性语言规则 | ADR-910 | README 文档使用了裁决性语言 | P0 | 2h |
| 2 | ADR-910_1_3: 必须包含无裁决力声明 | ADR-910 | README 缺少无裁决力声明 | P0 | 1h |
| 3 | ADR-910_1_3: 核心治理原则已定义 | ADR-910 | README 未定义核心治理原则 | P0 | 2h |
| 4 | ADR-910_2_1: README 引用 ADR 的规范 | ADR-910 | README 引用 ADR 格式不规范 | P0 | 1h |

**修复建议**：
- 使用 documentation-maintainer agent 批量检查所有 README.md
- 添加标准的无裁决力声明模板
- 规范 ADR 引用格式为 `[ADR-XXX](path/to/adr)`
- 移除或改写裁决性语言

---

#### 1.2 关系声明区问题（5 个）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 5 | ADR-947_1_1: ADR 必须且仅能包含一个顶级关系声明章节 | ADR-947 | 某些 ADR 缺少或有多个关系声明章节 | P0 | 2h |
| 6 | ADR-947_2_1: 关系声明区内容必须仅为列表项 | ADR-947 | 关系声明区包含非列表内容 | P0 | 2h |
| 7 | ADR-947_3_1: 非关系声明区禁止出现具体 ADR 编号 | ADR-947 | ADR 编号出现在不该出现的位置 | P0 | 3h |
| 8 | ADR-947_4_1: 同一 ADR 编号只能对应一个文件 | ADR-947 | 可能存在重复的 ADR 编号 | P0 | 1h |
| 9 | ADR-947_5_1: 禁止显式循环依赖声明 | ADR-947 | 存在循环依赖声明 | P0 | 2h |

**修复建议**：
- 使用 adr-reviewer agent 扫描所有关系声明区
- 确保每个 ADR 有且仅有一个 "## Relationships" 章节
- 将关系区内的非列表内容移到其他章节
- 使用链接格式引用 ADR，避免裸编号
- 运行循环依赖检测脚本并修复

---

#### 1.3 案例文档问题（3 个）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 10 | ADR-951_2_1: 案例文档必须包含所有必需章节 | ADR-951 | 案例文档缺少必需章节 | P1 | 3h |
| 11 | ADR-951_2_2: 案例文档必须标记案例级别 | ADR-951 | 案例文档未标记级别 | P1 | 1h |
| 12 | ADR-951_2_3: 代码示例必须包含必要注释和引用 | ADR-951 | 代码示例缺少注释 | P1 | 2h |

**修复建议**：
- 检查 `docs/cases/` 目录下的所有案例文档
- 补充缺失的章节（Context, Solution, Outcome 等）
- 在 Front Matter 中添加 `level: basic|intermediate|advanced`
- 为代码示例添加注释和 ADR 引用

---

#### 1.4 工程标准文档问题（3 个）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 13 | ADR-952_1_1: 工程标准必须符合三层架构定义 | ADR-952 | 工程标准文档层级定义不清 | P1 | 2h |
| 14 | ADR-952_2_1: 工程标准必须明确声明基于的 ADR | ADR-952 | 工程标准未声明基于的 ADR | P1 | 1h |
| 15 | ADR-952_2_4: 工程标准文档必须包含必需章节 | ADR-952 | 工程标准文档缺少章节 | P1 | 2h |

**修复建议**：
- 检查 `docs/engineering-standards/` 目录
- 明确标注文档属于哪一层（ADR/工程标准/操作指南）
- 在文档开头添加 "基于 ADR-XXX" 声明
- 补充必需章节（Purpose, Scope, Standards 等）

---

#### 1.5 其他文档问题（3 个）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 16 | ADR-008_1_2: 只有 ADR 具备裁决力 | ADR-008 | 非 ADR 文档包含裁决性语言 | P1 | 2h |
| 17 | ADR-901_1_1: 风险表达必须使用三态语义模型 | ADR-901 | 文档未使用三态模型表达风险 | P1 | 2h |
| 18 | ADR-901_2_3: Constraint/Warning 必须显式声明执行级别 | ADR-901 | 约束未声明 L1/L2 级别 | P1 | 2h |

**修复建议**：
- 审查所有非 ADR 文档，移除裁决性语言
- 将风险表达改为 Allowed/Blocked/Uncertain 三态
- 为所有约束添加 `[L1]` 或 `[L2]` 标记

---

### 2. 测试映射问题（7 个失败）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 19 | ADR-900_1_1: 每条 ADR 必须有且仅有唯一对应的架构测试类 | ADR-900 | 部分 ADR 缺少测试类 | P0 | 4h |
| 20 | ADR-900_1_2: 架构测试类必须包含最少断言数（反作弊） | ADR-900 | 部分测试类断言太少 | P1 | 3h |
| 21 | ADR-907_1_2: 具备裁决力的 ADR 必须有测试或声明 Non-Enforceable | ADR-907 | ADR 缺少测试或声明 | P0 | 3h |
| 22 | ADR-907_2_6: 失败信息必须包含 ADR 引用 | ADR-907 | 测试失败消息缺少 ADR 引用 | P1 | 2h |
| 23 | ADR-907_3_3: 失败信息必须可溯源到 ADR | ADR-907 | 失败消息不可溯源 | P1 | 2h |
| 24 | ADR-907_4_2: 测试失败必须映射到 RuleId | ADR-907 | 失败消息缺少 RuleId | P1 | 2h |
| 25 | ADR-907_4_5: Analyzer 必须能检测违规 | ADR-907 | Analyzer 未正确检测违规 | P1 | 3h |

**修复建议**：
- 使用 test-generator agent 识别缺失的测试类
- 为缺失测试的 ADR 创建测试类骨架
- 增加测试断言数量（每个测试类至少 3 个断言）
- 更新测试失败消息模板：`ADR-XXX_Y_Z: <描述>`
- 检查和修复 Analyzer 规则

---

### 3. 关系声明问题（5 个失败）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 26 | ADR-940.3: ADR 关系必须双向一致(DependsOn/DependedBy) | ADR-940 | DependsOn 关系不一致 | P0 | 3h |
| 27 | ADR-940.3: ADR 关系必须双向一致(Supersedes/SupersededBy) | ADR-940 | Supersedes 关系不一致 | P0 | 2h |
| 28 | ADR-940.4: ADR 依赖关系不得存在循环 | ADR-940 | 存在循环依赖 | P0 | 2h |
| 29 | ADR-947_1_1: ADR 必须且仅能包含一个顶级关系声明章节 | ADR-947 | 关系章节缺失或重复 | P0 | 2h |
| 30 | ADR-947_2_1: 关系声明区内容必须仅为列表项 | ADR-947 | 关系区包含非列表内容 | P0 | 2h |

**修复建议**：
- 运行 `scripts/check-relationship-consistency.sh` 识别问题
- 使用 adr-reviewer agent 生成关系不一致报告
- 手动修正关系声明（确保双向一致）
- 运行循环依赖检测并消除循环
- 更新 ADR-RELATIONSHIP-MAP.md

---

### 4. Agent 配置问题（2 个失败）

| # | 测试名称 | ADR | 问题描述 | 优先级 | 估计工作量 |
|---|----------|-----|----------|--------|-----------|
| 31 | Instructions/Agents 必须声明权威依据 | ADR-007 | Instructions 缺少权威依据 | P0 | 2h |
| 32 | ADR-007_1_2: Agent 必须声明权威边界 | ADR-007 | Agent 边界声明不完整 | P0 | 2h |

**修复建议**：
- 审查所有 `.github/instructions/*.yaml` 文件
- 添加 `authority` 字段，引用相关 ADR
- 补充 `scope` 和 `limitations` 字段
- 示例：
  ```yaml
  authority:
    - ADR-007: Agent 行为与权限宪法
    - ADR-900: 架构测试执法基础设施
  scope:
    - 架构测试生成和验证
  limitations:
    - 不可修改 ADR 正文
    - 需人工审核生成的测试
  ```

---

## 📈 进度跟踪

### 按优先级统计

| 优先级 | 数量 | 占比 |
|--------|------|------|
| P0 | 19 | 59% |
| P1 | 13 | 41% |
| **总计** | **32** | **100%** |

### 按问题类型统计

| 类型 | 数量 | 占比 |
|------|------|------|
| 文档格式 | 18 | 56% |
| 测试映射 | 7 | 22% |
| 关系声明 | 5 | 16% |
| Agent 配置 | 2 | 6% |
| **总计** | **32** | **100%** |

### 估计总工作量

| 优先级 | 工作量 |
|--------|--------|
| P0 | 约 38 小时（5 天） |
| P1 | 约 28 小时（3.5 天） |
| **总计** | **约 66 小时（8-9 天）** |

---

## ✅ 修复检查清单

### 文档格式修复

- [ ] 所有 README 包含无裁决力声明
- [ ] 所有 README 移除裁决性语言
- [ ] 所有 README ADR 引用格式规范
- [ ] 所有 ADR 有且仅有一个关系声明章节
- [ ] 关系声明区仅包含列表项
- [ ] ADR 编号不在非关系区出现
- [ ] 案例文档包含所有必需章节
- [ ] 案例文档标记级别
- [ ] 代码示例包含注释和引用
- [ ] 工程标准符合三层架构
- [ ] 工程标准声明基于的 ADR
- [ ] 工程标准包含必需章节
- [ ] 非 ADR 文档移除裁决性语言
- [ ] 风险表达使用三态模型
- [ ] 约束声明执行级别

### 测试映射修复

- [ ] 所有 ADR 有对应测试类
- [ ] 测试类包含足够断言
- [ ] ADR 声明 Non-Enforceable（如不可测试）
- [ ] 测试失败消息包含 ADR 引用
- [ ] 测试失败消息可溯源
- [ ] 测试失败映射到 RuleId
- [ ] Analyzer 正确检测违规

### 关系声明修复

- [ ] DependsOn 关系双向一致
- [ ] Supersedes 关系双向一致
- [ ] 无循环依赖
- [ ] 关系章节格式正确
- [ ] ADR-RELATIONSHIP-MAP 已更新

### Agent 配置修复

- [ ] 所有 Instructions 声明权威依据
- [ ] 所有 Agent 声明边界

### 最终验证

- [ ] 运行完整测试套件（100% 通过）
- [ ] 运行一致性检查脚本（无错误）
- [ ] 更新验证报告
- [ ] Architecture Board 审核通过

---

## 📝 修复记录模板

每次修复后，请记录：

```markdown
### 修复记录 - [日期]

**修复人**：[姓名/Agent]
**修复测试**：[测试名称列表]
**修复方式**：[简要描述]
**验证结果**：[通过/失败]
**遗留问题**：[如有]
```

---

**文档创建**：Copilot Agent  
**审核状态**：待执行  
**下次更新**：修复进行时
