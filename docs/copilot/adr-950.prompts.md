# ADR-950 Copilot Prompts：指南与 FAQ 文档治理

> ⚠️ **权威声明**  
> 本文档不具备裁决权，仅提供场景化指导。  
> 所有架构决策以 [ADR-950 正文](../adr/governance/ADR-950-guide-faq-documentation-governance.md) 为准。

**版本**：1.0  
**最后更新**：2026-01-26  
**关联 ADR**：ADR-950  
**用途**：为 GitHub Copilot 提供文档分类和编写场景的具体指导

---

## 概述

本文件为 GitHub Copilot 提供关于非裁决性文档（Guide、FAQ、Case、Standard）与 ADR 分离边界的场景化指导。

**核心原则（来自 ADR-950）**：
- ADR 定义"是什么"和"必须/禁止"
- Guide 解释"怎么做"
- FAQ 解答"为什么"和"如何理解"
- Case 展示"实践示例"
- 非裁决性文档不得定义新架构规则

---

## 场景 1：判断应该创建 ADR 还是 Guide

### 用户问："我应该创建 ADR 还是 Guide？"

**Copilot 应该**：

根据 ADR-950.2 的分离边界，帮助判断：

| 内容类型 | 应该创建 |
|---------|---------|
| 定义架构约束、引入新术语、需要测试的规则 | ADR |
| 解释如何应用 ADR、操作步骤、工具使用 | Guide |
| 解答常见疑问、澄清概念、快速参考 | FAQ |
| 记录实践示例、成功案例、问题解决 | Case |

**判断标准**：

```
✅ 应该写 ADR：
- 定义新的架构约束（如"模块必须隔离"）
- 引入新术语（如"垂直切片"）
- 需要架构测试执行的规则
- 不可协商的决策

✅ 应该写 Guide：
- 解释如何实现 ADR 的规则（如"如何实现模块隔离"）
- 多步骤操作流程（如"如何创建新模块"）
- 工具使用教程（如"如何运行架构测试"）

✅ 应该写 FAQ：
- 回答"为什么要这样设计"
- 澄清容易混淆的概念
- 常见错误和解决方法

✅ 应该写 Case：
- 真实项目案例
- 问题排查过程
- 最佳实践示例
```

**示例判断**：

```markdown
❓ 问题：我想写一个关于"模块隔离"的文档

如果内容是：
- "模块必须隔离，禁止直接引用" → ADR
- "如何实现模块隔离：步骤 1、2、3" → Guide
- "为什么模块要隔离？如何判断是否违反？" → FAQ
- "Orders 模块隔离的实现案例" → Case
```

---

## 场景 2：编写 Guide 时避免定义规则

### 用户说："我在写 Guide，想说明模块隔离规则"

**Copilot 应该**：

根据 ADR-950.2，Guide 不得定义新规则，只能引用 ADR。

**❌ 错误方式**（在 Guide 中定义规则）：

```markdown
# 模块开发指南

## 模块隔离规则

模块必须遵循：
1. 禁止跨模块直接引用
2. 使用事件进行通信
3. 不共享领域模型
```

**问题**：Guide 不应定义规则，这些规则应在 ADR 中。

**✅ 正确方式**（引用 ADR 并提供操作步骤）：

```markdown
# 模块开发指南

> ⚠️ 本文档不具备裁决力。所有架构规则以对应 ADR 为准。

## 如何实现模块隔离

根据 [ADR-0001](../adr/constitutional/ADR-0001-modular-monolith-vertical-slice-architecture.md)，
模块必须隔离。以下是实现步骤：

### 步骤 1：创建模块目录结构
```bash
mkdir -p src/Modules/YourModule/{UseCases,Domain,Contracts}
```

### 步骤 2：定义模块契约
（具体步骤...）

### 步骤 3：实现领域逻辑
（具体步骤...）

详细约束请参考 [ADR-0001](链接)
```

**关键原则**：
- ✅ 使用"根据 ADR-XXXX"明确引用
- ✅ 提供具体操作步骤
- ✅ 说明"怎么做"而非"必须做"
- ❌ 不定义新规则

---

## 场景 3：编写 FAQ 解答问题

### 用户说："我想写 FAQ 解释为什么要模块隔离"

**Copilot 应该**：

FAQ 应该：
- 回答"为什么"问题
- 澄清概念
- 提供快速参考
- 但不覆盖 ADR 决策

**标准 FAQ 格式**：

```markdown
# 架构常见问题

> ⚠️ 本文档不具备裁决力。所有架构决策以对应 ADR 为准。

## Q1：为什么模块必须隔离？

**参考 ADR**：[ADR-0001](链接)

**回答**：

模块隔离的目的是：
1. 降低耦合度，便于独立演进
2. 明确边界，避免意外依赖
3. 提高可测试性

详细规则和约束请参考 [ADR-0001](链接)。

---

## Q2：如何判断是否违反模块隔离？

**参考 ADR**：[ADR-0001](链接)

**回答**：

违反模块隔离的典型信号：
- ❌ 在一个模块中 `using` 另一个模块的 `Domain` 命名空间
- ❌ 跨模块直接调用方法
- ❌ 共享领域模型对象

如何验证：运行架构测试 `ADR_0001_Architecture_Tests`

详细判定规则请参考 [ADR-0001](链接)。
```

**关键原则**：
- ✅ 每个问题引用对应的 ADR
- ✅ 提供简洁的回答
- ✅ 指向详细文档
- ❌ 不定义新规则或覆盖 ADR

---

## 场景 4：编写 Case 记录实践案例

### 用户说："我想记录 Orders 模块的实现案例"

**Copilot 应该**：

Case 应该：
- 记录真实实现
- 展示最佳实践
- 提供可参考的代码
- 说明决策过程

**标准 Case 格式**：

```markdown
# Case：Orders 模块模块隔离实现

> ⚠️ 本文档是实践案例，不具备裁决力。架构规则以对应 ADR 为准。

**参考 ADR**：[ADR-0001](链接)

---

## 背景

Orders 模块需要与 Members 模块通信以验证会员身份，但必须遵守模块隔离约束。

## 解决方案

根据 ADR-0001，我们采用领域事件进行通信：

### 1. 定义事件契约
```csharp
// src/Modules/Members/Contracts/Events/MemberVerifiedEvent.cs
public record MemberVerifiedEvent(Guid MemberId, bool IsActive);
```

### 2. Members 模块发布事件
```csharp
// 在 Members 模块中
await _eventBus.PublishAsync(new MemberVerifiedEvent(memberId, true));
```

### 3. Orders 模块订阅事件
```csharp
// 在 Orders 模块中
public class MemberVerifiedHandler : IEventHandler<MemberVerifiedEvent>
{
    // 处理逻辑
}
```

## 经验教训

1. ✅ 使用事件避免了直接依赖
2. ✅ 契约定义在 Contracts 目录，便于共享
3. ⚠️ 注意事件的最终一致性

## 相关资源

- [ADR-0001：模块隔离规则](链接)
- [跨模块通信指南](链接)
```

**关键原则**：
- ✅ 记录真实案例
- ✅ 说明为什么这样做（引用 ADR）
- ✅ 提供代码示例
- ✅ 分享经验教训

---

## 场景 5：处理 Guide/FAQ 与 ADR 冲突

### 用户说："Guide 中的说明与 ADR 不一致"

**Copilot 应该**：

根据 ADR-950.4，发现冲突时：

1. **明确权威**：
```
如果 Guide/FAQ 与 ADR 冲突，以 ADR 为准（ADR-950.4）。

Guide/FAQ 必须修正以匹配 ADR，而非相反。
```

2. **提供修正流程**：
```markdown
## 修正冲突清单

- [ ] 确认 ADR 的当前版本和规则
- [ ] 更新 Guide/FAQ 以匹配 ADR
- [ ] 在 Guide/FAQ 中明确引用 ADR 版本
- [ ] 如 ADR 需要修改，走 RFC 流程
- [ ] 提 Issue 标记为 `documentation-inconsistency`
```

3. **示例修正**：

**冲突场景**：
```
ADR-0001 说："模块禁止直接引用"
Guide 说："特殊情况下可以直接引用"
```

**修正**：
```markdown
Guide 应该改为：
根据 [ADR-0001](链接)，模块禁止直接引用。
如有特殊需求，需要提交 RFC 修改 ADR，不得绕过。

详细破例流程请参考 [ADR-900：破例机制](链接)。
```

---

## 常见错误和修正

### ❌ 错误 1：Guide 中定义新规则

**错误示例**：
```markdown
# 模块开发指南

## 架构约束
模块必须遵循以下规则：
1. 使用 CQRS 模式
2. Handler 返回 void
```

**问题**：Guide 不应定义规则

**修正**：
```markdown
# 模块开发指南

> ⚠️ 本文档不具备裁决力。所有架构规则以对应 ADR 为准。

## 如何应用架构约束

根据 [ADR-0005](链接)，模块使用 CQRS 模式。以下是实现步骤：

步骤 1：创建 Command Handler...
```

---

### ❌ 错误 2：FAQ 覆盖 ADR 决策

**错误示例**：
```markdown
## Q：可以跨模块直接调用吗？

A：在某些情况下可以，比如紧急修复时。
```

**问题**：FAQ 不能覆盖 ADR 的强制规则

**修正**：
```markdown
## Q：可以跨模块直接调用吗？

**参考 ADR**：[ADR-0001](链接)

A：根据 ADR-0001，模块禁止直接调用。
如有例外情况，必须走破例流程（参考 ADR-900）。
```

---

### ❌ 错误 3：文档放置位置错误

**错误示例**：
```
操作指南放在 docs/adr/ 目录
```

**问题**：文档类型与目录不匹配

**修正**：
```
正确的目录结构：
docs/
├── adr/              ← ADR（裁决性文档）
├── guides/           ← Guide（操作指南）
├── faqs/             ← FAQ（常见问题）
├── cases/            ← Case（实践案例）
└── engineering-standards/  ← Standard（工程标准）
```

---

## 工具和命令速查

| 任务 | 位置 | 说明 |
|------|------|------|
| 创建 Guide | `docs/guides/` | 操作指南 |
| 创建 FAQ | `docs/faqs/` | 常见问题 |
| 创建 Case | `docs/cases/` | 实践案例 |
| 审计文档 | 运行定期审计流程 | 检查与 ADR 一致性 |

---

## 参考资料

- [ADR-950 正文](../adr/governance/ADR-950-guide-faq-documentation-governance.md) - 权威规则
- [文档结构指南](../guides/documentation-structure.md) - 目录组织
- [P0 实施总结](../summaries/p0-adr-implementation-summary.md) - 实施背景

---

## 版本历史

| 版本 | 日期 | 变更说明 |
|------|------|---------|
| 1.0 | 2026-01-26 | 初始版本 |

---

**维护**：架构委员会  
**审核**：@douhuaa  
**状态**：✅ Active
