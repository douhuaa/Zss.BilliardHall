# ADR-902 场景化指导

> ⚖️ **权威声明**: 若本文档与 ADR-902 正文冲突，以 ADR-902 正文为准。
> 基于 base.instructions.md

## 适用范围
ADR 模板结构与文档规范

## 权威依据
- ADR-902：ADR 标准模板与结构契约
- ADR-008：文档编写与维护宪法

## 引用优先级
ADR-902 正文 > 架构测试 > Copilot Prompts

---

## ADR 文档结构硬约束（ADR-902）

### Front Matter（必需，根据 ADR-902）
- ✅ ADR-902 要求：所有 ADR 都必须包含 YAML Front Matter（依据：ADR-902）
- ✅ ADR-902 要求：包含必需字段 adr, title, status, level等（依据：ADR-902）
- ❌ ADR-902 约束：status 只能是 Draft, Accepted, Final, Superseded
- ❌ ADR-902 约束：level 只能是 Constitutional, Governance, Structure, Runtime, Technical

📌 ADR-902 §3

### 必需章节（按顺序，依据 ADR-902）
1. Focus（聚焦内容）
2. Glossary（术语表）
3. Decision（裁决）
4. Enforcement（执法模型）
5. Non-Goals（明确不管什么）
6. Prohibited（约束行为，依据 ADR-902）
7. Relationships（关系声明）
8. References（非裁决性参考）
9. History（版本历史）

**约束（根据 ADR-902）**：
- ✅ ADR-902 要求：使用英文 Canonical Name（必须符合 ADR-902）
- ✅ ADR-902 允许：可以添加中文别名（如 ## Focus（聚焦内容））
- ❌ ADR-902 明确禁止：缺失、合并或重排章节（禁止依据 ADR-902）
- ❌ ADR-902 明确禁止：仅使用中文标题（禁止依据 ADR-902）

📌 ADR-902 §4

---

## 规则编号硬约束（ADR-902.1）

### 规则条目格式（根据 ADR-902.1）
- ✅ ADR-902.1 要求：每条规则都必须是独立的三级标题（依据 ADR-902.1）
- ✅ ADR-902.1 格式：### ADR-XXX.Y:L? <规则标题>（中文别名可选）
- ✅ ADR-902.1 要求：规则编号应连续（ADR-XXX.1, ADR-XXX.2, ...，依据 ADR-902.1）
- ❌ ADR-902.1 明确禁止：合并多条规则在一个章节（禁止依据 ADR-902.1）

📌 ADR-902 §1

---

## Decision 章节隔离（ADR-902.5）

### L2 指导原则（根据 ADR-902.5）
- ✅ ADR-902.5 要求：约束性规则只出现在 Decision 章节
- ⚠️ ADR-902.5 建议：其他章节避免使用裁决性语言（`必须`、`MUST`、`禁止`、`不允许`、`不得`、`SHALL NOT`）
- ✅ ADR-902.5 推荐：在 Focus、Glossary 等章节使用描述性语言

**例外**：
- 引用 ADR 时可以转述规则
- 引用块和代码块中的裁决性语言

📌 ADR-902 §5

---

## 危险信号（发现即 Blocked）

- 🚩 Front Matter 缺失或字段不全
- 🚩 status/level 值不在合法枚举中
- 🚩 缺少必需章节
- 🚩 章节顺序错误
- 🚩 仅使用中文章节标题
- 🚩 规则编号不连续或格式错误

处理方式：
- 标记 ⚠️ **Blocked**
- 引用 ADR-902 正文章节
- 引导查阅模板
- 不给变通方案

---

## 创建新 ADR 的检查清单

- [ ] 复制 ADR 模板
- [ ] 填写完整的 Front Matter（11个必需字段）
- [ ] 确保 status 和 level 值合法
- [ ] 包含所有9个必需章节（英文名称）
- [ ] 按固定顺序排列章节
- [ ] 在 Decision 章节使用独立编号的规则条目
- [ ] 规则格式：### ADR-XXX.Y:L? <规则标题>
- [ ] 创建对应的架构测试文件（如需要）
- [ ] 创建对应的 Copilot Prompts 文件
- [ ] 运行架构测试验证结构合规性

---

## 三态输出规则（根据 ADR-007）

根据 ADR-007 的要求，所有诊断都必须使用以下三态标识（依据 ADR-007）：

- ✅ Allowed
- ⚠️ Blocked
- ❓ Uncertain

并注明：**以 ADR-902 正文为最终权威**

---

## 参考

- `docs/adr/governance/ADR-902-adr-template-structure-contract.md`
- `src/tests/ArchitectureTests/ADR/ADR_902_Architecture_Tests.cs`

---

### 🔚 直说一句

> **ADR-902 的职责不是评判 ADR 内容的对错，
> 而是确保 ADR 具备"可被机器和人同时理解"的结构。**
