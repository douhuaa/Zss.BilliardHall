# ADR-901：ADR 编写与结构统一宪法 - Copilot 提示词库

**版本**：1.0  
**最后更新**：2026-01-27  
**对应 ADR**：[ADR-901](../adr/governance/ADR-901-adr-template.md)

---

## 一、当我在写什么时，你应该提醒我哪些约束？

### 场景 1：开发者想创建或修改 ADR

**触发条件**：

- 开发者开始编写新的 ADR 文档
- 开发者修改现有 ADR 文档
- 开发者询问"ADR 应该如何组织"

**你应该提醒**：

1. **ADR 必须使用统一模板结构**
   ```
   根据 ADR-901，所有 ADR 必须严格遵循以下章节顺序：
   
   1. YAML Front Matter（包含 adr/title/status/level/version 等）
   2. 标题与权威声明
   3. 聚焦内容（Focus）
   4. 术语表（Glossary）
   5. 裁决（Decision）
   6. 执法模型（Enforcement）
   7. 明确不管什么（Non-Goals）
   8. 禁止行为（Prohibited）
   9. 关系声明（Relationships）
   10. 非裁决性参考（References）
   11. 版本历史（History）
   
   ❌ 不允许随意增删或重排章节
   ```

2. **裁决只能写在 Decision 章节**
   ```
   ⚠️ 重要约束：
   
   ✅ 任何具有"必须/禁止/不允许/应当"语义的内容
      只能出现在 ## 裁决（Decision）章节中
   
   ❌ Focus、References、History 等章节
      仅用于说明，不得引入隐性规则
   
   错误示例：
   ## 聚焦内容（Focus）
   本 ADR 要求所有模块必须隔离  ← ❌ 这是裁决，不能放这里
   
   正确示例：
   ## 裁决（Decision）
   **ADR-XXX.1：模块隔离约束**
   所有模块**必须**隔离，禁止直接引用  ← ✅ 裁决放在这里
   ```

3. **必须显式声明 Non-Goals**
   ```
   每个 ADR 必须包含 ## 明确不管什么（Non-Goals）章节
   
   用于防止职责膨胀，明确说明：
   ❌ 本 ADR 不负责代码风格
   ❌ 本 ADR 不负责命名审美
   ❌ 本 ADR 不负责教学示例
   ❌ 本 ADR 不负责实现细节
   ```

4. **无法执法的规则视为无效**
   ```
   每个规则必须在 ## 执法模型（Enforcement）中声明执行方式
   
   格式：
   | 规则编号 | 执行级 | 测试/手段 |
   |---------|-------|-----------|
   | ADR-XXX.1 | L1 | 架构测试 |
   | ADR-XXX.2 | L2 | Code Review |
   
   ❌ 没有执法模型 = 等同未定义
   ```

5. **关系必须显式声明**
   ```
   ## 关系声明（Relationships）必须包含：
   
   **依赖（Depends On）**：
   - [ADR-XXX](path) - 说明为什么依赖
   
   **被依赖（Depended By）**：
   - [ADR-XXX](path) - 说明被哪些 ADR 依赖
   
   **替代（Supersedes）**：
   - [ADR-XXX](path) - 说明替代了哪个旧 ADR
   
   **被替代（Superseded By）**：
   - [ADR-XXX](path) - 说明被哪个新 ADR 替代
   
   **相关（Related）**：
   - [ADR-XXX](path) - 说明相关但不依赖的 ADR
   
   ❌ 禁止隐式血缘，所有关系必须显式声明
   ```

### 场景 2：开发者在 ADR 中使用模糊措辞

**触发条件**：

- 发现"建议""推荐""尽量""可以""通常""一般"等词
- 发现长篇背景故事或方案对比

**你应该提醒**：

```
⚠️ ADR-901 禁止行为：

❌ 使用模糊措辞（如"建议考虑""尽量"）
❌ 混入教程、示例代码、操作指南
❌ 长背景故事、方案对比表
❌ 用"共识""约定俗成"替代裁决

ADR 是系统的法律条文，不是架构师的解释说明。

正确的表达：
✅ 必须（MUST）
✅ 禁止（MUST NOT）
✅ 应当（SHALL）
✅ 不应（SHALL NOT）

如需说明背景，放在 References 章节，并明确标注"非裁决性参考"。
```

### 场景 3：开发者想在非 Decision 章节定义规则

**触发条件**：

- 在 Focus、Non-Goals、References 等章节使用"必须""禁止"
- 在代码示例或注释中引入约束

**你应该提醒**：

```
❌ ADR-901.2 违规：裁决只能写在 Decision 章节

你在 [章节名] 中使用了裁决性语言，这违反了 ADR-901。

请将所有约束移到：
## 裁决（Decision）

**ADR-XXX.N：规则标题**
[裁决内容]

其他章节仅用于：
- Focus：说明问题域
- Non-Goals：说明不负责什么
- References：提供背景材料
- History：记录演进历史

均不得引入新规则。
```

---

## 二、常见错误与修正

### 错误 1：没有 YAML Front Matter

**错误示例**：
```markdown
# ADR-XXX：标题

**状态**：Draft
```

**正确示例**：
```markdown
---
adr: ADR-XXX
title: "标题"
status: Draft
level: Governance
deciders: "Architecture Board"
date: 2026-01-27
version: "1.0"
maintainer: "Architecture Board"
reviewer: "待定"
supersedes: null
superseded_by: null
---

# ADR-XXX：标题
```

### 错误 2：底部重复元数据

**错误示例**：
```markdown
## 版本历史

| 版本 | 日期 | 变更说明 | 作者 |
|-----|------|---------|------|
| 1.0 | 2026-01-27 | 初始版本 | 作者 |

---

**维护**：Architecture Board
**审核**：@reviewer
**状态**：Draft
**版本**：1.0
```

**正确示例**：
```markdown
## 版本历史

| 版本 | 日期 | 变更说明 | 作者 |
|-----|------|---------|------|
| 1.0 | 2026-01-27 | 初始版本 | 作者 |
```

元数据只在 YAML front matter 中出现一次。

### 错误 3：章节顺序错误

**错误示例**：
```markdown
## 裁决（Decision）
[规则]

## 聚焦内容（Focus）  ← ❌ 顺序错误
[说明]
```

**正确示例**：
```markdown
## 聚焦内容（Focus）
[说明]

## 术语表（Glossary）
[术语]

## 裁决（Decision）
[规则]
```

严格按照 ADR-901 定义的顺序组织。

---

## 三、判定标准快速检查

使用以下清单快速检查 ADR 是否符合 ADR-901：

```
□ 有 YAML front matter（包含 adr/title/status/level/version 等）
□ 章节顺序正确（Focus → Glossary → Decision → Enforcement → ...）
□ 裁决只在 Decision 章节
□ 有 Non-Goals 章节
□ 每个规则在 Enforcement 中有执行方式
□ 关系声明完整（Depends On / Depended By / Supersedes / Related）
□ 没有模糊措辞（建议/推荐/尽量）
□ 没有底部重复元数据
□ 没有在非 Decision 章节引入规则
```

如果有任何一项未满足，该 ADR 不符合 ADR-901 标准。

---

## 四、相关资源

### 模板

- [ADR 模板](../templates/adr-template.md) - 符合 ADR-901 标准的模板
- [ADR-901 正文](../adr/governance/ADR-901-adr-template.md) - 完整规则定义

### 工具

- `scripts/adr-cli.sh create` - 使用标准模板创建 ADR
- `scripts/validate-adr-consistency.sh` - 验证 ADR 一致性
- `scripts/verify-adr-heading-semantics.sh` - 验证标题语义约束

### 相关 ADR

- [ADR-900：ADR 新增与修订流程](../adr/governance/ADR-900-adr-process.md)
- [ADR-940：ADR 关系与溯源管理](../adr/governance/ADR-940-adr-relationship-traceability-management.md)
- [ADR-946：ADR 标题级别即语义级别约束](../adr/governance/ADR-946-adr-heading-level-semantic-constraint.md)

---

## 五、判定输出模板

当评估 ADR 时，使用以下三态输出：

```
基于 ADR-901 的评估结果：

结构合规性：
□ YAML front matter: ✅ / ⚠️ / ❓
□ 章节顺序: ✅ / ⚠️ / ❓
□ Decision 章节: ✅ / ⚠️ / ❓

裁决完整性：
□ 规则位置正确: ✅ / ⚠️ / ❓
□ 有执法模型: ✅ / ⚠️ / ❓
□ 有 Non-Goals: ✅ / ⚠️ / ❓

治理就绪度：
□ 关系声明完整: ✅ / ⚠️ / ❓
□ 无模糊措辞: ✅ / ⚠️ / ❓
□ 无重复元数据: ✅ / ⚠️ / ❓

最终判定：✅ Allowed / ⚠️ Blocked / ❓ Uncertain

依据：ADR-901（ADR 编写与结构统一宪法）
```

---

**维护**：Architecture Board  
**对应 ADR**：[ADR-901](../adr/governance/ADR-901-adr-template.md)  
**版本**：1.0
