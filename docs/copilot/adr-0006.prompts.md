# ADR-0006 Copilot 提示词：术语与编号宪法

**适用场景**：新增 ADR、修订 ADR、架构讨论、术语澄清、编号选择

**权威依据**：[ADR-0006 术语与编号宪法](../adr/constitutional/ADR-0006-terminology-numbering-constitution.md)

---

## ⚖️ 核心提醒

**ADR-0006 的地位**：

- 📌 所有 ADR 的元规则（Meta-Rule）
- 📌 术语定义的唯一裁决源
- 📌 编号体系的宪法级规范
- 📌 架构测试、CI、PR 校验的语义基础

**一句话定位**：

> **没有 ADR-0006，编号不一致只能算"意见"，不算"违规"。**

---

## 场景 1：新增 ADR 时如何选择编号

### 用户意图

"我想创建一个新的 ADR，应该用什么编号？"

### Copilot 必须做的

1. **首先判断 ADR 性质**：
   ```
   请回答以下问题：
   1. 这个 ADR 是否定义系统根基/不可推翻的约束？
   2. 是否是治理流程/破例管理/测试规则？
   3. 是否是结构细化（命名、组织）？
   4. 是否是运行时细化（生命周期、事件）？
   5. 是否是技术选型/可替换实现？
   ```

2. **根据回答推荐编号段**：

| 如果是...           | 使用编号段              | 目录                | 示例         |
|------------------|--------------------|--------------------|------------|
| 系统根基/核心架构原则      | `ADR-0001~0009`    | `constitutional/`  | ADR-0007   |
| 治理/流程/破例管理      | `ADR-0000, 900~999` | `governance/`      | ADR-932    |
| 结构细化（命名、组织）      | `ADR-100~199`      | `structure/`       | ADR-125    |
| 运行时细化（生命周期、事件）   | `ADR-200~299`      | `runtime/`         | ADR-250    |
| 技术选型/可替换实现       | `ADR-300~399`      | `technical/`       | ADR-370    |

3. **检查编号是否已使用**：
   ```bash
   ls docs/adr/{constitutional,governance,structure,runtime,technical}/ | grep "ADR-XXXX"
   ```

4. **确认编号语义正确**：
   - ✅ 治理规则不使用 100~399
   - ✅ 技术规则不使用 900~999
   - ✅ 细化层不引入宪法级约束

### 示例对话

**开发者**："我想定义 Handler 的异常处理规则，应该用什么编号？"

**Copilot**：
```
根据 ADR-0006：

1. Handler 异常处理是**运行时行为细化**，不是系统根基
2. 推荐使用**运行层编号段**：ADR-200~299
3. 已使用编号：201, 210, 220, 240
4. 推荐编号：ADR-241, ADR-250, 或其他 200 段可用编号

建议：
- 创建文件：docs/adr/runtime/ADR-241-handler-exception-handling.md
- 更新索引：docs/adr/runtime/README.md
- 创建测试：src/tests/ArchitectureTests/ADR/ADR_0241_Architecture_Tests.cs
- 创建 Prompts：docs/copilot/adr-0241.prompts.md
```

---

## 场景 2：发现术语使用不一致

### 用户意图

"这个文档中的术语定义和 ADR-0001 不一样，应该以哪个为准？"

### Copilot 必须做的

1. **明确裁决源**：
   ```
   根据 ADR-0006 第 2 节"术语表（Glossary）"：
   
   ADR-0006 是术语定义的唯一裁决源。
   其他 ADR 或文档中的术语定义必须与 ADR-0006 一致。
   ```

2. **查阅 ADR-0006 术语表**：
   ```
   在 ADR-0006 术语表中查找该术语的权威定义。
   ```

3. **判定冲突**：
   - 如果 ADR-0006 有定义：以 ADR-0006 为准，修正其他文档
   - 如果 ADR-0006 无定义：建议走宪法层修订流程，添加到 ADR-0006

### 示例对话

**开发者**："ADR-0001 说'契约'是只读 DTO，但有文档说契约可以包含验证方法，哪个对？"

**Copilot**：
```
根据 ADR-0006 术语表：

**契约（Contract）**：只读、单向、版本化的数据 DTO，只用于模块间信息传递，不含业务决策

裁决：
❌ 契约不应包含验证方法（这是业务决策）
✅ 契约仅用于数据传递

行动：
1. 修正包含错误定义的文档
2. 如果有代码将验证方法放入 Contract，这是架构违规
3. 验证方法应在 Handler 或领域模型中

参考：ADR-0006 第 2 节术语表 - 架构模式术语
```

---

## 场景 3：检查 ADR 编号是否合规

### 用户意图

"我看到 ADR-350 定义了 PR 审查流程，这个编号合适吗？"

### Copilot 必须做的

1. **检查编号段语义**：
   - ADR-350 属于技术层（300~399）
   - PR 审查流程属于治理层

2. **判定违规**：
   ```
   ❌ 违规：ADR-0006 约束 2
   
   "治理规则禁止使用 100~399"
   
   原因：
   - ADR-350（技术层）不应定义治理规则
   - PR 审查流程应使用治理层编号（900~999）
   
   建议：
   - 将 ADR-350 重新编号为 ADR-931 或其他 900 段编号
   - 移动文件到 docs/adr/governance/
   - 更新所有引用
   ```

### 示例对话

**开发者**："我想在 ADR-120（结构层）中添加'模块间不可直接依赖'的规则，可以吗？"

**Copilot**：
```
❌ 不合适

根据 ADR-0006 约束 4：

"细化层不得引入宪法级约束"

原因：
- '模块间不可直接依赖'是系统根基约束
- 属于宪法层（ADR-0001 已定义）
- ADR-120（结构层）只能细化宪法层的结构约束，不能引入新的宪法级约束

建议：
- 如果是补充 ADR-0001 的细节，应修订 ADR-0001
- 如果是新的宪法级约束，应创建 ADR-0007~0009
- 走宪法层修订流程（架构委员会全体同意，2 周公示期）
```

---

## 场景 4：术语澄清与引用

### 常见术语混淆

#### 混淆 1：Contract vs Entity

**错误示例**：
```csharp
// ❌ 将 Entity 当 Contract 使用
public class OrderHandler
{
    public async Task<Order> Handle(CreateOrder command)
    {
        return order; // Order 是领域实体，不应跨模块传递
    }
}
```

**Copilot 纠正**：
```
根据 ADR-0006 术语表：

- **契约（Contract）**：只读、单向、版本化的数据 DTO
- **领域实体**：业务内聚的复杂类型，不允许跨模块共享

✅ 正确做法：
public class OrderHandler
{
    public async Task<Guid> Handle(CreateOrder command)
    {
        return order.Id; // 返回 ID（原始类型）
    }
}

// 或创建契约：
public record OrderContract(Guid Id, decimal Amount);
```

#### 混淆 2：宪法层 vs 治理层

**错误理解**："宪法层和治理层都很重要，有什么区别？"

**Copilot 澄清**：
```
根据 ADR-0006 第 3 节"编号分层规则"：

| 层级  | 编号段              | 定义内容         | 修订难度 |
|-----|------------------|--------------|------|
| 宪法层 | ADR-0001~0009    | 系统根基，不可推翻约束 | 极难   |
| 治理层 | ADR-0000, 900~999 | 治理、流程、破例管理  | 难    |

区别：
- **宪法层**：定义"系统应该是什么样"（如模块隔离、垂直切片）
- **治理层**：定义"如何确保遵守宪法"（如架构测试、PR 流程）

类比：
- 宪法层 = 法律条文
- 治理层 = 执法机制

修订难度：
- 宪法层需架构委员会全体同意，2 周公示期
- 治理层需 Tech Lead/架构师审批
```

---

## 场景 5：ADR 命名规范

### 用户意图

"ADR 文件名应该怎么写？"

### Copilot 必须告知

根据 ADR-0006 第 4 节"编号格式规则"：

**文件命名格式**：`ADR-XXXX-descriptive-title.md`

**规则**：
- ✅ 编号部分必须与 ADR 编号一致
- ✅ 标题部分使用小写字母和连字符
- ✅ 标题应简洁但具描述性
- ❌ 不要使用下划线或驼峰命名

**示例**：

| 编号       | 正确文件名                                        | 错误文件名                                   |
|----------|----------------------------------------------|------------------------------------------|
| ADR-0001 | `ADR-0001-modular-monolith-vertical-slice-architecture.md` | `ADR-1-ModularMonolith.md`               |
| ADR-120  | `ADR-120-domain-event-naming-convention.md`  | `ADR-0120-domain_event_naming.md`        |
| ADR-900 | `ADR-900-adr-process.md`                    | `ADR-900-adr-process.md`（缺少前导零）          |
| ADR-301  | `ADR-301-integration-test-automation.md`     | `ADR-0301-integration-test.md`（多余前导零）   |

**特别注意**：
- 宪法层（0001~0009）：**必须使用前导零**
- 其他层（100+）：**不使用前导零**

---

## 场景 6：修订 ADR-0006 本身

### 用户意图

"我发现需要添加一个新术语到 ADR-0006，应该怎么做？"

### Copilot 必须告知

**重要提醒**：ADR-0006 是宪法层 ADR，修订极其严格。

**流程（根据 ADR-900）**：

1. **确认必要性**：
   - 新术语是否在其他 ADR 已广泛使用？
   - 是否存在术语歧义导致的实际问题？
   - 是否可以通过修订其他 ADR 来解决？

2. **创建 RFC**：
   ```markdown
   # RFC：向 ADR-0006 添加新术语
   
   **术语名称**：XXX
   **定义**：...
   **使用场景**：...
   **与现有术语的关系**：...
   **影响分析**：会影响哪些 ADR 和文档
   ```

3. **公示与讨论**：
   - 提交到 GitHub Issues
   - 公示期：2 周（宪法层标准）
   - 记录所有讨论和决议

4. **架构委员会审批**：
   - 需全体一致同意
   - 评估对现有架构的影响

5. **三位一体交付**：
   - 更新 ADR-0006 正文
   - 更新相关测试（如有）
   - 更新本 Prompts 文件
   - 更新所有引用该术语的文档

6. **版本记录**：
   - 更新 ADR-0006 版本历史
   - 记录修订原因和影响范围

**警告**：
- ❌ 不要轻易修订 ADR-0006
- ❌ 不要为一时便利添加术语
- ❌ 不要在没有公示的情况下修改

---

## 场景 7：审查 PR 中的 ADR 编号

### 检查清单

当 PR 包含新 ADR 时，Copilot 应检查：

- [ ] **编号段正确**
  - 宪法级约束使用 0001~0009
  - 治理规则使用 0000 或 900~999
  - 结构细化使用 100~199
  - 运行时细化使用 200~299
  - 技术选型使用 300~399

- [ ] **编号未被使用**
  - 检查目录中是否已存在同编号文件
  - 检查 README 索引中是否已列出

- [ ] **文件命名正确**
  - 宪法层使用前导零（ADR-0001）
  - 其他层不使用前导零（ADR-120）
  - 使用连字符分隔单词

- [ ] **目录位置正确**
  - 宪法层在 `constitutional/`
  - 治理层在 `governance/`
  - 结构层在 `structure/`
  - 运行层在 `runtime/`
  - 技术层在 `technical/`

- [ ] **索引已更新**
  - 对应目录的 README.md 已添加
  - 主 ADR README.md 已更新

- [ ] **三位一体交付**
  - ADR 正文已创建
  - 架构测试已创建（如需要）
  - Copilot Prompts 已创建

### PR 评审模板

```markdown
## ADR-0006 合规性检查

**ADR 编号**：ADR-XXXX

### 编号段检查
- [ ] 编号段与内容层级匹配
- [ ] 编号未被使用
- [ ] 编号格式正确（前导零规则）

### 文件组织检查
- [ ] 文件名与编号一致
- [ ] 文件位于正确目录
- [ ] 目录 README 已更新
- [ ] 主 README 索引已更新

### 术语使用检查
- [ ] 术语使用与 ADR-0006 一致
- [ ] 无术语冲突或歧义

### 三位一体交付检查
- [ ] ADR 正文完整
- [ ] 架构测试已创建（如适用）
- [ ] Copilot Prompts 已创建

### 建议
- ...
```

---

## 常见错误与纠正

### 错误 1：编号段选择错误

**症状**：开发者将治理规则放入技术层

**示例**：
```
ADR-350：定义代码审查流程
```

**Copilot 纠正**：
```
❌ 违规：ADR-0006 约束 2

代码审查流程是治理规则，不应使用技术层编号（300~399）

✅ 正确做法：
- 使用治理层编号：ADR-931
- 移至 governance/ 目录
- 更新文件名：ADR-931-code-review-process.md
```

### 错误 2：前导零使用不一致

**症状**：宪法层不使用前导零，或其他层使用前导零

**示例**：
```
❌ ADR-1-modular-monolith.md（宪法层缺少前导零）
❌ ADR-0120-domain-event.md（结构层多余前导零）
```

**Copilot 纠正**：
```
根据 ADR-0006 第 4 节"编号格式规则"：

- 宪法层（0001~0009）：必须使用前导零
- 其他层（100+）：不使用前导零

✅ 正确：
- ADR-0001-modular-monolith.md（宪法层）
- ADR-120-domain-event.md（结构层）
```

### 错误 3：细化层引入宪法级约束

**症状**：在结构层/运行层/技术层 ADR 中定义核心架构约束

**示例**：
```
ADR-150：定义模块必须完全隔离（这是宪法级约束）
```

**Copilot 纠正**：
```
❌ 违规：ADR-0006 约束 4

"细化层不得引入宪法级约束"

原因：
- "模块必须完全隔离"是系统根基约束
- 已在 ADR-0001 定义
- 不应在 ADR-150（结构层）重复定义

✅ 正确做法：
- 如果是补充细节：修订 ADR-0001
- 如果是新的根基约束：走宪法层新增流程
- 如果是细化规则：引用 ADR-0001，不重新定义
```

---

## 快速参考

### 编号段速查表

| 我想定义...         | 使用编号段              | 目录                | 示例       |
|-----------------|--------------------|--------------------|----------|
| 模块隔离/核心架构原则     | `0001~0009`        | `constitutional/`  | ADR-0007 |
| 架构测试/CI/PR 流程  | `0000, 900~999`    | `governance/`      | ADR-932  |
| 命名规范/代码组织       | `100~199`          | `structure/`       | ADR-125  |
| 生命周期/事件/异常      | `200~299`          | `runtime/`         | ADR-250  |
| 日志/监控/集成测试      | `300~399`          | `technical/`       | ADR-370  |

### 术语速查表

| 术语           | 简要定义                 | 详见 ADR-0006     |
|--------------|----------------------|-----------------|
| 模块化单体        | 单进程，按业务能力划分独立模块      | 第 2 节 - 架构模式术语  |
| 垂直切片         | 单个业务用例为最小单元，横穿端到端    | 第 2 节 - 架构模式术语  |
| Contract     | 只读、单向、版本化的数据 DTO    | 第 2 节 - 架构模式术语  |
| Handler      | 业务用例的唯一决策实现          | 第 2 节 - 架构模式术语  |
| CQRS         | 命令-查询职责分离            | 第 2 节 - 架构模式术语  |
| Platform 层   | 技术能力专属层，不可感知业务       | 第 2 节 - 技术实现术语  |
| 架构测试         | 可自动执行的结构约束型测试        | 第 2 节 - 测试与治理术语 |
| 三位一体交付       | ADR + 测试 + Prompts 同步交付 | 第 2 节 - 测试与治理术语 |

---

## 总结

ADR-0006 是本架构体系的**元规则**，定义了：

1. **术语的唯一权威定义**：所有术语使用必须与 ADR-0006 一致
2. **编号的宪法级规范**：编号不再是约定，而是可执行的规则
3. **架构治理的语义基础**：测试、CI、PR 校验都依赖 ADR-0006

**Copilot 的职责**：

- ✅ 在新增 ADR 时，帮助开发者选择正确的编号
- ✅ 在发现术语歧义时，引用 ADR-0006 裁决
- ✅ 在 PR 评审时，检查 ADR-0006 合规性
- ✅ 在架构讨论时，统一术语使用

**记住**：

> **ADR-0006 让编号体系从"约定"升级为"宪法"。**

---

**相关 ADR**：
- [ADR-0006 术语与编号宪法（正文）](../adr/constitutional/ADR-0006-terminology-numbering-constitution.md)
- [ADR-0000 架构测试与 CI 治理](../adr/governance/ADR-0000-architecture-tests.md)
- [ADR-900 ADR 新增与修订流程](../adr/governance/ADR-900-adr-process.md)
