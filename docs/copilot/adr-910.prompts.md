# ADR-910 Copilot Prompts：README 编写与维护

> ⚠️ **权威声明**  
> 本文档不具备裁决权，仅提供场景化指导。  
> 所有架构决策以 [ADR-910 正文](../adr/governance/ADR-910-readme-governance-constitution.md) 为准。

**版本**：1.0  
**最后更新**：2026-01-25  
**关联 ADR**：ADR-910  
**用途**：为 GitHub Copilot 提供 README 编写场景的具体指导

---

## 概述

本文件为 GitHub Copilot 提供关于 README 编写的场景化示例和常见问题处理。

**核心原则（来自 ADR-910）**：
- README 是使用说明，不是架构裁决书
- README 只能指向 ADR，不能转述为命令
- README 引用 ADR，不替代 ADR
- README 必须声明无裁决力
- 裁决性语言受到严格限制

---

## 场景 1：编写新的 README

### 用户问："我需要为新模块写一个 README"

**Copilot 应该**：

1. **首先提供标准模板**：

```markdown
# 模块名称

⚠️ 本文档不具备裁决力。所有架构决策以对应 ADR 正文为准。

## 概述

[简短描述模块的功能和用途]

## 快速开始

### 前置条件

- [列出依赖]

### 使用示例

```bash
# 示例命令
dotnet run --project src/Modules/ModuleName
```

## 架构约束

本模块遵循以下架构规则：
- 根据 [ADR-0001](../../docs/adr/constitutional/ADR-0001-modular-monolith-vertical-slice-architecture.md)，模块采用垂直切片架构
- 根据 [ADR-0005](../../docs/adr/constitutional/ADR-0005-Application-Interaction-Model-Final.md)，使用 CQRS 模式

## 目录结构

```
ModuleName/
  ├── UseCases/          # 用例（垂直切片）
  ├── Domain/            # 领域模型
  └── Contracts/         # 对外契约
```

## 参考文档

- [ADR-0001: 模块化单体架构](../../docs/adr/constitutional/ADR-0001-modular-monolith-vertical-slice-architecture.md)
- [开发指南](../../docs/guides/module-development.md)
```

2. **强调关键点**：
   - ✅ 必须在开头添加简洁的"不具备裁决力"声明
   - ✅ 架构约束部分使用"根据 ADR-XXXX"引用
   - ✅ 提供链接而非复制 ADR 内容
   - ❌ 不要直接定义规则（如"模块必须隔离"）

---

## 场景 2：README 中描述架构约束

### 用户问："如何在 README 中说明模块隔离要求？"

**Copilot 应该**：

**❌ 错误方式 1**（直接定义规则）：

```markdown
## 架构约束

- 模块必须相互隔离
- 禁止跨模块直接引用
- 不允许共享领域对象
```

**理由**：README 没有裁决力，不应定义"必须"、"禁止"等规则。

**❌ 错误方式 2**（转述为命令）：

```markdown
## 架构约束

文档必须遵循以下规则：
- 模块应该使用事件通信
- Handler 需要遵循 CQRS 模式
```

**理由**：README 只能指向 ADR，不能转述为自己的命令。

**✅ 正确方式 1**（明确引用 ADR）：

```markdown
## 架构约束

根据 [ADR-0001](../../docs/adr/constitutional/ADR-0001-modular-monolith-vertical-slice-architecture.md)：
- 模块采用隔离架构
- 模块间通信使用事件和契约
- 详细规则请参考 ADR-0001

### 为什么这样设计？

模块隔离的详细原理和约束请参考 [ADR-0001](链接)。
```

**✅ 正确方式 2**（使用表格引用）：

```markdown
## 架构规则速查

| 规则       | 说明         | 依据 ADR                                     |
|----------|------------|-------------------------------------------|
| 模块隔离     | 模块之间不直接引用  | [ADR-0001](链接) |
| 事件通信     | 使用领域事件进行通信 | [ADR-0001](链接) |
| 垂直切片     | 按用例组织代码    | [ADR-0001](链接) |

详细约束和执行机制请参考各 ADR 文档。
```

**关键原则**：
- 使用"根据 ADR-XXXX"明确规则来源
- 提供 ADR 链接而非复制内容
- 说明"是什么"和"怎么用"，不说"为什么必须这样"
- **绝不转述为 README 自己的命令**

---

## 场景 3：README 中的代码示例

### 用户问："README 中的代码示例可以用 ✅ ❌ 标记吗？"

**Copilot 应该**：

**✅ 完全允许**，这是推荐的做法：

```markdown
## 代码示例

### 模块间通信

```csharp
// ✅ 正确：使用事件通信
public class OrderCreatedHandler
{
    public async Task Handle(OrderCreated @event)
    {
        await _eventBus.Publish(@event);
    }
}

// ❌ 错误：直接引用其他模块
using Zss.BilliardHall.Modules.Members.Domain; // 违反 ADR-0001
public class OrderHandler
{
    private readonly MemberRepository _repo; // 跨模块引用
}
```
```

**关键点**：
- ✅ 代码示例中可以自由使用 ✅ ❌ 标记
- ✅ 可以在注释中说明"违反 ADR-XXXX"
- ✅ 这是教学性标记，不是 README 定义的规则

---

## 场景 4：更新现有 README

### 用户问："现有 README 需要添加架构说明，怎么做？"

**Copilot 应该**：

**步骤 1**：检查是否有"无裁决力声明"

```markdown
# 如果没有，先添加声明（推荐使用简洁格式）
⚠️ 本文档不具备裁决力。所有架构决策以对应 ADR 正文为准。
```

**步骤 2**：添加架构约束章节（使用引用方式）

```markdown
## 架构约束

本模块遵循以下架构决策：

### 模块隔离
根据 [ADR-0001](链接)，本模块与其他模块完全隔离。

**示例**：
```csharp
// ✅ 正确：通过事件通信
await _eventBus.Publish(new OrderCreated(orderId));

// ❌ 错误：直接引用其他模块
// var member = await _memberRepo.GetById(memberId); 
```

详细规则请参考 [ADR-0001](链接)。
```

**步骤 3**：验证合规性

检查清单：
- [ ] 有"不具备裁决力"声明
- [ ] 架构约束使用"根据 ADR-XXXX"
- [ ] 没有直接使用"必须"、"禁止"（除非在引用 ADR 的上下文中）
- [ ] 提供 ADR 链接

---

## 场景 5：README 中的操作指南

### 用户问："README 中的操作步骤可以用'必须'吗？"

**Copilot 应该**：

**分两种情况**：

**情况 1**：技术操作步骤（✅ 允许）

```markdown
## 安装步骤

1. 必须安装 .NET 8.0 或更高版本
2. 必须配置 PostgreSQL 数据库
3. 必须运行数据库迁移

```bash
dotnet ef database update
```
```

**理由**：这是技术前提条件，不是架构规则。

**情况 2**：架构约束（❌ 不允许，需引用 ADR）

```markdown
❌ 错误：
## 开发约束

- 必须使用垂直切片架构
- 必须遵循 CQRS 模式

✅ 正确：
## 开发约束

本模块遵循以下架构约束：
- 根据 [ADR-0001](链接)，采用垂直切片架构
- 根据 [ADR-0005](链接)，使用 CQRS 模式

详细开发指南请参考 [ADR 文档](链接)。
```

**判断标准**：
- 技术操作/配置要求 → 可以用"必须"
- 架构设计/代码组织要求 → 引用 ADR

---

## 场景 6：README 违规修复

### 架构测试失败："README 使用了裁决性语言"

**Copilot 应该**：

**问题诊断**：

```
❌ ADR-910.4 违规：README 使用了裁决性语言
  • docs/modules/README.md:15 - 使用裁决词 '必须'
    内容: 模块必须使用事件进行通信
```

**修复步骤**：

1. **定位问题行**：

```markdown
# 修复前
模块必须使用事件进行通信，禁止直接引用。
```

2. **应用修复方案**（三选一）：

**方案 1**：引用 ADR

```markdown
# 修复后
根据 [ADR-0001](链接)，模块使用事件进行通信。
```

**方案 2**：使用描述性语言

```markdown
# 修复后
推荐使用事件进行模块间通信。详见 [ADR-0001](链接)。
```

**方案 3**：在表格中说明

```markdown
# 修复后
| 通信方式 | 说明 | 依据 |
|---------|------|------|
| 事件通信 | 模块间异步通信 | [ADR-0001](链接) |
```

3. **重新运行测试**：

```bash
dotnet test --filter "ADR_0910"
```

---

## 场景 7：创建工具/脚本 README

### 用户问："工具脚本的 README 需要声明吗？"

**Copilot 应该**：

**情况 1**：纯操作性 README（可豁免）

```markdown
# 数据库迁移脚本

## 使用方法

```bash
./migrate.sh up
./migrate.sh down
```

## 参数

- `up`: 应用迁移
- `down`: 回滚迁移
```

**理由**：只包含命令和参数说明，无架构内容，可豁免"无裁决力声明"。

**情况 2**：涉及架构的 README（需声明）

```markdown
# 架构分析工具

⚠️ 本文档不具备裁决力。所有架构决策以对应 ADR 正文为准。

## 功能

本工具用于分析模块依赖关系。

## 检测规则

工具基于以下 ADR 进行检测：
- [ADR-0001](链接)：模块隔离规则
- [ADR-0002](链接)：层级依赖规则

## 使用方法

```bash
./analyze.sh --module Orders
```
```

**判断标准**：
- 只有命令/参数 → 可豁免声明
- 涉及架构概念/规则 → 需要声明

---

## 常见错误与修复

### 错误 1：README 定义新术语

**错误**：

```markdown
## 术语

- **模块隔离**：模块之间不能直接引用，必须通过事件通信
```

**修复**：

```markdown
## 术语

术语定义请参考 [ADR-0006 术语表](链接)。

本文档使用以下关键术语：
- 模块隔离：详见 [ADR-0001](链接)
- 事件通信：详见 [ADR-0001](链接)
```

---

### 错误 2：README 转述为自己的命令

**错误方式 1**：

```markdown
## 开发规范

文档必须遵循以下规则：
- 模块应该使用事件通信
- Handler 需要遵循 CQRS 模式
```

**错误方式 2**：

```markdown
## 架构要求

开发者需要遵守以下约束：
1. 模块隔离
2. 垂直切片
3. 事件驱动
```

**修复**：

```markdown
## 开发规范

本模块遵循以下架构决策：
- 根据 [ADR-0001](链接)，模块使用事件通信
- 根据 [ADR-0005](链接)，Handler 遵循 CQRS 模式

详细规则和原理请参考各 ADR 文档。
```

---

### 错误 3：README 复制 ADR 内容

**错误**：

```markdown
## 模块隔离规则

根据架构约束，模块必须满足以下条件：
1. 不得直接引用其他模块的类型
2. 不得共享领域对象
3. 只能通过事件、契约和原始类型通信
... （长篇复制 ADR 内容）
```

**修复**：

```markdown
## 模块隔离规则

本模块遵循模块隔离架构。详细规则和原理请参考：
- [ADR-0001: 模块化单体架构](链接)

快速参考：
- 模块间通信使用事件和契约
- 详见 ADR-0001 第 3.2 节
```

---

### 错误 4：README 裁决架构问题

**错误**：

```markdown
## 代码审查

以下代码不符合架构规范：
```csharp
// 这个实现违反了模块隔离原则
```
```

**修复**：

```markdown
## 代码示例

以下是推荐的实现方式：
```csharp
// ✅ 推荐：使用事件通信（符合 ADR-0001）
await _eventBus.Publish(new OrderCreated(orderId));

// ❌ 不推荐：直接引用（参考 ADR-0001 了解原因）
// using Zss.BilliardHall.Modules.Members;
```

架构合规性由架构测试验证，详见 [ADR-0000](链接)。
```

---

## 快速检查清单

在提交 README 前，Copilot 应提醒用户检查：

### 内容清单
- [ ] 开头有"不具备裁决力"声明（除非是纯操作性 README）
- [ ] 架构约束使用"根据 ADR-XXXX"引用
- [ ] 没有直接定义新的架构规则或术语
- [ ] 提供 ADR 链接而非复制内容
- [ ] 代码示例使用 ✅ ❌ 标记清晰

### 语言清单
- [ ] 避免在正文中单独使用"必须"、"禁止"、"不允许"
- [ ] 如使用裁决性词汇，确保在引用 ADR 的上下文中
- [ ] 使用描述性语言："推荐"、"建议"、"可以"

### 链接清单
- [ ] 所有 ADR 引用都有正确的链接
- [ ] 链接使用相对路径
- [ ] 链接指向 ADR 正文文件

---

## Copilot 行为准则

当用户编写 README 时，Copilot 应该：

### ✅ 应该做的
- 主动提醒添加"不具备裁决力"声明
- 建议使用"根据 ADR-XXXX"引用规则
- 提供符合 ADR-910 的模板和示例
- 在代码补全时使用 ✅ ❌ 标记
- 检测到裁决性语言时提示修改

### ❌ 不应该做的
- 生成定义架构规则的内容
- 复制 ADR 内容到 README
- 使用裁决性语言而不引用 ADR
- 建议在 README 中做架构判断
- 忽略"不具备裁决力"声明的缺失

---

## 参考资源

- **ADR 正文（权威）**：[ADR-910](../adr/governance/ADR-910-readme-governance-constitution.md)
- **架构测试**：`src/tests/ArchitectureTests/ADR/ADR_0910_Architecture_Tests.cs`
- **相关 ADR**：
  - [ADR-0008: 文档编写与维护宪法](../adr/constitutional/ADR-0008-documentation-governance-constitution.md)
  - [ADR-0000: 架构测试与 CI 治理](../adr/governance/ADR-0000-architecture-tests.md)

---

## 版本历史

| 版本  | 日期         | 变更说明                               |
|-----|------------|-------------------------------------|
| 1.2 | 2026-01-25 | 更新所有示例使用新的简洁声明格式                  |
| 1.1 | 2026-01-25 | 强化场景 2：增加"转述为命令"的错误示例和说明         |
| 1.0 | 2026-01-25 | 初版，配合 ADR-910 创建 |

---

**维护**：架构委员会  
**审核**：@douhuaa  
**状态**：✅ Active
