# ADR 终极模板实施总结

> 本文档总结 ADR 终极模板的实施情况、设计决策和使用指南。

**创建日期**：2026-01-23  
**状态**：✅ 已完成核心模板和文档  
**下一步**：渐进式迁移现有 ADR

---

## 一、实施背景

### 问题陈述

现有 ADR 格式虽然已经相当完善，但存在以下可改进之处：

1. **规则与说明混杂**：决策段落包含规则、示例、说明，裁决源不够明确
2. **执法机制隐含**：【必须架构测试覆盖】标记分散，执法映射不够显式
3. **破例机制模糊**：破例条件和归还流程不够明确
4. **变更政策隐含**：ADR 修改流程散落在 ADR-0900 中，不够显式
5. **边界不清**：ADR 可能膨胀为教学文档或设计说明

### 目标

创建一个**可落地、不可滥用、三年后仍然成立的 ADR 终极模板**，满足：

1. **规则本体明确**：Rule 段落是唯一裁决源，不依赖作者解释
2. **执法机制显式**：Enforcement 段落明确如何执行规则
3. **破例机制完整**：Exception 段落明确破例条件和归还流程
4. **变更政策明确**：Change Policy 段落明确 ADR 修改和废弃流程
5. **边界清晰**：Non-Goals 段落防止 ADR 膨胀

### 核心理念

> **ADR 是系统的法律条文，不是架构师的解释说明。**

---

## 二、终极模板结构

### 六段式结构

```markdown
# ADR-XXXX：〈裁决型标题〉

**状态**：Draft | Accepted | Final | Superseded
**级别**：宪法层 | 决策层
**影响范围**：〈明确列出模块 / 层 / 仓库〉
**生效时间**：YYYY-MM-DD

## 1. Rule（规则本体｜裁决源）
## 2. Enforcement（执法模型）
## 3. Exception（破例与归还）
## 4. Change Policy（变更政策）
## 5. Non-Goals（明确不管什么）
## 6. References（非裁决性）
```

### 段落职责

| 段落            | 职责                     | 裁决力 | 长度限制  |
| ------------- | ---------------------- | --- | ----- |
| 1. Rule       | 定义不可协商的架构规则            | ✅   | ≤ 1 页  |
| 2. Enforcement | 定义如何执行规则（测试、工具、流程）     | ✅   | 无限制   |
| 3. Exception  | 定义破例条件和归还机制            | ✅   | 无限制   |
| 4. Change Policy | 定义 ADR 修改和废弃流程         | ✅   | 无限制   |
| 5. Non-Goals  | 定义 ADR 不负责的范围          | ✅   | 无限制   |
| 6. References | 提供理解性材料（术语、示例、历史）      | ❌   | 无限制   |

---

## 三、已交付成果

### 核心文档

1. **ADR-TEMPLATE-ULTIMATE.md**
   - 终极模板本体
   - 包含六段式结构和写作红线
   - 包含终极一句话定义

2. **ADR-TEMPLATE-GUIDE.md**（8000+ 字）
   - 详细的模板使用指南
   - 每个段落的写作要求和示例
   - 写作红线（禁止事项）
   - 质量检查清单
   - 常见错误示例

3. **ADR-TEMPLATE-MIGRATION.md**（9000+ 字）
   - 现有格式与终极模板的映射关系
   - 详细的迁移步骤
   - 迁移清单和质量保证
   - 批量迁移策略
   - 常见问题解答

4. **ADR-0000-architecture-tests-v2.md**
   - ADR-0000 的终极模板版本
   - 作为迁移示例

### 文档特点

* **长度充分**：GUIDE 和 MIGRATION 各 8000-10000 字，确保全面覆盖
* **示例丰富**：包含大量正确和错误示例对比
* **可操作性强**：提供清单、步骤、策略，而非仅概念
* **防御性设计**：明确写作红线，防止 ADR 被滥用

---

## 四、与现有格式的对比

### 现有格式（v1）优点

✅ 已经相当规范，有清晰的段落结构  
✅ 有【必须架构测试覆盖】标记  
✅ 有术语表和快速参考表  
✅ 有版本历史  

### 现有格式（v1）可改进之处

⚠️ 规则与说明混杂在"决策"段落  
⚠️ 执法机制分散，不够显式  
⚠️ 破例机制模糊  
⚠️ 变更政策隐含  
⚠️ 边界不清（易膨胀为教学文档）  

### 终极模板（v2）改进

✅ **规则本体独立**：Rule 段落仅含规则，≤ 1 页  
✅ **执法机制显式**：Enforcement 段落明确执法方式和测试映射  
✅ **破例机制完整**：Exception 段落明确条件和归还  
✅ **变更政策明确**：Change Policy 段落显式定义修改流程  
✅ **边界清晰**：Non-Goals 段落防止膨胀  
✅ **权威明确**：仅 Rule~Non-Goals 有裁决力，References 无裁决力  

---

## 五、迁移策略

### 推荐策略：混合式渐进迁移

**理由**：

* 现有 ADR 数量适中（7 个）
* 现有格式已经较好，迁移成本不高
* 可以快速统一格式，避免长期并存

**步骤**：

1. **第一周**：新建终极模板和使用指南（✅ 已完成）
2. **第二周**：迁移宪法层 ADR（ADR-0001~0005）
3. **第二周**：迁移治理层 ADR（ADR-0000, ADR-0900）
4. **持续**：新 ADR 严格使用终极模板

### 迁移清单

- [x] 创建终极模板（ADR-TEMPLATE-ULTIMATE.md）
- [x] 创建使用指南（ADR-TEMPLATE-GUIDE.md）
- [x] 创建迁移文档（ADR-TEMPLATE-MIGRATION.md）
- [x] 创建迁移示例（ADR-0000-v2）
- [ ] 迁移 ADR-0000（替换原文件）
- [ ] 迁移 ADR-0001
- [ ] 迁移 ADR-0002
- [ ] 迁移 ADR-0003
- [ ] 迁移 ADR-0004
- [ ] 迁移 ADR-0005
- [ ] 迁移 ADR-0900
- [ ] 更新 docs/adr/README.md
- [ ] 更新 constitutional/README.md
- [ ] 更新 governance/README.md
- [ ] 更新 Copilot prompts 引用
- [ ] 验证架构测试映射
- [ ] 运行全量架构测试

---

## 六、关键设计决策

### 决策 1：六段式结构

**理由**：

* **Rule**：裁决源，必须独立且简洁
* **Enforcement**：规则需要执法机制才有意义
* **Exception**：破例是架构债务，需要明确管理
* **Change Policy**：ADR 不是随意修改的文档
* **Non-Goals**：防止 ADR 膨胀为万能文档
* **References**：术语、示例、历史都在这里，但无裁决力

### 决策 2：Rule 段落 ≤ 1 页

**理由**：

* 强制作者提炼核心规则
* 防止 Rule 段落膨胀为设计说明
* 超过 1 页说明你在写说明文，不是规则

### 决策 3：MUST/MUST NOT 强制语气

**理由**：

* 规则必须不可协商
* 规则必须可判真伪
* "建议/推荐/尽量"不是规则

### 决策 4：Enforcement 显式映射

**理由**：

* 规则如果无法执法，就不配存在
* 执法机制必须显式定义（L1/L2/L3）
* 测试映射必须显式列出

### 决策 5：Exception 强制记录

**理由**：

* 破例不是逃避，而是债务
* 债务必须记录、必须有归还计划
* 未记录的破例 = 未授权违规

### 决策 6：References 无裁决力

**理由**：

* 明确权威边界
* 防止术语表、示例被当作规则
* 防止历史讨论影响当前裁决

---

## 七、与现有 ADR 的兼容性

### 完全兼容

✅ 现有 ADR 可以**平滑迁移**到终极模板  
✅ 现有架构测试**无需修改**（只需映射到 Enforcement 段落）  
✅ 现有 Copilot prompts **基本无需修改**（只需引用新段落）  
✅ 现有 ARCH-VIOLATIONS.md **无需修改**  

### 需要调整

⚠️ ADR 正文需要重构为六段式  
⚠️ 规则需要从"决策"中提取并精简  
⚠️ 术语表、示例需要移至 References  
⚠️ 破例机制需要补充完整  
⚠️ 变更政策需要显式定义  

---

## 八、质量保证

### 模板质量

* **长度充分**：GUIDE 8000+ 字，MIGRATION 10000+ 字
* **示例丰富**：包含大量正确和错误示例
* **可操作性强**：提供清单、步骤、策略
* **防御性设计**：明确写作红线

### 迁移质量

每个迁移后的 ADR 必须通过：

- [ ] Rule 段落 ≤ 1 页
- [ ] 全部使用 MUST/MUST NOT
- [ ] 没有示例代码
- [ ] 没有"建议/推荐/尽量"
- [ ] Enforcement 映射到具体测试
- [ ] Exception 机制完整
- [ ] Change Policy 明确
- [ ] Non-Goals 标注清晰
- [ ] References 标注"非裁决性"

---

## 九、后续工作

### 立即执行（本周）

1. ✅ 创建终极模板和文档（已完成）
2. [ ] 迁移 ADR-0000~0005（宪法层）
3. [ ] 迁移 ADR-0900（治理层）
4. [ ] 更新 README 导航

### 短期执行（本月）

1. [ ] 验证所有架构测试通过
2. [ ] 更新 Copilot prompts 引用
3. [ ] 团队培训和宣讲
4. [ ] 编写迁移后的质量审计报告

### 长期执行（持续）

1. [ ] 新 ADR 严格使用终极模板
2. [ ] 定期审计 ADR 质量
3. [ ] 根据实践反馈优化模板
4. [ ] 考虑编写自动化验证脚本

---

## 十、使用指导

### 新 ADR

**从现在开始，所有新 ADR 必须使用终极模板。**

步骤：

1. 复制 `ADR-TEMPLATE-ULTIMATE.md`
2. 阅读 `ADR-TEMPLATE-GUIDE.md`
3. 填写六段式结构
4. 使用质量检查清单验证
5. 提交 PR

### 现有 ADR

**现有 ADR 按计划渐进迁移。**

步骤：

1. 阅读 `ADR-TEMPLATE-MIGRATION.md`
2. 使用迁移清单迁移
3. 使用质量检查清单验证
4. 提交 PR

### Copilot

**Copilot 应引用终极模板生成和审查 ADR。**

Copilot 应：

* 使用终极模板生成新 ADR
* 使用写作红线检查 ADR
* 使用质量清单审查 ADR
* 拒绝不符合模板的 ADR

---

## 十一、常见问题

### Q1：必须立即迁移所有 ADR 吗？

**A**：不必。可以渐进迁移，优先迁移宪法层和治理层。

### Q2：迁移后架构测试需要修改吗？

**A**：架构测试本身不需要修改，只需在 ADR 的 Enforcement 段落中映射。

### Q3：Copilot prompts 需要大改吗？

**A**：不需要。只需引用新的段落名称（如 Rule、Enforcement）即可。

### Q4：现有 ADR 的 Git 历史会保留吗？

**A**：会。迁移是在原文件上更新，Git 历史完整保留。

### Q5：如何确保迁移质量？

**A**：使用质量检查清单 + Code Review + 自动化验证脚本。

---

## 十二、成功标准

### 立即成功标准（已达成）

- [x] 终极模板创建完成
- [x] 使用指南创建完成（8000+ 字）
- [x] 迁移文档创建完成（10000+ 字）
- [x] 迁移示例创建完成（ADR-0000-v2）

### 短期成功标准（本周）

- [ ] 所有宪法层 ADR 迁移完成
- [ ] 所有治理层 ADR 迁移完成
- [ ] README 导航更新完成
- [ ] Copilot prompts 引用更新完成

### 长期成功标准（持续）

- [ ] 新 ADR 100% 使用终极模板
- [ ] ADR 质量审计通过率 100%
- [ ] 团队成员熟练使用模板
- [ ] 无"说明文"式 ADR 出现

---

## 十三、总结

### 核心理念

> **ADR 是系统的法律条文，不是架构师的解释说明。**

### 终极目标

**让 ADR 成为**：

* 不依赖作者解释的裁决源
* 可自动执法的规则集
* 三年后仍然有效的架构宪法

### 现在可以开始

你现在可以：

1. ✅ 使用终极模板编写新 ADR
2. ✅ 按迁移清单迁移现有 ADR
3. ✅ 拒绝不符合模板的 ADR

**记住**：凡是不适合放进这个模板的内容，都不配叫 ADR。

---

## 附录：文档清单

### 核心文档

| 文件名                              | 用途           | 字数     | 状态 |
| -------------------------------- | ------------ | ------ | -- |
| ADR-TEMPLATE-ULTIMATE.md         | 终极模板本体       | 2000   | ✅  |
| ADR-TEMPLATE-GUIDE.md            | 详细使用指南       | 8000+  | ✅  |
| ADR-TEMPLATE-MIGRATION.md        | 迁移文档和对比      | 10000+ | ✅  |
| ADR-0000-architecture-tests-v2.md | 迁移示例         | 5000+  | ✅  |
| ADR-TEMPLATE-IMPLEMENTATION.md   | 本实施总结文档      | 5000+  | ✅  |

### 待更新文档

| 文件名                     | 更新内容               | 状态 |
| ----------------------- | ------------------ | -- |
| docs/adr/README.md      | 引用终极模板             | 📋 |
| constitutional/README.md | 说明新格式              | 📋 |
| governance/README.md    | 说明新格式              | 📋 |
| docs/copilot/*.prompts.md | 引用新段落名称（Rule 等）    | 📋 |
| ADR-0001~0005           | 迁移为终极模板            | 📋 |
| ADR-0000                | 迁移为终极模板（替换原文件）     | 📋 |
| ADR-0900                | 迁移为终极模板            | 📋 |

---

**创建日期**：2026-01-23  
**最后更新**：2026-01-23  
**负责人**：GitHub Copilot  
**审批人**：待定
