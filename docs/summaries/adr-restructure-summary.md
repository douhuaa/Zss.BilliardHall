# ADR 重组总结

**日期**：2026-01-21  
**版本**：2.0

---

## 背景

原有的 ADR-0001～0005 存在以下问题：

1. **内容重复和交叉**：关于模块隔离、依赖方向、启动层次等信息分散在多个 ADR 中
2. **层次边界不清**：层级内职责、禁止事项与治理机制混杂罗列
3. **自动化治理分布散**：架构测试与 CI 治理的内容在多处出现
4. **执行语义与静态结构耦合**：运行时交互模型和静态组织混杂

---

## 优化后的结构

### 三层分工

```
┌──────────────────────────────────────────────────────────────┐
│                    宪法层（ADR-0000 ~ 0005）                 │
│                 (不可推翻，只能细化，破例必审)               │
└──────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│ 静态结构层    │   │ 运行时行为层  │   │ 架构治理层    │
│   (WHAT)      │   │    (HOW)      │   │ (GUARDRAIL)   │
├───────────────┤   ├───────────────┤   ├───────────────┤
│ ADR-0001      │   │ ADR-0005      │   │ ADR-0000      │
│ 模块与切片    │   │ 交互模型      │   │ 架构测试      │
│               │   │               │   │               │
│ ADR-0002      │   │               │   │               │
│ 启动体系      │   │               │   │               │
│               │   │               │   │               │
│ ADR-0003      │   │               │   │               │
│ 命名空间      │   │               │   │               │
│               │   │               │   │               │
│ ADR-0004      │   │               │   │               │
│ 包管理        │   │               │   │               │
└───────────────┘   └───────────────┘   └───────────────┘
```

---

## 主要改进

### 1. 分工更清晰

| ADR      | 优化前主要内容                   | 优化后聚焦内容                |
|----------|---------------------------|------------------------|
| ADR-0001 | 模块组织 + 垂直切片 + 架构测试 + 命名空间 | **仅**模块组织与垂直切片         |
| ADR-0002 | 启动体系 + 命名空间 + 架构测试        | **仅**启动体系与层级模型         |
| ADR-0003 | 命名空间 + 架构测试               | **仅**命名空间与工程映射         |
| ADR-0004 | 包管理 + 架构测试                | **仅**中央包管理与依赖分层        |
| ADR-0005 | 运行时模型 + 架构测试 + 静态组织       | **仅**应用内运行模型（移除静态组织内容） |
| ADR-0000 | 架构测试基本定义                  | **汇总**所有架构测试与治理机制      |

---

### 2. 层次更分明

#### 静态结构层（WHAT）- 回答"系统是什么样的"

- **ADR-0001**：模块如何划分，如何组织
- **ADR-0002**：系统如何启动，层级如何装配
- **ADR-0003**：命名空间如何映射，如何推导
- **ADR-0004**：依赖包如何管理，如何分层

#### 运行时行为层（HOW）- 回答"系统如何运行"

- **ADR-0005**：用例如何执行，模块如何通信，一致性如何保障

#### 架构治理层（GUARDRAIL）- 回答"如何保障架构不腐化"

- **ADR-0000**：如何自动化测试，如何 CI 阻断，如何处理破例

---

### 3. 标准化文档结构

每个 ADR 现在都包含：

1. **本章聚焦内容（Focus）**
  - 明确本 ADR 的主轴和边界
  - 列出"不涉及"的内容，避免读者迷路

2. **术语表（Glossary）**
  - 定义本 ADR 使用的关键术语
  - 避免团队成员对概念理解不一致

3. **与其他 ADR 关系（Related ADRs）**
  - 说明与其他 ADR 的依赖、补充、引用关系
  - 方便读者跳转查阅相关内容

4. **快速参考（Quick Reference）**
  - 提供检查清单（Checklist）
  - 提供常见错误和正确做法对照表
  - 方便快速查询和验证

---

### 4. 改进的导航体验

#### 4.1 总索引（README.md）

- **快速导航**：按问题类型快速定位到对应 ADR
- **角色索引**：按角色（前端、后端、DevOps 等）推荐必读 ADR
- **关注点索引**：按关注点（模块划分、依赖管理等）查找 ADR
- **可视化图表**：直观展示 ADR 体系结构

#### 4.2 交叉引用

- 每个 ADR 明确列出与其他 ADR 的关系
- 辅助文档（Enforcement-Levels、Constitutional-Layer）有明确的引用说明
- 所有架构测试细节统一在 ADR-0000 中引用

---

### 5. 治理机制统一

#### 优化前：分散在各 ADR

- ADR-0001 有自己的架构测试映射
- ADR-0002 有自己的架构测试映射
- ...
- 破例流程在多处出现

#### 优化后：统一在 ADR-0000

- **统一的测试映射表**：一表查询所有 ADR 的测试类
- **统一的破例流程**：标准化的破例申请和记录流程
- **统一的 CI 策略**：明确的阻断规则和执行级别
- **统一的治理边界**：清晰的"必须测试"和"禁止测试"边界

---

## 对比示例

### 示例 1：查找"模块间如何通信"

#### 优化前

1. 查看 ADR-0001（模块隔离规则）
2. 查看 ADR-0005（应用内交互模型）
3. 可能还需要查看 ADR-0000（架构测试）
4. 内容分散，需要自己综合

#### 优化后

1. 在 README.md 中查询"模块如何通信"
2. 直接跳转到 ADR-0001（静态约束）和 ADR-0005（运行时行为）
3. 每个 ADR 的"本章聚焦内容"明确边界
4. "快速参考"提供检查清单

---

### 示例 2：查找"架构测试如何写"

#### 优化前

1. 查看 ADR-0000（基本定义）
2. 查看 ADR-0001（模块隔离测试）
3. 查看 ADR-0002（启动体系测试）
4. 查看 ADR-0003（命名空间测试）
5. 查看 ADR-0004（包管理测试）
6. 查看 ADR-0005（运行时测试）
7. 信息分散，需要自己汇总

#### 优化后

1. 直接查看 ADR-0000
2. 查看"ADR 与测试映射表"，了解全局
3. 查看"各 ADR 核心约束总结"，了解每个 ADR 的测试要点
4. 查看"快速参考"，了解如何添加新测试

---

### 示例 3：理解"系统启动流程"

#### 优化前

1. ADR-0002 描述启动体系
2. 但也包含命名空间规则（应该在 ADR-0003）
3. 还包含架构测试（应该在 ADR-0000）
4. 内容混杂，难以聚焦

#### 优化后

1. ADR-0002 只描述启动体系
2. "不涉及"明确说明不包含命名空间和测试
3. "与其他 ADR 关系"明确引用 ADR-0003（命名空间）和 ADR-0000（测试）
4. 内容聚焦，边界清晰

---

## 文档清单

### 主 ADR（宪法层）

| 文件                                                       | 类型    | 状态   |
|----------------------------------------------------------|-------|------|
| README.md                                                | 索引    | ✅ 新增 |
| ADR-0000-architecture-tests.md                           | 治理层   | ✅ 增强 |
| ADR-0001-modular-monolith-vertical-slice-architecture.md | 静态结构层 | ✅ 优化 |
| ADR-0002-platform-application-host-bootstrap.md          | 静态结构层 | ✅ 优化 |
| ADR-0003-namespace-rules.md                              | 静态结构层 | ✅ 优化 |
| ADR-0004-Cpm-Final.md                                    | 静态结构层 | ✅ 优化 |
| ADR-0005-Application-Interaction-Model-Final.md          | 运行时层  | ✅ 优化 |

### 辅助文档

| 文件                                   | 类型 | 状态   |
|--------------------------------------|----|------|
| ADR-0005-Enforcement-Levels.md       | 补充 | ✅ 保留 |
| ARCHITECTURE-CONSTITUTIONAL-LAYER.md | 补充 | ✅ 保留 |

---

## 统计数据

### 结构改进

| 指标             | 优化前 | 优化后      | 改进   |
|----------------|-----|----------|------|
| 主 ADR 文档数量     | 6   | 6        | 不变   |
| 每个 ADR 包含标准章节数 | 不定  | 6+       | 标准化  |
| 交叉引用数量         | 少量  | 完整       | 大幅增加 |
| 总索引文档          | 无   | 1        | 新增   |
| 架构测试统一入口       | 分散  | ADR-0000 | 统一   |

### 可查性改进

| 查询场景      | 优化前 | 优化后 | 改进   |
|-----------|-----|-----|------|
| 按问题类型查询   | 困难  | 简单  | 显著改善 |
| 按角色查询     | 无   | 简单  | 新增   |
| 查找相关 ADR  | 困难  | 简单  | 显著改善 |
| 理解 ADR 边界 | 模糊  | 清晰  | 显著改善 |

---

## 后续建议

### 1. 短期（1-2 周）

- [ ] 团队成员阅读新的 README.md
- [ ] 在团队会议上介绍新的 ADR 结构
- [ ] 收集团队反馈，微调文档

### 2. 中期（1-2 月）

- [ ] 在 onboarding 流程中使用新的 ADR 索引
- [ ] 根据实际使用情况优化"快速参考"
- [ ] 考虑添加更多可视化图表

### 3. 长期（持续）

- [ ] 所有新 ADR 遵循统一结构
- [ ] 定期审计 ADR 间的交叉引用
- [ ] 根据团队成长调整"按角色查询"索引

---

## 结论

通过本次重组，ADR 文档体系实现了：

1. ✅ **分工清晰**：每个 ADR 职责明确，不重复不遗漏
2. ✅ **层次分明**：静态/动态/治理三层清晰分离
3. ✅ **便于查阅**：索引完整，交叉引用清晰
4. ✅ **易于维护**：结构标准化，后续新增 ADR 有模板
5. ✅ **可追溯性强**：治理机制统一，破例流程标准化

这些改进将显著提升团队的架构治理效率和新人 onboarding 体验。

---

**文档版本**：2.0  
**最后更新**：2026-01-21  
**维护者**：架构团队
