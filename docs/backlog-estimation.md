# Backlog 估点汇总

## Sprint 0 基线准备 - 完成情况

| 任务 | 估时 | 状态 | 负责人 | 备注 |
|------|------|------|--------|------|
| 架构草图 (C4 L2) | 4h | ✅ 完成 | 架构师 | 已评审通过 |
| schema.sql v1 精简 | 3h | ✅ 完成 | 后端 | 仅保留V0.1表 |
| 事件Schema定义 | 4h | ✅ 完成 | 后端 | P0事件完整定义 |
| Docker环境搭建 | 2h | ✅ 完成 | DevOps | 包含MySQL+Redis |
| README 启动文档 | 2h | ✅ 完成 | 全栈 | 完整开发指南 |
| 后端项目初始化 | 6h | 🚧 部分 | 后端 | 目录结构，待补充代码 |
| Migration工具设置 | 2h | 🚧 部分 | 后端 | 脚本框架，待EF Core |
| 健康检查API | 1h | ⏸️ 待开发 | 后端 | 依赖后端项目 |

**总估时:** 24h  
**已完成:** 15h (62.5%)  
**剩余:** 9h

## V0.1 可用闭环 - 初步估点

### 核心API开发

| 功能模块 | Story | 估时 | 优先级 | 依赖 |
|---------|-------|------|--------|------|
| **会话管理** | | | | |
| 扫码开台 | POST /api/session/start | 8h | P0 | 用户服务 |
| 结束会话 | POST /api/session/{id}/end | 6h | P0 | 计费服务 |
| 会话查询 | GET /api/session/{id} | 3h | P1 | - |
| **用户服务** | | | | |
| 用户注册/登录 | POST /api/user/auth | 6h | P0 | - |
| 用户信息查询 | GET /api/user/profile | 2h | P1 | - |
| **计费服务** | | | | |
| 实时计费 | 计费快照生成 | 8h | P0 | 定价规则 |
| 计费规则引擎 | 固定单价计费 | 4h | P0 | - |
| **支付服务** | | | | |
| 创建支付订单 | POST /api/payment/create | 6h | P0 | 第三方集成 |
| 支付回调处理 | POST /api/payment/callback | 4h | P0 | 幂等控制 |
| 支付查询 | GET /api/payment/{id} | 2h | P1 | - |
| **设备服务** | | | | |
| 设备心跳 | POST /device/heartbeat | 3h | P0 | - |
| 灯控指令 | POST /device/light-control | 4h | P0 | 设备协议 |
| **埋点服务** | | | | |
| 事件上报API | POST /api/track | 4h | P0 | Schema验证 |
| 事件持久化 | 数据库写入 | 2h | P0 | - |

**子计:** 62h

### 基础设施

| 模块 | 任务 | 估时 | 优先级 |
|------|------|------|--------|
| **数据访问** | EF Core + Repository | 8h | P0 |
| **依赖注入** | DI容器配置 | 2h | P0 |
| **日志记录** | 结构化日志 | 3h | P0 |
| **错误处理** | 全局异常处理 | 2h | P0 |
| **验证** | 模型验证 | 3h | P0 |
| **缓存** | 内存缓存实现 | 4h | P1 |
| **事件总线** | 内存EventBus | 4h | P1 |

**子计:** 26h

### 测试

| 类型 | 范围 | 估时 | 优先级 |
|------|------|------|--------|
| **单元测试** | 核心业务逻辑 | 16h | P0 |
| **集成测试** | API端到端 | 12h | P0 |
| **设备集成测试** | 模拟设备交互 | 8h | P1 |

**子计:** 36h

### 部署与运维

| 任务 | 估时 | 优先级 |
|------|------|--------|
| Dockerfile编写 | 2h | P0 |
| K8s配置文件 | 4h | P1 |
| 监控指标配置 | 3h | P1 |
| 部署脚本 | 2h | P1 |

**子计:** 11h

## 总体估时汇总

| 阶段 | 总时间 | 开发时间 |
|------|--------|----------|
| Sprint 0 剩余 | 9h | 1-2天 |
| V0.1 核心开发 | 135h | 17工作日 |
| **总计** | **144h** | **18工作日** |

## 风险评估

| 风险项 | 概率 | 影响 | 缓解措施 |
|-------|------|------|----------|
| 设备协议复杂度 | 中 | 高 | 先用Mock设备，并行开发 |
| 支付集成延迟 | 低 | 中 | 使用Sandbox环境 |
| 并发场景复杂度 | 中 | 中 | 重点单元测试 |
| 性能要求 | 中 | 中 | 早期性能测试 |

## 里程碑检查点

- **Week 1 (Sprint 0):** 技术基础完成，架构评审通过
- **Week 2-3:** 核心API开发完成，单元测试通过  
- **Week 4:** 集成测试完成，20次闭环验证通过
- **Week 5:** 性能优化，V0.1发布准备

---
**更新日期:** 2024-09  
**版本:** v1.0