# ADR-0000ï¼šæ¶æ„æµ‹è¯•ä¸ CI æ²»ç†å®ªæ³•

**çŠ¶æ€**ï¼šâœ… å·²é‡‡çº³ï¼ˆFinalï¼Œä¸å¯éšæ„ä¿®æ”¹ï¼‰  
**çº§åˆ«**ï¼šæ¶æ„æ²»ç†æ ¹çº¦æŸï¼ˆGovernance Constitutional Ruleï¼‰  
**é€‚ç”¨èŒƒå›´**ï¼šæ‰€æœ‰ Platform / Application / Modules / Host / Tests é¡¹ç›®  
**ç”Ÿæ•ˆæ—¶é—´**ï¼šå³åˆ»  

---

## æœ¬ç« èšç„¦å†…å®¹ï¼ˆFocusï¼‰

æœ¬ ADR æ˜¯**æ¶æ„æ²»ç†å±‚**çš„æ ¸å¿ƒæ–‡æ¡£ï¼Œèšç„¦äºï¼š

1. **æ¶æ„æµ‹è¯•çš„å®šä¹‰ä¸è¾¹ç•Œ**ï¼šä»€ä¹ˆæ˜¯æ¶æ„æµ‹è¯•ï¼Œä»€ä¹ˆä¸æ˜¯
2. **ADR ä¸æµ‹è¯•çš„æ˜ å°„å…³ç³»**ï¼šæ¯æ¡ ADR å¦‚ä½•å¯¹åº”åˆ°å¯æ‰§è¡Œæµ‹è¯•
3. **è‡ªåŠ¨åŒ–æ ¡éªŒæœºåˆ¶**ï¼šå¦‚ä½•é€šè¿‡ CI è‡ªåŠ¨åŒ–æ‰§è¡Œæ¶æ„æµ‹è¯•
4. **ç ´ä¾‹æµç¨‹ä¸æ²»ç†**ï¼šå¦‚ä½•å¤„ç†æ¶æ„è¿è§„å’Œä¾‹å¤–æƒ…å†µ
5. **å„ ADR çš„æµ‹è¯•æ˜ å°„è¡¨**ï¼šå¿«é€ŸæŸ¥è¯¢æ¯æ¡ ADR å¯¹åº”çš„æµ‹è¯•ç±»

**ä¸æ¶‰åŠ**ï¼š
- âŒ å…·ä½“ä¸šåŠ¡é€»è¾‘çš„æµ‹è¯•
- âŒ å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•
- âŒ ä»£ç é£æ ¼æˆ–å‘½åè§„èŒƒ

---

## æœ¯è¯­è¡¨ï¼ˆGlossaryï¼‰

| æœ¯è¯­                  | å®šä¹‰                                                                 |
|-----------------------|----------------------------------------------------------------------|
| æ¶æ„æµ‹è¯•              | éªŒè¯æ¶æ„çº¦æŸçš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå…³æ³¨ç»“æ„æ€§è§„åˆ™è€Œéå®ç°ç»†èŠ‚                 |
| NetArchTest           | .NET æ¶æ„æµ‹è¯•åº“ï¼Œç”¨äºéªŒè¯ç¨‹åºé›†ä¾èµ–ã€å‘½åç©ºé—´ç­‰é™æ€çº¦æŸ              |
| Roslyn Analyzer       | C# ä»£ç åˆ†æå™¨ï¼Œç”¨äºéªŒè¯è¯­ä¹‰çº§è§„åˆ™                                    |
| CI é˜»æ–­               | æ¶æ„æµ‹è¯•å¤±è´¥æ—¶ï¼Œé˜»æ­¢ PR åˆå¹¶å’Œä»£ç å‘å¸ƒ                               |
| ç ´ä¾‹ï¼ˆExceptionï¼‰     | ç»è¿‡å®¡æ‰¹çš„ä¸´æ—¶æ€§æ¶æ„è¿è§„ï¼Œå¿…é¡»è®°å½•åœ¨æ¡ˆ                               |
| å®ªæ³•å±‚ ADR            | ADR-0000 è‡³ ADR-0005ï¼Œæ„æˆç³»ç»Ÿçš„ä¸å¯åå•†çº¦æŸ                          |
| ä¸‰çº§æ‰§è¡Œåˆ†ç±»          | Level 1ï¼ˆé™æ€å¯æ‰§è¡Œï¼‰ã€Level 2ï¼ˆè¯­ä¹‰åŠè‡ªåŠ¨ï¼‰ã€Level 3ï¼ˆäººå·¥ Gateï¼‰   |

---

## èƒŒæ™¯ï¼ˆContextï¼‰

éšç€ç³»ç»Ÿé‡‡ç”¨ **æ¨¡å—åŒ–å•ä½“ï¼ˆModular Monolithï¼‰+ å‚ç›´åˆ‡ç‰‡ï¼ˆVertical Sliceï¼‰** æ¶æ„ï¼Œ
ä»…é ä»£ç è¯„å®¡å’Œæ–‡æ¡£å·²æ— æ³•é•¿æœŸã€ç¨³å®šåœ°çº¦æŸæ¶æ„è¾¹ç•Œï¼š

- æ¶æ„è§„åˆ™å®¹æ˜“è¢«"æ— æ„ç ´å"ï¼ˆå°¤å…¶åœ¨å¤šäººåä½œã€å¿«é€Ÿè¿­ä»£æ—¶ï¼‰
- ADR æ–‡æ¡£ä¸€æ—¦è„±ç¦»ä»£ç ï¼Œææ˜“æ²¦ä¸º"å†å²è¯´æ˜ä¹¦"
- ä¾èµ–æ–¹å‘ã€æ¨¡å—è¾¹ç•Œã€å¯åŠ¨èŒè´£ç­‰é—®é¢˜ï¼Œå¾€å¾€åœ¨ç³»ç»ŸåæœŸæ‰æš´éœ²ï¼Œä¿®å¤æˆæœ¬æé«˜

å› æ­¤éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œä½¿**æ¶æ„å†³ç­–å…·å¤‡å¯æ‰§è¡Œæ€§ã€å¯éªŒè¯æ€§å’Œå¯æŒç»­æ€§**ã€‚

---

## æ ¸å¿ƒå†³ç­–ï¼ˆDecisionï¼‰

**å°†æ¶æ„æµ‹è¯•ï¼ˆArchitecture Testsï¼‰ç¡®ç«‹ä¸ºæ¶æ„æ²»ç†çš„å¼ºåˆ¶æ‰‹æ®µï¼Œå¹¶ä¸ ADR å½¢æˆä¸€ä¸€å¯¹åº”å…³ç³»ã€‚**

å…·ä½“å†³ç­–å¦‚ä¸‹ï¼š

1. **æ¯ä¸€æ¡ ADR å¿…é¡»æ˜ å°„ä¸ºè‡³å°‘ä¸€æ¡å¯æ‰§è¡Œçš„æ¶æ„æµ‹è¯•**
2. æ¶æ„æµ‹è¯•å¤±è´¥ = æ¶æ„å†³ç­–è¢«è¿åï¼ˆè€Œä¸æ˜¯"æŸä¸ªæµ‹è¯•æ²¡è¿‡"ï¼‰
3. æ¶æ„æµ‹è¯•å±äº"ç³»ç»Ÿå®ªæ³•"ï¼Œå…¶å¤±è´¥åº”é˜»æ–­ CI / PR åˆå¹¶
4. æ¶æ„æµ‹è¯•å…³æ³¨**ç»“æ„æ€§çº¦æŸ**ï¼Œè€Œéå®ç°ç»†èŠ‚æˆ–ä»£ç é£æ ¼
5. é‡‡ç”¨**ä¸‰çº§æ‰§è¡Œåˆ†ç±»**ï¼šé™æ€å¯æ‰§è¡Œã€è¯­ä¹‰åŠè‡ªåŠ¨ã€äººå·¥ Gate

---

## æ¶æ„æµ‹è¯•çš„å®šä¹‰ï¼ˆWhat is Architecture Testï¼‰

æ¶æ„æµ‹è¯•ç”¨äºéªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

- **ç¨‹åºé›† / æ¨¡å—ä¹‹é—´çš„ä¾èµ–æ–¹å‘æ˜¯å¦ç¬¦åˆ ADR**
- **å¯åŠ¨èŒè´£ã€è¿è¡Œè¾¹ç•Œæ˜¯å¦è¢«ç ´å**
- **æ¨¡å—éš”ç¦»æ˜¯å¦ä»ç„¶æˆç«‹**
- **å‘½åç©ºé—´ä¸ç‰©ç†ç»“æ„çš„æ˜ å°„æ˜¯å¦æ­£ç¡®**
- **åŒ…ä¾èµ–æ˜¯å¦ç¬¦åˆå±‚çº§è§„åˆ™**

æ¶æ„æµ‹è¯•**ä¸ç”¨äº**ï¼š

- æ ¡éªŒä»£ç é£æ ¼æˆ–å‘½åä¼˜é›…æ€§
- åˆ¤æ–­æŸæ®µé€»è¾‘æ˜¯å¦"åƒä¸šåŠ¡"æˆ–"åƒæŠ€æœ¯"
- æ›¿ä»£å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•
- éªŒè¯ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§

---

## æµ‹è¯•ç»„ç»‡åŸåˆ™ï¼ˆOrganization Principlesï¼‰

### 1ï¸âƒ£ æŒ‰ ADR ç»„ç»‡ï¼Œè€ŒéæŒ‰æŠ€æœ¯å±‚ç»„ç»‡

- æµ‹è¯•ç›®å½•ç»“æ„ä»¥ `ADR-XXXX` ä¸ºæ ¸å¿ƒ
- ä¸€ä¸ª ADR = ä¸€ä¸ªæµ‹è¯•ç±»ï¼ˆæˆ–æµ‹è¯•é›†åˆï¼‰

ç¤ºä¾‹ï¼š

```
src/tests/ArchitectureTests/ADR/
â”œâ”€â”€ ADR_0000_Architecture_Tests.cs  # æ¶æ„æµ‹è¯•å…ƒè§„åˆ™
â”œâ”€â”€ ADR_0001_Architecture_Tests.cs  # æ¨¡å—åŒ–å•ä½“ä¸å‚ç›´åˆ‡ç‰‡
â”œâ”€â”€ ADR_0002_Architecture_Tests.cs  # ä¸‰å±‚å¯åŠ¨ä½“ç³»
â”œâ”€â”€ ADR_0003_Architecture_Tests.cs  # å‘½åç©ºé—´è§„èŒƒ
â”œâ”€â”€ ADR_0004_Architecture_Tests.cs  # ä¸­å¤®åŒ…ç®¡ç†
â””â”€â”€ ADR_0005_Architecture_Tests.cs  # åº”ç”¨å†…äº¤äº’æ¨¡å‹
```

> ç›®çš„ï¼šä»»ä½•ä¸€æ¬¡æµ‹è¯•å¤±è´¥ï¼Œéƒ½å¯ä»¥ç›´æ¥å®šä½åˆ°è¢«ç ´åçš„æ¶æ„å†³ç­–ã€‚

---

### 2ï¸âƒ£ æµ‹è¯•åç§°å¿…é¡»æ˜¾å¼æ ‡æ˜ ADR ç¼–å·

- æµ‹è¯•ç±»å
- æµ‹è¯•æ–¹æ³•å
- æ–­è¨€å¤±è´¥ä¿¡æ¯

éƒ½å¿…é¡»åŒ…å« ADR ç¼–å·ï¼Œä¾‹å¦‚ï¼š

> `ADR-0005 è¿è§„ï¼šPlatform ä¸åº”ä¾èµ– Application`

è¿™æ˜¯ä¸ºäº†ä¿è¯ï¼š

- æ¶æ„å¤±è´¥æ˜¯**å¯æ²Ÿé€šçš„**
- æ¶æ„è´£ä»»æ˜¯**å¯è¿½æº¯çš„**

---

## æµ‹è¯•å†…å®¹è¾¹ç•Œï¼ˆWhat Must / Must Not Be Testedï¼‰

### âœ… å¿…é¡»æµ‹è¯•ï¼ˆHard Rulesï¼‰

- å±‚çº§ / æ¨¡å— / Host / Platform ä¹‹é—´çš„ä¾èµ–æ–¹å‘
- æ¨¡å—ä¹‹é—´æ˜¯å¦å­˜åœ¨ç›´æ¥å¼•ç”¨
- æ˜¯å¦è¿åå¯åŠ¨æ¨¡å‹ï¼ˆé Host å‡ºç°å…¥å£ç‚¹ï¼‰
- æ˜¯å¦è¿åé›†ä¸­å¼ä¾èµ–æ²»ç†ï¼ˆCPMï¼‰
- å‘½åç©ºé—´æ˜¯å¦ç¬¦åˆè§„èŒƒ
- Handler æ˜¯å¦ä¾èµ– ASP.NET ç±»å‹

è¿™äº›è§„åˆ™ä¸€æ—¦è¢«ç ´åï¼Œç³»ç»Ÿæ¶æ„å°†**ç»“æ„æ€§é€€åŒ–**ã€‚

---

### ğŸš« æ˜ç¡®ç¦æ­¢æµ‹è¯•ï¼ˆAnti-Patternsï¼‰

ä»¥ä¸‹å†…å®¹**ä¸å¾—å†™æˆæ¶æ„æµ‹è¯•**ï¼š

- åŸºäº"ç±»å / å…³é”®å­—"çš„ä¸šåŠ¡è¯­ä¹‰æ¨æ–­
- é€šè¿‡å‰ç¼€ / åç¼€åˆ¤æ–­æŠ€æœ¯å±æ€§
- å¯¹æ¨¡å—å†…éƒ¨å®ç°æ–¹å¼çš„å¼ºåˆ¶çº¦æŸ
- å¯¹æœªæ¥å¯èƒ½æ¼”è¿›æ–¹å‘çš„ä¸»è§‚å‡è®¾

> åŸå› ï¼šè¿™äº›è§„åˆ™ç»´æŠ¤æˆæœ¬é«˜ã€å™ªéŸ³å¤§ã€ææ˜“è¯¯ä¼¤æ­£ç¡®è®¾è®¡ã€‚

---

## ADR ä¸æµ‹è¯•æ˜ å°„è¡¨

| ADR ç¼–å·  | ADR ä¸»é¢˜                           | æµ‹è¯•ç±»                             | æ ¸å¿ƒæµ‹è¯•ç”¨ä¾‹                                    |
|-----------|------------------------------------|------------------------------------|------------------------------------------------|
| ADR-0000  | æ¶æ„æµ‹è¯•ä¸ CI æ²»ç†                 | `ADR_0000_Architecture_Tests.cs`   | æ¯ä¸ª ADR éƒ½æœ‰å¯¹åº”æµ‹è¯•ç±»                         |
| ADR-0001  | æ¨¡å—åŒ–å•ä½“ä¸å‚ç›´åˆ‡ç‰‡               | `ADR_0001_Architecture_Tests.cs`   | æ¨¡å—éš”ç¦»ã€å¥‘çº¦ä½¿ç”¨è§„åˆ™ã€å‚ç›´åˆ‡ç‰‡                |
| ADR-0002  | ä¸‰å±‚å¯åŠ¨ä½“ç³»                       | `ADR_0002_Architecture_Tests.cs`   | å±‚çº§ä¾èµ–æ–¹å‘ã€Host è¾¹ç•Œçº¦æŸ                     |
| ADR-0003  | å‘½åç©ºé—´ä¸é¡¹ç›®è¾¹ç•Œ                 | `ADR_0003_Architecture_Tests.cs`   | å‘½åç©ºé—´æ˜ å°„ã€é˜²å¾¡æ€§è§„åˆ™                        |
| ADR-0004  | ä¸­å¤®åŒ…ç®¡ç†                         | `ADR_0004_Architecture_Tests.cs`   | CPM ä½¿ç”¨ã€å±‚çº§ä¾èµ–è§„åˆ™                          |
| ADR-0005  | åº”ç”¨å†…äº¤äº’æ¨¡å‹                     | `ADR_0005_Architecture_Tests.cs`   | Handler çº¦æŸã€åŒæ­¥å¼‚æ­¥è§„åˆ™ã€CQRS               |

---

## ä¸‰çº§æ‰§è¡Œåˆ†ç±»ï¼ˆEnforcement Levelsï¼‰

è¯¦è§ [ADR-0005-Enforcement-Levels.md](ADR-0005-Enforcement-Levels.md)

### Level 1: é™æ€å¯æ‰§è¡Œï¼ˆStatic Enforceableï¼‰

**å®šä¹‰**ï¼šå¯ä»¥é€šè¿‡ NetArchTest ç­‰é™æ€åˆ†æå·¥å…·å®Œå…¨è‡ªåŠ¨åŒ–æ£€æŸ¥çš„è§„åˆ™ã€‚

**ç‰¹å¾**ï¼š
- åŸºäºç±»å‹ã€å‘½åç©ºé—´ã€ä¾èµ–å…³ç³»çš„é™æ€çº¦æŸ
- æµ‹è¯•å¤±è´¥ = ç»å¯¹è¿è§„
- CI é˜»æ–­

**å·¥å…·**ï¼šNetArchTest

**ç¤ºä¾‹è§„åˆ™**ï¼š
- Platform ä¸åº”ä¾èµ– Application
- Modules ä¹‹é—´ä¸åº”æœ‰ç›´æ¥å¼•ç”¨
- Handler ä¸åº”ä¾èµ– ASP.NET ç±»å‹
- å‘½åç©ºé—´å¿…é¡»ç¬¦åˆæ˜ å°„è§„åˆ™

---

### Level 2: è¯­ä¹‰åŠè‡ªåŠ¨ï¼ˆSemantic Semi-Autoï¼‰

**å®šä¹‰**ï¼šéœ€è¦è¯­ä¹‰åˆ†æçš„è§„åˆ™ï¼Œå»ºè®®é€šè¿‡ Roslyn Analyzer æ£€æŸ¥ï¼Œå½“å‰æµ‹è¯•åªèƒ½åšå¯å‘å¼æ£€æŸ¥ã€‚

**ç‰¹å¾**ï¼š
- éœ€è¦ç†è§£ä»£ç è¯­ä¹‰ï¼ˆå¦‚æ–¹æ³•è°ƒç”¨é“¾ã€ä¸šåŠ¡é€»è¾‘å¤æ‚åº¦ï¼‰
- å½“å‰æµ‹è¯•æ˜¯"å»ºè®®æ€§"è€Œé"å¼ºåˆ¶æ€§"
- æµ‹è¯•å¤±è´¥ = éœ€è¦äººå·¥å®¡æŸ¥

**å·¥å…·**ï¼š
- å½“å‰ï¼šNetArchTestï¼ˆå¯å‘å¼æ£€æŸ¥ï¼‰
- å»ºè®®ï¼šRoslyn Analyzerï¼ˆè‡ªå®šä¹‰åˆ†æå™¨ï¼‰

**ç¤ºä¾‹è§„åˆ™**ï¼š
- Endpoint ä¸åº”åŒ…å«ä¸šåŠ¡é€»è¾‘
- Handler åº”ä½¿ç”¨ç»“æ„åŒ–å¼‚å¸¸
- Command Handler ä¸åº”è¿”å›ä¸šåŠ¡æ•°æ®

---

### Level 3: äººå·¥ Gateï¼ˆManual Gateï¼‰

**å®šä¹‰**ï¼šæ— æ³•ï¼ˆæˆ–ä¸åº”è¯¥ï¼‰å®Œå…¨è‡ªåŠ¨åŒ–çš„è§„åˆ™ï¼Œéœ€è¦äººå·¥å®¡æŸ¥å’Œå†³ç­–ã€‚

**ç‰¹å¾**ï¼š
- æ¶‰åŠä¸šåŠ¡è¯­ä¹‰ã€è®¾è®¡æ„å›¾ã€æ¶æ„æƒè¡¡
- æµ‹è¯•æ— æ³•è¦†ç›–ï¼Œæˆ–è¦†ç›–æˆæœ¬è¿‡é«˜
- ä¾èµ– PR Review + ARCH-VIOLATION æ ‡è®°

**å·¥å…·**ï¼š
- PR Checklist
- æ¶æ„å¸ˆ Code Review
- ARCH-VIOLATION è®°å½•è¡¨

**ç¤ºä¾‹è§„åˆ™**ï¼š
- æ¨¡å—é—´åŒæ­¥è°ƒç”¨ç ´ä¾‹å®¡æ‰¹
- è·¨æ¨¡å—äº‹åŠ¡ä¸ Saga
- Handler èŒè´£åˆ’åˆ†

---

## è‡ªåŠ¨åŒ–æ ¡éªŒæœºåˆ¶

### 1. CI é›†æˆ

æ¶æ„æµ‹è¯•å¿…é¡»é›†æˆåˆ° CI æµç¨‹ä¸­ï¼š

```yaml
# CI é…ç½®ç¤ºä¾‹
- name: Run Architecture Tests
  run: dotnet test src/tests/ArchitectureTests --no-build --verbosity normal
  
# æ¶æ„æµ‹è¯•å¤±è´¥ = æ„å»ºå¤±è´¥ = PR é˜»æ–­
```

### 2. æµ‹è¯•æ‰§è¡Œç­–ç•¥

- **æ¯æ¬¡ PR æäº¤**ï¼šæ‰§è¡Œæ‰€æœ‰æ¶æ„æµ‹è¯•
- **æ¯æ¬¡åˆå¹¶åˆ°ä¸»åˆ†æ”¯**ï¼šæ‰§è¡Œæ‰€æœ‰æ¶æ„æµ‹è¯•
- **å®šæœŸæ‰«æ**ï¼šæ¯æ—¥æ‰§è¡Œæ¶æ„æµ‹è¯•ï¼Œæ£€æµ‹æ½œåœ¨è…åŒ–

### 3. å¤±è´¥å¤„ç†

æ¶æ„æµ‹è¯•å¤±è´¥æ—¶ï¼š

1. **CI è‡ªåŠ¨é˜»æ–­**ï¼šPR æ— æ³•åˆå¹¶
2. **å¤±è´¥æ¶ˆæ¯**ï¼šå¿…é¡»åŒ…å« ADR ç¼–å·å’Œè¿è§„è¯¦æƒ…
3. **ä¿®å¤æˆ–ç ´ä¾‹**ï¼š
   - ä¿®å¤ä»£ç ï¼Œä½¿å…¶ç¬¦åˆæ¶æ„çº¦æŸ
   - æˆ–ç”³è¯·ç ´ä¾‹ï¼ˆè§ç ´ä¾‹æµç¨‹ï¼‰

---

## ç ´ä¾‹æµç¨‹ä¸æ²»ç†ï¼ˆException Handlingï¼‰

### 1. ç ´ä¾‹ç”³è¯·æ¡ä»¶

ç ´ä¾‹å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€ï¼š

- **æŠ€æœ¯é™åˆ¶**ï¼šå½“å‰æŠ€æœ¯æ ˆæ— æ³•æ»¡è¶³æ¶æ„çº¦æŸ
- **æ€§èƒ½éœ€æ±‚**ï¼šä¸¥æ ¼éµå®ˆæ¶æ„çº¦æŸä¼šå¯¼è‡´ä¸¥é‡æ€§èƒ½é—®é¢˜
- **é—ç•™ç³»ç»Ÿ**ï¼šè¿ç§»æˆæœ¬è¿‡é«˜ï¼Œéœ€è¦ä¸´æ—¶ç»•è¿‡
- **å¤–éƒ¨ä¾èµ–**ï¼šç¬¬ä¸‰æ–¹åº“æˆ–æ¡†æ¶çš„é™åˆ¶

### 2. ç ´ä¾‹ç”³è¯·æµç¨‹

1. **æäº¤ PR**ï¼šåœ¨ PR æè¿°ä¸­æ˜ç¡®å£°æ˜ç ´ä¾‹
2. **å¡«å†™ç ´ä¾‹è¡¨å•**ï¼š
   - ç ´ä¾‹ç†ç”±
   - å½±å“èŒƒå›´
   - é¢„æœŸæŒç»­æ—¶é—´
   - å½’è¿˜è®¡åˆ’
3. **æ¶æ„å®¡æŸ¥**ï¼šç”±æ¶æ„å¸ˆæˆ– Tech Lead å®¡æ‰¹
4. **è®°å½•å½’æ¡£**ï¼šåœ¨ `ARCH-VIOLATIONS.md` ä¸­è®°å½•

### 3. ç ´ä¾‹è®°å½•æ ¼å¼

```markdown
## ARCH-VIOLATION-001

**ADR ç¼–å·**ï¼šADR-0005  
**è¿è§„å†…å®¹**ï¼šModules.Orders åŒæ­¥è°ƒç”¨ Modules.Members  
**ç†ç”±**ï¼šè®¢å•åˆ›å»ºéœ€è¦å®æ—¶éªŒè¯ä¼šå‘˜çŠ¶æ€  
**æ‰¹å‡†äºº**ï¼š@architect-name  
**æ‰¹å‡†æ—¥æœŸ**ï¼š2026-01-21  
**å¤±æ•ˆæœŸ**ï¼š2026-03-31  
**å½’è¿˜è®¡åˆ’**ï¼šé‡æ„ä¸ºå¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¨¡å¼  
**çŠ¶æ€**ï¼šâš ï¸ Active  
```

### 4. ç ´ä¾‹å®¡è®¡

- **å­£åº¦å®¡è®¡**ï¼šæ¯å­£åº¦æ£€æŸ¥æ‰€æœ‰æ´»è·ƒç ´ä¾‹
- **åˆ°æœŸå¤„ç†**ï¼šç ´ä¾‹åˆ°æœŸåï¼Œå¿…é¡»ä¿®å¤æˆ–ç»­æœŸ
- **å¼ºåˆ¶å½’è¿˜**ï¼šè¿ç»­ç»­æœŸè¶…è¿‡ 3 æ¬¡çš„ç ´ä¾‹ï¼Œå¿…é¡»å½’è¿˜

---

## æŠ€æœ¯é€‰å‹ï¼ˆImplementationï¼‰

### å½“å‰é˜¶æ®µ

- ä½¿ç”¨ **NetArchTest** å®ç°åŸºäºç¨‹åºé›†ä¸ä¾èµ–çš„ç»“æ„æ€§çº¦æŸ
- ä½¿ç”¨ **xUnit** ä½œä¸ºæµ‹è¯•æ¡†æ¶

### æœªæ¥æ¼”è¿›æ–¹å‘

- å¯¹æ›´ç»†ç²’åº¦è§„åˆ™ï¼ˆå¦‚æ–¹æ³•çº§ã€æ„é€ å‡½æ•°æ³¨å…¥ï¼‰é€æ­¥å¼•å…¥ **Roslyn Analyzer**
- è€ƒè™‘å¼•å…¥ **ArchUnit**ï¼ˆå¦‚æœéœ€è¦æ›´å¼ºå¤§çš„è§„åˆ™è¡¨è¾¾ï¼‰

NetArchTest è¢«è§†ä¸ºï¼š

> **æ¶æ„çƒŸé›¾æŠ¥è­¦å™¨ï¼Œè€Œéè¯­ä¹‰å®¡æŸ¥å™¨**

---

## å„ ADR æ ¸å¿ƒçº¦æŸæ€»ç»“

### ADR-0001ï¼šæ¨¡å—åŒ–å•ä½“ä¸å‚ç›´åˆ‡ç‰‡

**æ ¸å¿ƒçº¦æŸ**ï¼š
- âœ… æ¨¡å—éš”ç¦»ï¼ˆæ¨¡å—é—´ä¸èƒ½äº’ç›¸å¼•ç”¨ï¼‰
- âœ… å‚ç›´åˆ‡ç‰‡ç»„ç»‡ï¼ˆç¦æ­¢ä¼ ç»Ÿåˆ†å±‚å‘½åç©ºé—´ï¼‰
- âœ… å¥‘çº¦ä½¿ç”¨è§„åˆ™ï¼ˆCommand Handler ä¸ä¾èµ– IQueryï¼‰

**å¯¹åº”æµ‹è¯•**ï¼š
- `Modules_Should_Not_Reference_Each_Other`
- `CommandHandlers_Should_Not_Depend_On_Contracts`
- `Handlers_Should_Be_In_FeatureSlices`

---

### ADR-0002ï¼šPlatform / Application / Host ä¸‰å±‚å¯åŠ¨ä½“ç³»

**æ ¸å¿ƒçº¦æŸ**ï¼š
- âœ… Platform ä¸å¾—ä¾èµ– Application æˆ– Host
- âœ… Application ä¸å¾—ä¾èµ– Host
- âœ… Host ä¸å¾—åŒ…å«ä¸šåŠ¡é€»è¾‘

**å¯¹åº”æµ‹è¯•**ï¼š
- `Platform_Should_Not_Depend_On_Application`
- `Application_Should_Not_Depend_On_Host`
- `Host_Should_Not_Contain_Business_Types`

---

### ADR-0003ï¼šå‘½åç©ºé—´ä¸é¡¹ç›®è¾¹ç•Œè§„èŒƒ

**æ ¸å¿ƒçº¦æŸ**ï¼š
- âœ… æ‰€æœ‰ç±»å‹å‘½åç©ºé—´ä»¥ `Zss.BilliardHall` å¼€å¤´
- âœ… å‘½åç©ºé—´å¿…é¡»åæ˜ çœŸå®çš„æ¶æ„å±‚æ¬¡
- âœ… ç¦æ­¢ä¸è§„èŒƒå‘½åç©ºé—´ï¼ˆCommonã€Sharedã€Utilsï¼‰

**å¯¹åº”æµ‹è¯•**ï¼š
- `All_Types_Should_Start_With_BaseNamespace`
- `Namespace_Should_Match_Physical_Structure`
- `Should_Not_Have_Irregular_Namespaces`

---

### ADR-0004ï¼šä¸­å¤®åŒ…ç®¡ç†ï¼ˆCPMï¼‰è§„èŒƒ

**æ ¸å¿ƒçº¦æŸ**ï¼š
- âœ… æ‰€æœ‰ NuGet åŒ…ç‰ˆæœ¬å¿…é¡»åœ¨ Directory.Packages.props ä¸­å®šä¹‰
- âœ… ç¦æ­¢é¡¹ç›®æ–‡ä»¶ä¸­å‡ºç° `<PackageReference Version="...">`
- âœ… å±‚çº§ä¹‹é—´çš„åŒ…ä¾èµ–å¿…é¡»ç¬¦åˆè§„åˆ™

**å¯¹åº”æµ‹è¯•**ï¼š
- `All_Packages_Should_Be_Centrally_Managed`
- `Projects_Should_Not_Specify_Package_Versions`
- `Layer_Package_Dependencies_Should_Be_Valid`

---

### ADR-0005ï¼šåº”ç”¨å†…äº¤äº’æ¨¡å‹ä¸æ‰§è¡Œè¾¹ç•Œ

**æ ¸å¿ƒçº¦æŸ**ï¼š
- âœ… Handler ä¸å¾—æ‰¿è½½é•¿æœŸçŠ¶æ€
- âœ… æ¨¡å—é—´æœªå®¡æ‰¹çš„åŒæ­¥è°ƒç”¨è¢«ç¦æ­¢
- âœ… æ¨¡å—ä¸å…±äº«é¢†åŸŸå®ä½“
- âœ… Endpoint ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

**å¯¹åº”æµ‹è¯•**ï¼š
- `Handlers_Should_Be_Stateless`
- `Modules_Should_Not_Have_Synchronous_Cross_Module_Calls`
- `Modules_Should_Not_Share_Domain_Entities`
- `Endpoints_Should_Not_Contain_Business_Logic`

---

## åæœï¼ˆConsequencesï¼‰

### æ­£é¢å½±å“

- âœ… æ¶æ„ä¸å†ä¾èµ–"äººè®°å¾—ä½"
- âœ… ADR ä»æ–‡æ¡£å‡çº§ä¸º"å¯æ‰§è¡Œå®ªæ³•"
- âœ… æ–°æˆå‘˜å¯ä»¥é€šè¿‡æµ‹è¯•å¿«é€Ÿç†è§£ç³»ç»Ÿè¾¹ç•Œ
- âœ… æ¶æ„è…åŒ–å¯ä»¥è¢«åŠæ—¶å‘ç°å’Œé˜»æ­¢
- âœ… é‡æ„æœ‰äº†æ˜ç¡®çš„çº¦æŸå’ŒéªŒè¯æœºåˆ¶

### ä»£ä»·

- âš ï¸ åˆæœŸéœ€è¦é¢å¤–ç»´æŠ¤æµ‹è¯•ä»£ç 
- âš ï¸ æ¶æ„å†³ç­–ä¸€æ—¦é‡‡çº³ï¼Œå°†ä¸å†"å®¹æ˜“æ¨ç¿»"
- âš ï¸ ç ´ä¾‹æµç¨‹éœ€è¦äººå·¥ä»‹å…¥

è¿™äº›ä»£ä»·æ˜¯**åˆ»æ„ä¸”å¿…è¦çš„**ï¼Œç”¨äºæ¢å–é•¿æœŸç³»ç»Ÿç¨³å®šæ€§ã€‚

---

## ä¸å…¶ä»– ADR å…³ç³»ï¼ˆRelated ADRsï¼‰

| ADR        | å…³ç³»                                   |
|------------|----------------------------------------|
| ADR-0001   | æœ¬ ADR å®šä¹‰å¦‚ä½•æµ‹è¯• ADR-0001 çš„çº¦æŸ    |
| ADR-0002   | æœ¬ ADR å®šä¹‰å¦‚ä½•æµ‹è¯• ADR-0002 çš„çº¦æŸ    |
| ADR-0003   | æœ¬ ADR å®šä¹‰å¦‚ä½•æµ‹è¯• ADR-0003 çš„çº¦æŸ    |
| ADR-0004   | æœ¬ ADR å®šä¹‰å¦‚ä½•æµ‹è¯• ADR-0004 çš„çº¦æŸ    |
| ADR-0005   | æœ¬ ADR å®šä¹‰å¦‚ä½•æµ‹è¯• ADR-0005 çš„çº¦æŸ    |
| å®ªæ³•å±‚æ–‡æ¡£ | æœ¬ ADR æ˜¯å®ªæ³•å±‚çš„å®ˆæŠ¤æœºåˆ¶              |

---

## å¿«é€Ÿå‚è€ƒï¼ˆQuick Referenceï¼‰

### å¸¸è§é—®é¢˜

**Q: æ¶æ„æµ‹è¯•å¤±è´¥äº†ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ**

A: 
1. æŸ¥çœ‹æµ‹è¯•å¤±è´¥æ¶ˆæ¯ï¼Œå®šä½åˆ°å¯¹åº”çš„ ADR ç¼–å·
2. é˜…è¯»å¯¹åº”çš„ ADRï¼Œç†è§£è¿åäº†ä»€ä¹ˆçº¦æŸ
3. ä¿®å¤ä»£ç ï¼Œä½¿å…¶ç¬¦åˆçº¦æŸ
4. å¦‚æœç¡®å®éœ€è¦ç ´ä¾‹ï¼Œèµ°ç ´ä¾‹ç”³è¯·æµç¨‹

---

**Q: å¦‚ä½•æ·»åŠ æ–°çš„æ¶æ„æµ‹è¯•ï¼Ÿ**

A:
1. ç¡®å®šè¦éªŒè¯çš„æ¶æ„çº¦æŸå±äºå“ªä¸ª ADR
2. åœ¨å¯¹åº”çš„ `ADR_XXXX_Architecture_Tests.cs` ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•
3. æµ‹è¯•æ–¹æ³•åå’Œå¤±è´¥æ¶ˆæ¯å¿…é¡»åŒ…å« ADR ç¼–å·
4. è¿è¡Œæµ‹è¯•ï¼Œç¡®ä¿æµ‹è¯•èƒ½æ­£ç¡®æ£€æµ‹è¿è§„

---

**Q: æ¶æ„æµ‹è¯•å¤ªä¸¥æ ¼ï¼Œå½±å“å¼€å‘æ•ˆç‡æ€ä¹ˆåŠï¼Ÿ**

A:
1. æ¶æ„æµ‹è¯•çš„ç›®çš„æ˜¯ä¿è¯é•¿æœŸå¯æ¼”è¿›æ€§ï¼ŒçŸ­æœŸä¼šæœ‰ä¸€å®šçº¦æŸ
2. å¦‚æœç¡®å®éœ€è¦ç ´ä¾‹ï¼Œèµ°ç ´ä¾‹ç”³è¯·æµç¨‹
3. ä¸å»ºè®®ç›´æ¥è·³è¿‡æˆ–ç¦ç”¨æ¶æ„æµ‹è¯•

---

### ç›¸å…³æ–‡æ¡£

- [ADR-0005-Enforcement-Levels.md](ADR-0005-Enforcement-Levels.md)ï¼šä¸‰çº§æ‰§è¡Œåˆ†ç±»è¯¦ç»†è¯´æ˜
- [ARCHITECTURE-CONSTITUTIONAL-LAYER.md](ARCHITECTURE-CONSTITUTIONAL-LAYER.md)ï¼šå®ªæ³•å±‚å®šä¹‰
- `ARCH-VIOLATIONS.md`ï¼šç ´ä¾‹è®°å½•è¡¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

---

## ç»“è®ºï¼ˆConclusionï¼‰

**æœ¬é¡¹ç›®æ˜ç¡®è§„å®šï¼šæ²¡æœ‰å¯¹åº”æ¶æ„æµ‹è¯•çš„ ADRï¼Œè§†ä¸ºæœªçœŸæ­£è½åœ°ã€‚**

æ¶æ„æµ‹è¯•ä¸æ˜¯è¾…åŠ©å·¥å…·ï¼Œè€Œæ˜¯ï¼š

> **ç³»ç»Ÿåœ¨è§„æ¨¡åŒ–æ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œå¯¹æŠ—æ¶æ„è…åŒ–çš„æœ€åé˜²çº¿ã€‚**

ä¸‰å¹´åï¼Œå¦‚æœæ¶æ„æµ‹è¯•ä»åœ¨è¿è¡Œï¼ŒADR ä»è¢«éµå®ˆï¼Œç³»ç»Ÿä»ç„¶ç«™å¾—ä½ã€‚

---

## å‚è€ƒèµ„æ–™ï¼ˆReferencesï¼‰

- [NetArchTest.Rules](https://github.com/BenMorris/NetArchTest)
- [ArchUnitï¼ˆJavaï¼‰](https://www.archunit.org/) - æ¦‚å¿µå‚è€ƒ
- [Fitness Functions](https://www.thoughtworks.com/insights/blog/fitness-function-driven-development) - æ¶æ„é€‚åº”åº¦å‡½æ•°
- [ADR æœ€ä½³å®è·µ](https://github.com/joelparkerhenderson/architecture-decision-record)
