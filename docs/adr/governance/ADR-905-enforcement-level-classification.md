---
adr: ADR-905
title: "æ‰§è¡Œçº§åˆ«åˆ†ç±»ï¼ˆEnforcement Level Classificationï¼‰"
status: Accepted
level: Governance
deciders: "Architecture Board"
date: 2026-01-26
version: "1.0"
maintainer: "Architecture Board"
reviewer: "Architecture Board"
supersedes: null
superseded_by: null
---

# ADR-905ï¼šæ‰§è¡Œçº§åˆ«åˆ†ç±»ï¼ˆEnforcement Level Classificationï¼‰

---
> **æ³¨æ„**ï¼šæœ¬æ–‡æ¡£æ˜¯ [ADR-0005ï¼šåº”ç”¨å†…äº¤äº’æ¨¡å‹ä¸æ‰§è¡Œè¾¹ç•Œ](../constitutional/ADR-0005-Application-Interaction-Model-Final.md) çš„è¡¥å……æ–‡æ¡£ã€‚  
> ä¸» ADR å®šä¹‰"æ˜¯ä»€ä¹ˆ"ï¼Œæœ¬æ–‡æ¡£å®šä¹‰"å¦‚ä½•éªŒè¯"ã€‚  
> åŒæ—¶å‚è§ï¼š[ADR-0000ï¼šæ¶æ„æµ‹è¯•ä¸ CI æ²»ç†](./ADR-0000-architecture-tests.md)

**å…³è” ADR**ï¼šADR-0005 åº”ç”¨å†…äº¤äº’æ¨¡å‹ä¸æ‰§è¡Œè¾¹ç•Œ  
**ç›®çš„**ï¼šæ˜ç¡®å®šä¹‰ ADR-0005 å„é¡¹è§„åˆ™çš„å¯æ‰§è¡Œæ€§è¾¹ç•Œ  

---

## èƒŒæ™¯

ADR-0005 å®šä¹‰çš„æ˜¯"è¿è¡Œæ—¶ç§©åº"ï¼Œä½†å·¥å…·èƒ½åŠ›æœ‰ç‰©ç†æé™ï¼š

- **NetArchTest** åªèƒ½åšç¼–è¯‘æœŸé™æ€åˆ†æ
- **Roslyn Analyzer** å¯ä»¥åšè¯­ä¹‰çº§æ£€æŸ¥
- **äººå·¥å®¡æŸ¥** æ˜¯æœ€åçš„é˜²çº¿

å¦‚æœä¸æ˜ç¡®åŒºåˆ†è¿™ä¸‰ä¸ªå±‚æ¬¡ï¼Œä¼šå¯¼è‡´ï¼š

- å¼€å‘è€…è¯¯ä»¥ä¸º"æµ‹è¯•é€šè¿‡ = å®Œå…¨åˆè§„"
- æ¶æ„å¸ˆä¸çŸ¥é“å“ªäº›è§„åˆ™éœ€è¦äººå·¥ Gate
- æ–°äººä¸ç†è§£ä¸ºä»€ä¹ˆ"æµ‹è¯•è¿‡äº†è¿˜ä¸å…è®¸"

å› æ­¤ï¼Œæœ¬æ–‡æ¡£å°† ADR-0005 çš„æ‰€æœ‰è§„åˆ™è¿›è¡Œä¸‰çº§åˆ†ç±»ã€‚

---

## æ‰§è¡Œçº§åˆ«å®šä¹‰

### Level 1: é™æ€å¯æ‰§è¡Œï¼ˆStatic Enforceableï¼‰

**å®šä¹‰**ï¼šå¯ä»¥é€šè¿‡ NetArchTest ç­‰é™æ€åˆ†æå·¥å…·å®Œå…¨è‡ªåŠ¨åŒ–æ£€æŸ¥çš„è§„åˆ™ã€‚

**ç‰¹å¾**ï¼š

- åŸºäºç±»å‹ã€å‘½åç©ºé—´ã€ä¾èµ–å…³ç³»çš„é™æ€çº¦æŸ
- æµ‹è¯•å¤±è´¥ = ç»å¯¹è¿è§„
- CI é˜»æ–­

**å·¥å…·**ï¼šArchitectureTestsï¼ˆNetArchTestï¼‰

**è§„åˆ™åˆ—è¡¨**ï¼š

| è§„åˆ™ç¼–å·        | è§„åˆ™æè¿°                          | æµ‹è¯•æ–¹æ³•                                                     |
|-------------|-------------------------------|----------------------------------------------------------|
| ADR-0005.1  | Handler åº”æœ‰æ˜ç¡®çš„å‘½åçº¦å®š             | `Handlers_Should_Have_Clear_Naming_Convention`           |
| ADR-0005.3  | Handler ä¸åº”ä¾èµ– ASP.NET ç±»å‹       | `Handlers_Should_Not_Depend_On_AspNet`                   |
| ADR-0005.4  | Handler åº”è¯¥æ˜¯æ— çŠ¶æ€çš„ï¼ˆå­—æ®µæ£€æŸ¥ï¼‰         | `Handlers_Should_Be_Stateless`                           |
| ADR-0005.5  | æ¨¡å—é—´ä¸åº”æœ‰æœªå®¡æ‰¹çš„åŒæ­¥è°ƒç”¨ï¼ˆä¾èµ–æ£€æŸ¥ï¼‰          | `Modules_Should_Not_Have_Synchronous_Cross_Module_Calls` |
| ADR-0005.6  | å¼‚æ­¥æ–¹æ³•åº”éµå¾ªå‘½åçº¦å®š                   | `Async_Methods_Should_Follow_Naming_Convention`          |
| ADR-0005.7  | æ¨¡å—ä¸åº”å…±äº«é¢†åŸŸå®ä½“                    | `Modules_Should_Not_Share_Domain_Entities`               |
| ADR-0005.9  | Command å’Œ Query Handler åº”æ˜ç¡®åˆ†ç¦» | `Command_And_Query_Handlers_Should_Be_Separated`         |
| ADR-0005.12 | æ‰€æœ‰ Handler åº”åœ¨æ¨¡å—ç¨‹åºé›†ä¸­           | `All_Handlers_Should_Be_In_Module_Assemblies`            |

---

### Level 2: è¯­ä¹‰åŠè‡ªåŠ¨ï¼ˆSemantic Semi-Autoï¼‰

**å®šä¹‰**ï¼šéœ€è¦è¯­ä¹‰åˆ†æçš„è§„åˆ™ï¼Œå»ºè®®é€šè¿‡ Roslyn Analyzer æ£€æŸ¥ï¼Œå½“å‰æµ‹è¯•åªèƒ½åšå¯å‘å¼æ£€æŸ¥ã€‚

**ç‰¹å¾**ï¼š

- éœ€è¦ç†è§£ä»£ç è¯­ä¹‰ï¼ˆå¦‚æ–¹æ³•è°ƒç”¨é“¾ã€ä¸šåŠ¡é€»è¾‘å¤æ‚åº¦ï¼‰
- å½“å‰æµ‹è¯•æ˜¯"å»ºè®®æ€§"è€Œé"å¼ºåˆ¶æ€§"
- æµ‹è¯•å¤±è´¥ = éœ€è¦äººå·¥å®¡æŸ¥

**å·¥å…·**ï¼š

- å½“å‰ï¼šArchitectureTestsï¼ˆå¯å‘å¼æ£€æŸ¥ï¼‰
- å»ºè®®ï¼šRoslyn Analyzerï¼ˆè‡ªå®šä¹‰åˆ†æå™¨ï¼‰

**è§„åˆ™åˆ—è¡¨**ï¼š

| è§„åˆ™ç¼–å·        | è§„åˆ™æè¿°                     | å½“å‰æµ‹è¯•æ–¹æ³•                                                   | Analyzer éœ€æ±‚                    |
|-------------|--------------------------|----------------------------------------------------------|--------------------------------|
| ADR-0005.2  | Endpoint ä¸åº”åŒ…å«ä¸šåŠ¡é€»è¾‘        | `Endpoints_Should_Not_Contain_Business_Logic`            | æ£€æŸ¥æ–¹æ³•ä½“å¤æ‚åº¦ã€ä¸šåŠ¡è§„åˆ™è°ƒç”¨                |
| ADR-0005.5  | æ¨¡å—é—´å¼‚æ­¥é€šä¿¡ï¼ˆHandler è°ƒç”¨æ£€æŸ¥ï¼‰    | `Modules_Should_Not_Have_Synchronous_Cross_Module_Calls` | æ£€æŸ¥æ–¹æ³•è°ƒç”¨é“¾ã€è·¨æ¨¡å— public æ–¹æ³•è°ƒç”¨        |
| ADR-0005.10 | Command Handler ä¸åº”è¿”å›ä¸šåŠ¡æ•°æ® | `CommandHandlers_Should_Not_Return_Business_Data`        | æ£€æŸ¥è¿”å›ç±»å‹çš„è¯­ä¹‰ï¼ˆç®€å•ç±»å‹ vs ä¸šåŠ¡å¯¹è±¡ï¼‰        |
| ADR-0005.11 | Handler åº”ä½¿ç”¨ç»“æ„åŒ–å¼‚å¸¸         | `Handlers_Should_Use_Structured_Exceptions`              | IL åˆ†æï¼Œæ£€æŸ¥ `throw new Exception` |

**Roslyn Analyzer å®ç°å»ºè®®**ï¼š

```csharp
// ç¤ºä¾‹ï¼šEndpoint ä¸šåŠ¡é€»è¾‘æ£€æŸ¥
[DiagnosticAnalyzer(LanguageNames.CSharp)]
public class EndpointBusinessLogicAnalyzer : DiagnosticAnalyzer
{
    // æ£€æµ‹ï¼š
    // 1. Endpoint æ–¹æ³•ä½“è¶…è¿‡ 10 è¡Œ
    // 2. Endpoint æ–¹æ³•åŒ…å« if/switch ä¸šåŠ¡åˆ¤æ–­
    // 3. Endpoint æ–¹æ³•ç›´æ¥æ“ä½œ DbContext
}
```

---

### Level 3: äººå·¥ Gateï¼ˆManual Gateï¼‰

**å®šä¹‰**ï¼šæ— æ³•ï¼ˆæˆ–ä¸åº”è¯¥ï¼‰å®Œå…¨è‡ªåŠ¨åŒ–çš„è§„åˆ™ï¼Œéœ€è¦äººå·¥å®¡æŸ¥å’Œå†³ç­–ã€‚

**ç‰¹å¾**ï¼š

- æ¶‰åŠä¸šåŠ¡è¯­ä¹‰ã€è®¾è®¡æ„å›¾ã€æ¶æ„æƒè¡¡
- æµ‹è¯•æ— æ³•è¦†ç›–ï¼Œæˆ–è¦†ç›–æˆæœ¬è¿‡é«˜
- ä¾èµ– PR Review + ARCH-VIOLATION æ ‡è®°

**å·¥å…·**ï¼š

- PR Checklist
- æ¶æ„å¸ˆ Code Review
- ARCH-VIOLATION è®°å½•è¡¨

**è§„åˆ™åˆ—è¡¨**ï¼š

| è§„åˆ™ç¼–å·       | è§„åˆ™æè¿°                         | äººå·¥å®¡æŸ¥è¦ç‚¹                                  |
|------------|------------------------------|-----------------------------------------|
| ADR-0005.5 | æ¨¡å—é—´åŒæ­¥è°ƒç”¨ç ´ä¾‹å®¡æ‰¹                  | æ˜¯å¦æœ‰æ˜ç¡®çš„è¿œç¨‹è°ƒç”¨å¥‘çº¦ï¼Ÿæ˜¯å¦å¤„ç†äº†è¶…æ—¶/é™çº§ï¼Ÿ                |
| ADR-0005.8 | Query Handler å¯ä»¥è¿”å› Contracts | è¿”å›çš„ Contract æ˜¯å¦ç‰ˆæœ¬åŒ–ï¼Ÿæ˜¯å¦åªè¯»ï¼Ÿ                |
| äº‹åŠ¡è¾¹ç•Œ       | è·¨æ¨¡å—äº‹åŠ¡ä¸ Saga                  | æ˜¯å¦çœŸçš„éœ€è¦å¼ºä¸€è‡´æ€§ï¼ŸSaga è¡¥å¿é€»è¾‘æ˜¯å¦å®Œæ•´ï¼Ÿ               |
| ä¸šåŠ¡å†³ç­–       | Handler èŒè´£åˆ’åˆ†                 | ä¸šåŠ¡é€»è¾‘æ˜¯å¦é›†ä¸­åœ¨ä¸€ä¸ª Handlerï¼Ÿæ˜¯å¦æœ‰éšè—çš„è·¨ Handler åä½œï¼Ÿ |

**äººå·¥ Gate æµç¨‹**ï¼š

1. **PR æäº¤æ—¶**ï¼šå¼€å‘è€…åœ¨ PR æ¨¡æ¿ä¸­å£°æ˜æ˜¯å¦å­˜åœ¨æ¶æ„ç ´ä¾‹
2. **CI æ£€æŸ¥**ï¼šå¦‚æœ ArchitectureTests å¤±è´¥ä½† PR å£°æ˜"æ— è¿è§„" â†’ è‡ªåŠ¨æ‹’ç»
3. **æ¶æ„å®¡æŸ¥**ï¼šå¦‚æœ PR å£°æ˜"æœ‰ç ´ä¾‹" â†’ æ¶æ„å¸ˆå®¡æŸ¥å¹¶å†³å®šæ˜¯å¦æ‰¹å‡†
4. **è®°å½•å½’æ¡£**ï¼šæ‰€æœ‰ç ´ä¾‹å¿…é¡»è®°å½•åœ¨ [`ARCH-VIOLATIONS.md`](../summaries/arch-violations.md) ä¸­

---

## ä¸‰çº§åˆ†ç±»çš„æ„ä¹‰

### å¯¹å¼€å‘è€…

- æ˜ç¡®çŸ¥é“å“ªäº›è§„åˆ™æ˜¯"çº¢çº¿"ï¼ˆLevel 1 æµ‹è¯•å¤±è´¥å¿…é¡»ä¿®å¤ï¼‰
- æ˜ç¡®çŸ¥é“å“ªäº›è§„åˆ™æ˜¯"å»ºè®®"ï¼ˆLevel 2 å¯ä»¥ç”³è¯·ç ´ä¾‹ï¼‰
- æ˜ç¡®çŸ¥é“å“ªäº›è§„åˆ™éœ€è¦"æ²Ÿé€š"ï¼ˆLevel 3 å¿…é¡»äººå·¥å®¡æ‰¹ï¼‰

### å¯¹æ¶æ„å¸ˆ

- Level 1ï¼šé›¶å®¹å¿ï¼ŒCI è‡ªåŠ¨é˜»æ–­
- Level 2ï¼šå¯åå•†ï¼Œä½†éœ€è¦å……åˆ†ç†ç”±
- Level 3ï¼šé¢„æœŸç ´ä¾‹ï¼Œé‡ç‚¹åœ¨äºè®°å½•å’Œå¯è¿½æº¯

### å¯¹å·¥å…·é“¾

- Level 1 â†’ NetArchTestï¼ˆå·²å®ç°ï¼‰
- Level 2 â†’ Roslyn Analyzerï¼ˆå»ºè®®å®ç°ï¼‰
- Level 3 â†’ PR Template + Review Processï¼ˆå¿…é¡»å®ç°ï¼‰

---

## å½“å‰çŠ¶æ€ä¸æ”¹è¿›è·¯å¾„

### âœ… å·²å®Œæˆ

- [x] Level 1 è§„åˆ™å·²é€šè¿‡ ArchitectureTests è¦†ç›–
- [x] æµ‹è¯•å¤±è´¥æ¶ˆæ¯æ˜ç¡®æ ‡æ³¨è¿è§„è§„åˆ™
- [x] Level 2 çš„ Roslyn Analyzer å·²å®ç°
  - âœ… Endpoint ä¸šåŠ¡é€»è¾‘æ£€æŸ¥ï¼ˆADR0005_02ï¼‰
  - âœ… Handler è·¨æ¨¡å—è°ƒç”¨è¯­ä¹‰æ£€æŸ¥ï¼ˆADR0005_05ï¼‰
  - âœ… å¼‚å¸¸ä½¿ç”¨è§„èŒƒæ£€æŸ¥ï¼ˆADR0005_11ï¼‰
- [x] Level 3 çš„äººå·¥ Gate æµç¨‹å·²å»ºç«‹
  - âœ… PR Template åŒ…å«æ¶æ„è¿è§„å£°æ˜
  - âœ… ARCH-VIOLATIONS è®°å½•è¡¨å­˜åœ¨
  - âœ… ç ´ä¾‹å®¡æ‰¹æµç¨‹å·²æ–‡æ¡£åŒ–

### âš ï¸ å¾…å®Œå–„ï¼ˆå¯é€‰ï¼‰

- [ ] æ‰©å±•æ›´å¤š Roslyn Analyzer
  - Command Handler è¿”å›å€¼æ£€æŸ¥ï¼ˆæ›´ä¸¥æ ¼çš„ç±»å‹åˆ¤æ–­ï¼‰
  - å¼‚æ­¥æ–¹æ³•å‘½åçº¦å®šæ£€æŸ¥
  - Handler æ— çŠ¶æ€å­—æ®µæ£€æŸ¥ï¼ˆæ›´æ·±å±‚çš„åˆ†æï¼‰
- [ ] å®šæœŸè¯„å®¡å’Œä¼˜åŒ–
  - æ”¶é›† Analyzer è¯¯æŠ¥æ¡ˆä¾‹ï¼Œä¼˜åŒ–æ£€æµ‹é€»è¾‘
  - æ ¹æ®å›¢é˜Ÿåé¦ˆè°ƒæ•´ä¸¥é‡çº§åˆ«
  - å®šæœŸæ›´æ–°æ¶æ„çº¦æŸ

### ğŸ¯ æœ€ç»ˆç›®æ ‡

**ADR-0005 ä¸æ˜¯ä¸€ä¸ª"å…¨è‡ªåŠ¨æ£€æŸ¥å·¥å…·"ï¼Œè€Œæ˜¯ä¸€ä¸ª"ä¸‰å±‚é˜²å¾¡ä½“ç³»"**ï¼š

1. **è‡ªåŠ¨åŒ–å±‚**ï¼ˆLevel 1ï¼‰ï¼šæ‹¦æˆª 90% çš„æ˜æ˜¾è¿è§„
2. **è¾…åŠ©å·¥å…·å±‚**ï¼ˆLevel 2ï¼‰ï¼šæç¤ºæ½œåœ¨é£é™©ï¼Œè¾…åŠ©äººå·¥å†³ç­–
3. **äººå·¥å†³ç­–å±‚**ï¼ˆLevel 3ï¼‰ï¼šå¤„ç†å¤æ‚åœºæ™¯ï¼Œè®°å½•æƒè¡¡è¿‡ç¨‹

---

## ç»“è®º

> **ADR-0005 çš„æœ¬è´¨æ˜¯"è¿è¡Œæ—¶ç§©åº"ï¼Œé™æ€æµ‹è¯•æ˜¯"è¿‘ä¼¼æ‰§è¡Œ"ï¼Œä¸æ˜¯"å®Œå…¨æ‰§è¡Œ"ã€‚**

é€šè¿‡ä¸‰çº§åˆ†ç±»ï¼š

- æˆ‘ä»¬æ‰¿è®¤å·¥å…·çš„å±€é™æ€§
- æˆ‘ä»¬ä¸ä¾èµ–å•ä¸€å·¥å…·çš„"å®Œç¾"
- æˆ‘ä»¬å»ºç«‹äº†äººæœºåä½œçš„æ¶æ„æ²»ç†ä½“ç³»

è¿™ä¸æ˜¯å¦¥åï¼Œè¿™æ˜¯æˆç†Ÿã€‚

---

## å˜æ›´æ”¿ç­–ï¼ˆChange Policyï¼‰

- **ADR-905**ï¼ˆè¡¥å……æ€§æ–‡æ¡£ï¼‰
  - æœ¬ ADR æ˜¯ ADR-0005 çš„è¡¥å……è¯´æ˜ï¼Œå®šä¹‰æ‰§è¡Œçº§åˆ«åˆ†ç±»
  - ä¿®æ”¹éœ€ Tech Lead å®¡æ‰¹
  - ä¿®æ”¹æ—¶éœ€åŒæ­¥æ›´æ–° ADR-0005 çš„ç›¸å…³ç« èŠ‚
  - éœ€è¦æ›´æ–°å¯¹åº”çš„æ¶æ„æµ‹è¯•å’Œ Roslyn Analyzer

---

## å…³ç³»å£°æ˜ï¼ˆRelationshipsï¼‰

**ä¾èµ–ï¼ˆDepends Onï¼‰**ï¼š
- [ADR-0005ï¼šåº”ç”¨å†…äº¤äº’æ¨¡å‹ä¸æ‰§è¡Œè¾¹ç•Œ](../constitutional/ADR-0005-Application-Interaction-Model-Final.md) - æœ¬æ–‡æ¡£æ˜¯ ADR-0005 çš„æ‰§è¡Œçº§åˆ«è¡¥å……
- [ADR-0000ï¼šæ¶æ„æµ‹è¯•ä¸ CI æ²»ç†å®ªæ³•](./ADR-0000-architecture-tests.md) - æ‰§è¡Œçº§åˆ«åŸºäºæµ‹è¯•å’Œ CI æ²»ç†æœºåˆ¶

**è¢«ä¾èµ–ï¼ˆDepended Byï¼‰**ï¼š
- æ— 

**æ›¿ä»£ï¼ˆSupersedesï¼‰**ï¼š
- æ— 

**è¢«æ›¿ä»£ï¼ˆSuperseded Byï¼‰**ï¼š
- æ— 

**ç›¸å…³ï¼ˆRelatedï¼‰**ï¼š
- [ADR-0002ï¼šPlatform / Application / Host ä¸‰å±‚å¯åŠ¨ä½“ç³»](../constitutional/ADR-0002-platform-application-host-bootstrap.md)
- [ADR-0001ï¼šæ¨¡å—åŒ–å•ä½“ä¸å‚ç›´åˆ‡ç‰‡æ¶æ„](../constitutional/ADR-0001-modular-monolith-vertical-slice-architecture.md)
- [ADR-0003ï¼šå‘½åç©ºé—´ä¸é¡¹ç›®è¾¹ç•Œè§„èŒƒ](../constitutional/ADR-0003-namespace-rules.md)
- [ADR-0004ï¼šä¸­å¤®åŒ…ç®¡ç†ï¼ˆCPMï¼‰è§„èŒƒ](../constitutional/ADR-0004-Cpm-Final.md)
- [ADR-124ï¼šEndpoint å‘½ååŠå‚æ•°çº¦æŸè§„èŒƒ](../structure/ADR-124-endpoint-naming-constraints.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«
- [ADR-120ï¼šé¢†åŸŸäº‹ä»¶å‘½åè§„èŒƒ](../structure/ADR-120-domain-event-naming-convention.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«
- [ADR-121ï¼šå¥‘çº¦ï¼ˆContractï¼‰ä¸ DTO å‘½åç»„ç»‡è§„èŒƒ](../structure/ADR-121-contract-dto-naming-organization.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«
- [ADR-210ï¼šé¢†åŸŸäº‹ä»¶ç‰ˆæœ¬åŒ–ä¸å…¼å®¹æ€§](../runtime/ADR-210-event-versioning-compatibility.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«
- [ADR-240ï¼šHandler å¼‚å¸¸çº¦æŸ](../runtime/ADR-240-handler-exception-constraints.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«
- [ADR-201ï¼šHandler ç”Ÿå‘½å‘¨æœŸç®¡ç†](../runtime/ADR-201-handler-lifecycle-management.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«
- [ADR-220ï¼šäº‹ä»¶æ€»çº¿é›†æˆè§„èŒƒ](../runtime/ADR-220-event-bus-integration.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«
- [ADR-920ï¼šç¤ºä¾‹ä»£ç æ²»ç†å®ªæ³•](./ADR-920-examples-governance-constitution.md) - å‚è€ƒæœ¬æ–‡æ¡£çš„æ‰§è¡Œçº§åˆ«

---
