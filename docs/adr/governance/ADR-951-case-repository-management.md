# ADR-951：案例库管理规范

> ⚖️ **本 ADR 定义案例库的组织、审核和维护标准。**

**状态**：✅ Accepted（已采纳）  
**级别**：治理层 / 内容管理  
**适用范围**：所有案例文档（docs/cases/）  
**生效时间**：即刻

---

## 聚焦内容（Focus）

- 案例库结构组织
- 案例文档标准
- 案例审核标准
- 案例维护机制

---

## 术语表（Glossary）

| 术语 | 定义 | 英文对照 |
|------|------|----------|
| 案例 | 记录实际问题和解决方案的文档 | Case Study |
| 案例库 | 所有案例的集合和组织结构 | Case Repository |
| 最佳实践 | 经过验证的优秀解决方案 | Best Practice |
| 反模式 | 应该避免的错误做法 | Anti-Pattern |

---

## 决策（Decision）

### 案例库结构组织（ADR-951.1）

**规则**：

**目录结构**：
```
docs/cases/
├── README.md                        # 案例库索引
├── module-communication/            # 模块通信案例
│   ├── event-based-communication.md
│   └── contract-based-query.md
├── testing/                         # 测试案例
│   ├── handler-unit-testing.md
│   └── integration-testing.md
├── refactoring/                     # 重构案例
│   ├── vertical-slice-migration.md
│   └── service-to-handler.md
└── common-mistakes/                 # 常见错误
    ├── cross-module-dependency.md
    └── handler-return-dto.md
```

**分类标准**：
- 按主题领域分类（模块通信、测试、重构等）
- 每个分类包含 README.md 索引
- 案例文件命名：小写字母 + 连字符

**判定**：
- ❌ 案例未分类或分类不清
- ✅ 案例按主题组织且有索引

---

### 案例文档标准（ADR-951.2）

**规则**：

**必需章节**：
1. 元数据：适用场景、相关 ADR、难度、作者、日期
2. 背景：问题描述
3. 解决方案：方案说明
4. 代码示例：完整可运行代码
5. 常见陷阱：需要注意的点
6. 相关案例：链接

**元数据格式**：
```markdown
**适用场景**：[一句话说明何时使用]
**相关 ADR**：[ADR-XXXX](链接)
**难度**：简单/中等/困难
**级别**：Core/Reference
**作者**：[GitHub 用户名]
**日期**：YYYY-MM-DD
**标签**：#模块通信 #事件 #异步
```

**案例级别定义**：

| 级别 | 定义 | 审核要求 | 示例 |
|------|------|----------|------|
| **Core** | 核心场景，高频使用，架构关键 | 强审核（2 位 reviewer + 完整清单） | 模块间事件通信 |
| **Reference** | 参考场景，特定问题，边缘情况 | 弱审核（1 位 reviewer + 基础清单） | 特定工具配置 |

**级别判定标准**：
- **Core**：ADR 直接相关、跨模块、高频使用、架构决策关键
- **Reference**：特定场景、低频、边缘情况、辅助参考

**代码示例要求**：
- 必须可编译/可运行
- 包含必要的 using/import
- 包含注释说明关键点
- 标记正确 (✅) 和错误 (❌) 做法

**判定**：
- ❌ 案例缺少必需章节
- ❌ 代码示例无法运行
- ❌ 级别标记缺失
- ✅ 案例结构完整且代码可运行

---

### 案例审核标准（ADR-951.3）

**规则**：

**分级审核流程**：

**Core 案例审核**：
- [ ] ADR 合规性审核
- [ ] 代码质量审核
- [ ] 内容完整性审核
- [ ] 实用性审核
- 至少 2 位 reviewer 批准
- 必须通过完整审核清单

**Reference 案例审核**：
- [ ] ADR 合规性审核（基础）
- [ ] 代码可运行性审核
- 至少 1 位 reviewer 批准
- 通过基础审核清单

**完整审核清单（Core）**：

**1. ADR 合规性审核**
- [ ] 解决方案符合相关 ADR
- [ ] 未引入架构违规
- [ ] 正确引用 ADR

**2. 代码质量审核**
- [ ] 代码可编译/可运行
- [ ] 代码符合项目编码规范
- [ ] 代码包含必要注释

**3. 内容完整性审核**
- [ ] 包含所有必需章节
- [ ] 背景描述清晰
- [ ] 解决方案详细
- [ ] 常见陷阱完整

**4. 实用性审核**
- [ ] 场景真实存在
- [ ] 解决方案可行
- [ ] 对读者有价值

**基础审核清单（Reference）**：
- [ ] 解决方案符合相关 ADR
- [ ] 代码可编译/可运行
- [ ] 包含必需章节

**审核流程**：
1. 作者提交 PR，标记案例级别
2. 标记为 `case-review`
3. 根据级别执行对应审核
4. 合并后添加到案例库索引

**判定**：
- ❌ 案例未经审核直接合并
- ❌ 审核清单与级别不匹配
- ❌ Core 案例使用弱审核
- ✅ 案例按级别完成对应审核

---

### 案例维护机制（ADR-951.4）

**规则**：

**年度审核**：
每年审核所有案例：

**审核清单**：
- [ ] 代码是否符合当前 ADR
- [ ] 是否有更好的解决方案
- [ ] 是否需要标记为过时
- [ ] 引用的 ADR 是否有效

**过时案例处理**：
1. 在标题前添加 `[已过时]` 标记
2. 添加过时原因和日期
3. 链接到推荐的新案例
4. 不删除，保留历史参考

**示例**：
```markdown
# [已过时] 案例：Service 层模式

> ⚠️ **过时通知**：本案例已过时（2026-01-26），因 ADR-0001 禁止 Service 层。  
> 请参考：[Handler 模式案例](../handler-pattern.md)
```

**更新机制**：
- 发现问题时，创建 Issue 跟踪
- 每季度回顾 Issues，优先处理
- 更新后递增版本号

**判定**：
- ❌ 过时案例未标记
- ❌ 超过 1 年未审核
- ✅ 案例及时维护和更新

---

## 执法模型（Enforcement）

### 测试映射

| 规则编号 | 执行级 | 测试/手段 |
|---------|--------|----------|
| ADR-951.1 | L2 | 目录结构检查 |
| ADR-951.2 | L2 | PR Review |
| ADR-951.3 | L2 | PR Review Checklist |
| ADR-951.4 | L2 | 年度审核日历 |

---

## 破例与归还（Exception）

### 允许破例的前提

破例 **仅在以下情况允许**：
- 紧急案例，可先合并后补充审核

### 破例要求

每个破例 **必须**：
- 在 PR 中说明紧急原因
- 在 1 周内补充完整审核
- 记录在 Issue 中跟踪

---

## 变更政策（Change Policy）

### 变更规则

- **修改案例结构标准**：Tech Lead 可批准
- **修改审核标准**：Tech Lead 可批准
- **新增分类**：Tech Lead 可批准

---

## 明确不管什么（Non-Goals）

本 ADR **不负责**：
- 案例内容的技术准确性（由 Code Review 保证）
- 案例写作风格
- 案例优先级排序

---

## 关系声明（Relationships）

**依赖（Depends On）**：
- [ADR-950：指南与 FAQ 文档治理宪法](ADR-950-guide-faq-documentation-governance.md) - 基于 Case 类型定义

**被依赖（Depended By）**：无

**替代（Supersedes）**：无

**被替代（Superseded By）**：无

**相关（Related）**：
- [ADR-920：示例代码治理宪法](ADR-920-examples-governance-constitution.md) - 示例代码规范

---

## 非裁决性参考（References）

### 模板

- [Case 模板](../../templates/case-template.md)

### 相关文档

- [案例库索引](../../cases/README.md)
- [案例审核清单](../../templates/case-review-checklist.md)

---

## 版本历史

| 版本 | 日期 | 变更说明 | 作者 |
|------|------|----------|------|
| 1.0 | 2026-01-26 | 初始版本，定义案例库管理规范 | GitHub Copilot |

---

**维护**：Tech Lead  
**审核**：@douhuaa  
**状态**：✅ Accepted
