---
adr: ADR-220
title: "äº‹ä»¶æ€»çº¿é›†æˆè§„èŒƒ"
status: Final
level: Runtime
version: "3.0"
deciders: "Architecture Board"
date: 2026-02-06
maintainer: "Architecture Board"
primary_enforcement: L1
reviewer: "GitHub Copilot"
supersedes: null
superseded_by: null
---


# ADR-220ï¼šäº‹ä»¶æ€»çº¿é›†æˆè§„èŒƒ

> âš–ï¸ **æœ¬ ADR å®šä¹‰äº‹ä»¶æ€»çº¿é›†æˆçš„æ¶æ„çº¦æŸï¼Œç¡®ä¿æ¨¡å—é—´é€šä¿¡çš„æ¾è€¦åˆå’Œå¯é æ€§ã€‚**

**é€‚ç”¨èŒƒå›´**ï¼šæ‰€æœ‰æ¨¡å—é—´äº‹ä»¶é€šä¿¡  
## Focusï¼ˆèšç„¦å†…å®¹ï¼‰

- äº‹ä»¶æ€»çº¿æŠ½è±¡ä¸ä¾èµ–éš”ç¦»
- è‡³å°‘ä¸€æ¬¡ä¼ é€’ä¿è¯
- åŒæ­¥ç­‰å¾…ç¦æ­¢çº¦æŸ
- äº‹ä»¶è®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸ
- è·¨æ¨¡å—æ•°æ®å¥‘çº¦çº¦æŸ
- äº‹ä»¶æ€»çº¿æµ‹è¯•æ‰§æ³•

---

---

## Glossaryï¼ˆæœ¯è¯­è¡¨ï¼‰

| æœ¯è¯­ | å®šä¹‰ | è‹±æ–‡å¯¹ç…§ |
|-----|------|---------|
| äº‹ä»¶æ€»çº¿ | æ¨¡å—é—´å¼‚æ­¥é€šä¿¡çš„åŸºç¡€è®¾æ–½ | Event Bus |
| è‡³å°‘ä¸€æ¬¡ä¼ é€’ | æ¶ˆæ¯è‡³å°‘ä¼šè¢«ä¼ é€’ä¸€æ¬¡ï¼Œå¯èƒ½é‡å¤ | At-Least-Once Delivery |
| Outbox Pattern | é€šè¿‡æ•°æ®åº“äº‹åŠ¡ä¿è¯æ¶ˆæ¯å¯é å‘é€çš„æ¨¡å¼ | Outbox Pattern |
| å‘é€å³å¿˜è®° | å‘é€æ¶ˆæ¯åä¸ä¿è¯é€è¾¾çš„æ¨¡å¼ | Fire-and-Forget |
| æ•°æ®å¥‘çº¦ | åªè¯»ã€ç‰ˆæœ¬åŒ–çš„è·¨æ¨¡å—æ•°æ®ä¼ è¾“å¯¹è±¡ | Data Contract / DTO |
| å¹‚ç­‰æ€§ | é‡å¤æ‰§è¡Œäº§ç”Ÿç›¸åŒç»“æœçš„ç‰¹æ€§ | Idempotency |

---

---

## Decisionï¼ˆè£å†³ï¼‰

> âš ï¸ **æœ¬èŠ‚ä¸ºå”¯ä¸€è£å†³æ¥æºï¼Œæ‰€æœ‰æ¡æ¬¾å…·å¤‡æ‰§è¡Œçº§åˆ«ã€‚**
> 
> ğŸ”’ **ç»Ÿä¸€é“å¾‹**ï¼š
> 
> ADR-220 ä¸­ï¼Œæ‰€æœ‰å¯æ‰§æ³•æ¡æ¬¾å¿…é¡»å…·å¤‡ç¨³å®š RuleIdï¼Œæ ¼å¼ä¸ºï¼š
> ```
> ADR-220_<Rule>_<Clause>
> ```

---

### ADR-220_1ï¼šäº‹ä»¶æ€»çº¿ä¾èµ–éš”ç¦»ï¼ˆRuleï¼‰

#### ADR-220_1_1 ç¦æ­¢ç›´æ¥ä¾èµ–å…·ä½“äº‹ä»¶æ€»çº¿å®ç°

**è§„åˆ™**ï¼š
- æ¨¡å—ä»£ç ç¦æ­¢ç›´æ¥ä¾èµ–å…·ä½“äº‹ä»¶æ€»çº¿å®ç°
- å¼ºåˆ¶è¦æ±‚ï¼š
  - âœ… å¿…é¡»é€šè¿‡ `IEventBus` æŠ½è±¡æ¥å£
  - âœ… äº‹ä»¶æ€»çº¿å®ç°åœ¨ Platform æˆ– Infrastructure å±‚
  - âŒ ç¦æ­¢åœ¨æ¨¡å—ä¸­å¼•ç”¨ `Wolverine.*`ã€`Kafka.*` ç­‰åŒ…
  - âŒ ç¦æ­¢ç›´æ¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®¢æˆ·ç«¯

**åˆ¤å®š**ï¼š
- âŒ æ¨¡å—ä»£ç å¼•ç”¨å…·ä½“äº‹ä»¶æ€»çº¿åŒ…
- âŒ æ¨¡å—ä»£ç ç›´æ¥ä½¿ç”¨ MassTransit/NServiceBus/Kafka å®¢æˆ·ç«¯
- âœ… æ¨¡å—ä»…ä¾èµ– `IEventBus` æŠ½è±¡

---

---

### ADR-220_2ï¼šè‡³å°‘ä¸€æ¬¡ä¼ é€’ä¿è¯ï¼ˆRuleï¼‰

#### ADR-220_2_1 äº‹ä»¶å¯é ä¼ é€’æœºåˆ¶è¦æ±‚

**è§„åˆ™**ï¼š
- äº‹ä»¶å‘å¸ƒå¿…é¡»ä¿è¯è‡³å°‘ä¸€æ¬¡ä¼ é€’
- å®ç°è¦æ±‚ï¼š
  - âœ… ä½¿ç”¨ Outbox Pattern æˆ–ç­‰æ•ˆæœºåˆ¶
  - âœ… äº‹ä»¶æŒä¹…åŒ–åˆ°æ•°æ®åº“
  - âœ… æ”¯æŒé‡è¯•æœºåˆ¶
  - âŒ ç¦æ­¢"å‘é€å³å¿˜è®°"ï¼ˆFire-and-Forgetï¼‰
  
- å®¹å¿åœºæ™¯ï¼š
  - è®¢é˜…è€…å¿…é¡»å®ç°å¹‚ç­‰æ€§å¤„ç†é‡å¤äº‹ä»¶

**åˆ¤å®š**ï¼š
- âŒ äº‹ä»¶å‘å¸ƒæœªæŒä¹…åŒ–
- âŒ æ— é‡è¯•æœºåˆ¶
- âŒ ä½¿ç”¨ Fire-and-Forget æ¨¡å¼
- âœ… å®ç° Outbox Pattern æˆ–ç­‰æ•ˆæœºåˆ¶

---

---

### ADR-220_3ï¼šå¼‚æ­¥é€šä¿¡çº¦æŸï¼ˆRuleï¼‰

#### ADR-220_3_1 ç¦æ­¢åŒæ­¥ç­‰å¾…äº‹ä»¶å¤„ç†

**è§„åˆ™**ï¼š
- è°ƒç”¨æ–¹ç¦æ­¢åœ¨å‘å¸ƒäº‹ä»¶åç­‰å¾…äº‹ä»¶å¤„ç†ç»“æœ
- äº‹ä»¶å‘å¸ƒå¿…é¡»æ˜¯çœŸæ­£çš„å¼‚æ­¥æ“ä½œ
- ç¦æ­¢åœ¨å‘å¸ƒåé€šè¿‡è½®è¯¢æˆ–å›è°ƒç­‰å¾…ç»“æœ

**åˆ¤å®š**ï¼š
- âŒ å‘å¸ƒäº‹ä»¶åç­‰å¾…å¤„ç†ç»“æœ
- âŒ å‘å¸ƒäº‹ä»¶åè½®è¯¢çŠ¶æ€
- âŒ ä½¿ç”¨å›è°ƒæœºåˆ¶ç­‰å¾…äº‹ä»¶å®Œæˆ
- âœ… å‘å¸ƒäº‹ä»¶åç«‹å³è¿”å›

---

---

### ADR-220_4ï¼šäº‹ä»¶è®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸï¼ˆRuleï¼‰

#### ADR-220_4_1 è®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸæ³¨å†Œè¦æ±‚

**è§„åˆ™**ï¼š
- äº‹ä»¶è®¢é˜…è€…å¿…é¡»æ³¨å†Œä¸º Scoped æˆ– Transient ç”Ÿå‘½å‘¨æœŸ
- ç”Ÿå‘½å‘¨æœŸè§„åˆ™ï¼š
  - âœ… Scopedï¼ˆæ¨èï¼‰ï¼šæ¯ä¸ªäº‹ä»¶å¤„ç†æœ‰ç‹¬ç«‹å®ä¾‹
  - âœ… Transientï¼šæ¯æ¬¡æ³¨å…¥åˆ›å»ºæ–°å®ä¾‹
  - âŒ ç¦æ­¢ Singletonï¼šé¿å…çŠ¶æ€æ±¡æŸ“

**åˆ¤å®š**ï¼š
- âŒ EventHandler æ³¨å†Œä¸º Singleton
- âœ… EventHandler æ³¨å†Œä¸º Scoped
- âœ… EventHandler æ³¨å†Œä¸º Transient

---

---

### ADR-220_5ï¼šè·¨æ¨¡å—æ•°æ®å¥‘çº¦çº¦æŸï¼ˆRuleï¼‰

#### ADR-220_5_1 äº‹ä»¶æ•°æ®å¥‘çº¦ç±»å‹çº¦æŸ

**è§„åˆ™**ï¼š
- è·¨æ¨¡å—äº‹ä»¶å¿…é¡»ä»…åŒ…å«æ•°æ®å¥‘çº¦æˆ–åŸå§‹ç±»å‹
- å…è®¸çš„æ•°æ®ç±»å‹ï¼š
  - âœ… åŸå§‹ç±»å‹ï¼ˆintã€stringã€Guidã€DateTimeï¼‰
  - âœ… æ•°æ®å¥‘çº¦ï¼ˆDTOï¼‰
  - âœ… å€¼å¯¹è±¡ï¼ˆå¦‚ Moneyã€Addressï¼‰
  
- ç¦æ­¢çš„æ•°æ®ç±»å‹ï¼š
  - âŒ é¢†åŸŸå®ä½“
  - âŒ èšåˆæ ¹
  - âŒ é¢†åŸŸæœåŠ¡

**åˆ¤å®š**ï¼š
- âŒ äº‹ä»¶åŒ…å«é¢†åŸŸå®ä½“æˆ–èšåˆæ ¹
- âŒ äº‹ä»¶åŒ…å«é¢†åŸŸæœåŠ¡å¼•ç”¨
- âœ… äº‹ä»¶ä»…åŒ…å«åŸå§‹ç±»å‹å’Œ DTO

---

---

## Enforcementï¼ˆæ‰§æ³•æ¨¡å‹ï¼‰

> ğŸ“‹ **Enforcement æ˜ å°„è¯´æ˜**ï¼š
> 
> ä¸‹è¡¨å±•ç¤ºäº† ADR-220 å„æ¡æ¬¾ï¼ˆClauseï¼‰çš„æ‰§æ³•æ–¹å¼åŠæ‰§è¡Œçº§åˆ«ã€‚

| è§„åˆ™ç¼–å· | æ‰§è¡Œçº§ | æ‰§æ³•æ–¹å¼ | Decision æ˜ å°„ |
|---------|--------|---------|--------------|
| **ADR-220_1_1** | L1 | ArchitectureTests è‡ªåŠ¨åŒ–éªŒè¯ | Â§ADR-220_1_1 ç¦æ­¢ç›´æ¥ä¾èµ–å…·ä½“äº‹ä»¶æ€»çº¿å®ç° |
| **ADR-220_2_1** | L1 | ArchitectureTests è‡ªåŠ¨åŒ–éªŒè¯ + ä»£ç å®¡æŸ¥ | Â§ADR-220_2_1 äº‹ä»¶å¯é ä¼ é€’æœºåˆ¶è¦æ±‚ |
| **ADR-220_3_1** | L1 | ArchitectureTests è‡ªåŠ¨åŒ–éªŒè¯ | Â§ADR-220_3_1 ç¦æ­¢åŒæ­¥ç­‰å¾…äº‹ä»¶å¤„ç† |
| **ADR-220_4_1** | L1 | ArchitectureTests è‡ªåŠ¨åŒ–éªŒè¯ | Â§ADR-220_4_1 è®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸæ³¨å†Œè¦æ±‚ |
| **ADR-220_5_1** | L1 | ArchitectureTests è‡ªåŠ¨åŒ–éªŒè¯ | Â§ADR-220_5_1 äº‹ä»¶æ•°æ®å¥‘çº¦ç±»å‹çº¦æŸ |

### æ‰§è¡Œçº§åˆ«è¯´æ˜
- **L1ï¼ˆé˜»æ–­çº§ï¼‰**ï¼šè¿è§„ç›´æ¥å¯¼è‡´ CI å¤±è´¥ã€é˜»æ­¢åˆå¹¶/éƒ¨ç½²
- **L2ï¼ˆè­¦å‘Šçº§ï¼‰**ï¼šè¿è§„è®°å½•å‘Šè­¦ï¼Œéœ€äººå·¥ Code Review è£å†³
- **L3ï¼ˆäººå·¥çº§ï¼‰**ï¼šéœ€è¦æ¶æ„å¸ˆäººå·¥è£å†³


---
---

## Non-Goalsï¼ˆæ˜ç¡®ä¸ç®¡ä»€ä¹ˆï¼‰

æœ¬ ADR æ˜ç¡®ä¸æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š

- äº‹ä»¶æ€»çº¿çš„å…·ä½“å®ç°é€‰å‹ï¼ˆWolverine/MassTransit/NServiceBusï¼‰
- æ¶ˆæ¯é˜Ÿåˆ—çš„å…·ä½“é…ç½®ï¼ˆKafka/RabbitMQ/Azure Service Busï¼‰
- äº‹ä»¶çš„ä¸šåŠ¡è¯­ä¹‰å’Œå†…å®¹ç»“æ„ï¼ˆç”± ADR-120ã€ADR-210 å®šä¹‰ï¼‰
- äº‹ä»¶è®¢é˜…è€…çš„å…·ä½“ä¸šåŠ¡é€»è¾‘å®ç°
- äº‹ä»¶çš„æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§ç­–ç•¥
- åˆ†å¸ƒå¼è¿½è¸ªå’Œæ—¥å¿—è®°å½•çš„å…·ä½“å®ç°

---

## Prohibitedï¼ˆç¦æ­¢è¡Œä¸ºï¼‰

ä»¥ä¸‹è¡Œä¸ºæ˜ç¡®ç¦æ­¢ï¼š

- âŒ æ¨¡å—ç›´æ¥å¼•ç”¨å…·ä½“äº‹ä»¶æ€»çº¿å®ç°åŒ…ï¼ˆå¦‚ Wolverineã€Kafka å®¢æˆ·ç«¯ï¼‰
- âŒ ä½¿ç”¨ Fire-and-Forget æ¨¡å¼å‘å¸ƒäº‹ä»¶
- âŒ å‘å¸ƒäº‹ä»¶ååŒæ­¥ç­‰å¾…å¤„ç†ç»“æœ
- âŒ å°† EventHandler æ³¨å†Œä¸º Singleton ç”Ÿå‘½å‘¨æœŸ
- âŒ åœ¨äº‹ä»¶ä¸­ä¼ é€’é¢†åŸŸå®ä½“æˆ–èšåˆæ ¹
- âŒ åœ¨äº‹ä»¶ä¸­ä¼ é€’é¢†åŸŸæœåŠ¡å¼•ç”¨
- âŒ è·³è¿‡ Outbox Pattern ç›´æ¥å‘é€äº‹ä»¶


---

---

## Relationshipsï¼ˆå…³ç³»å£°æ˜ï¼‰

**ä¾èµ–ï¼ˆDepends Onï¼‰**ï¼š
- [ADR-120ï¼šé¢†åŸŸäº‹ä»¶å‘½åçº¦å®š](../structure/ADR-120-domain-event-naming-convention.md) - äº‹ä»¶æ€»çº¿é›†æˆä¾èµ–äº‹ä»¶å‘½åè§„èŒƒ
- [ADR-005ï¼šåº”ç”¨å†…äº¤äº’æ¨¡å‹ä¸æ‰§è¡Œè¾¹ç•Œ](../constitutional/ADR-005-Application-Interaction-Model-Final.md) - äº‹ä»¶æ€»çº¿æ˜¯æ¨¡å—é—´é€šä¿¡çš„å®ç°

**è¢«ä¾èµ–ï¼ˆDepended Byï¼‰**ï¼š
- æ— 

**æ›¿ä»£ï¼ˆSupersedesï¼‰**ï¼š
- æ— 

**è¢«æ›¿ä»£ï¼ˆSuperseded Byï¼‰**ï¼š
- æ— 

**ç›¸å…³ï¼ˆRelatedï¼‰**ï¼š
- [ADR-210ï¼šäº‹ä»¶ç‰ˆæœ¬åŒ–ä¸å…¼å®¹æ€§](./ADR-210-event-versioning-compatibility.md) - äº‹ä»¶åºåˆ—åŒ–å’Œç‰ˆæœ¬åŒ–
- [ADR-201ï¼šHandler ç”Ÿå‘½å‘¨æœŸç®¡ç†](./ADR-201-handler-lifecycle-management.md) - äº‹ä»¶è®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

---

## Referencesï¼ˆéè£å†³æ€§å‚è€ƒï¼‰

> **ä»…ä¾›ç†è§£ï¼Œä¸å…·è£å†³åŠ›ã€‚**

### ç›¸å…³ ADR
- [ADR-001ï¼šæ¨¡å—åŒ–å•ä½“ä¸å‚ç›´åˆ‡ç‰‡æ¶æ„](../constitutional/ADR-001-modular-monolith-vertical-slice-architecture.md)
- [ADR-210ï¼šé¢†åŸŸäº‹ä»¶ç‰ˆæœ¬åŒ–ä¸å…¼å®¹æ€§](ADR-210-event-versioning-compatibility.md)

### æŠ€æœ¯èµ„æº
- [Outbox Pattern](https://microservices.io/patterns/data/transactional-outbox.html)
- [At-Least-Once Delivery](https://docs.microsoft.com/en-us/azure/service-bus-messaging/message-sessions)

### å®è·µæŒ‡å¯¼
- äº‹ä»¶æ€»çº¿é…ç½®ç¤ºä¾‹å‚è§ `docs/copilot/adr-220.prompts.md`

---

---

## Historyï¼ˆç‰ˆæœ¬å†å²ï¼‰

| ç‰ˆæœ¬  | æ—¥æœŸ         | å˜æ›´è¯´æ˜   |
|-----|------------|--------|
| 3.0 | 2026-02-06 | å¯¹é½ ADR-907-A v2.0 æ ‡å‡†ï¼šè½¬æ¢ä¸º Rule/Clause åŒå±‚ç¼–å·ä½“ç³»ï¼Œè¡¥å……å®Œæ•´ Enforcement æ˜ å°„è¡¨ã€Non-Goals å’Œ Prohibited ç« èŠ‚ |
| 2.0 | 2026-01-25 | è¡¥å……è®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸå’Œæ•°æ®å¥‘çº¦çº¦æŸ |
| 1.0 | 2026-01-29 | åˆå§‹ç‰ˆæœ¬ |
