---
adr: ADR-904
title: "ArchitectureTests æœ€å°æ–­è¨€è¯­ä¹‰è§„èŒƒ"
status: Superseded
level: Governance
version: "1.0"
deciders: "Architecture Board"
date: 2026-01-27
maintainer: "Architecture Board"
primary_enforcement: L1
reviewer: "GitHub Copilot"
supersedes: null
superseded_by: ADR-903-906
---


# ADR-904ï¼šArchitectureTests æœ€å°æ–­è¨€è¯­ä¹‰è§„èŒƒ

> ğŸ›ï¸ **Archived Notice**
>
> æœ¬ ADR å·²è¢« [ADR-907](../../governance/ADR-907-architecture-tests-enforcement-governance.md) å®Œå…¨å¸æ”¶å¹¶å–ä»£ã€‚
>
> - æœ¬æ–‡ä»¶ **ä¸å†å…·å¤‡ä»»ä½•è£å†³åŠ›**
> - **ä¸å¾—** ç¼–å†™æˆ–ç»´æŠ¤å¯¹åº” ArchitectureTests
> - **ä¸å¾—** è¢« Analyzer / CI Gate è¯»å–
> - ä»…ç”¨äº **å†å²è¿½æº¯ä¸è®¾è®¡æ¼”è¿›è¯´æ˜**

---

## Focusï¼ˆèšç„¦å†…å®¹ï¼‰

- é˜²æ­¢ ArchitectureTests ç©ºæ´æˆ–ä»…åšå½¢å¼éªŒè¯
- ç¡®ä¿æ¯æ¡ ADR çš„æµ‹è¯•æ–­è¨€**çœŸå®åæ˜ è§„åˆ™å†…å®¹**
- å®šä¹‰æœ€å°æœ‰æ•ˆæ–­è¨€æ•°é‡å’Œè¯­ä¹‰æ ¡éªŒè¦æ±‚
- æ”¯æŒ CI / Analyzer è‡ªåŠ¨åŒ–æ£€æµ‹ä¸åä½œå¼Š

---

## Glossaryï¼ˆæœ¯è¯­è¡¨ï¼‰

| æœ¯è¯­ | å®šä¹‰ | è‹±æ–‡å¯¹ç…§ |
|------|------|----------|
| æœ€å°æ–­è¨€ | ArchitectureTests ä¸­æ¯ä¸ªæµ‹è¯•ç±»å¿…é¡»åŒ…å«çš„æœ‰æ•ˆæ–­è¨€æ•°é‡ | Minimum Assertions |
| æœ‰æ•ˆæ–­è¨€ | æ–­è¨€å¿…é¡»éªŒè¯æ¶æ„çº¦æŸæˆ– ADR æ¡æ¬¾ï¼Œè€Œéç©ºæ–­è¨€æˆ–å½¢å¼åŒ–æ–­è¨€ | Effective Assertion |
| åä½œå¼Š | è‡ªåŠ¨æ£€æµ‹ç©ºæ–­è¨€ã€å¼±æ–­è¨€æˆ–è·³è¿‡é€»è¾‘ï¼Œç¡®ä¿æµ‹è¯•æœ‰æ•ˆæ€§ | Anti-Cheating |
| ADR é•œåƒ | æµ‹è¯•ç»“æ„ä¸ ADR æ¡ç›®ä¸€ä¸€å¯¹åº” | ADR Mirror |

---

## Decisionï¼ˆè£å†³ï¼‰

> âš ï¸ **æœ¬èŠ‚æ˜¯å”¯ä¸€è£å†³æ¥æºã€‚**

### ADR-904.1:L1 æ¯ä¸ª ArchitectureTest ç±»å¿…é¡»è‡³å°‘åŒ…å« 1 ä¸ªæœ‰æ•ˆæ–­è¨€

**è§„åˆ™**ï¼š
- æ¯ä¸ªæµ‹è¯•ç±»å¿…é¡»è‡³å°‘åŒ…å« **ä¸€ä¸ªæœ‰æ•ˆæ–­è¨€**ï¼ŒéªŒè¯å…·ä½“ ADR æ¡ç›®
- ç¦æ­¢ç©ºæµ‹è¯•ç±»ã€æ—  Assertã€Try/Catch åå¼‚å¸¸å½¢å¼

**ç¤ºä¾‹**ï¼š
```csharp
[Fact]
public void HandlerMustNotCatchException()
{
    var handlerType = typeof(CreateOrderHandler);
    Assert.False(handlerType.GetMethods()
        .Any(m => m.CatchAllExceptions()), "ADR-240.1: Handlers must not catch exceptions");
}
````

**ç¦æ­¢**ï¼š
- ç©ºæµ‹è¯•ç±»
- `Assert.True(true)` / `Assert.Pass()`
- `try { ... } catch {}` åå¼‚å¸¸

---

### ADR-904.2:L1 æ¯ä¸ªæµ‹è¯•æ–¹æ³•å¿…é¡»æ˜ å°„å•ä¸ª ADR å­è§„åˆ™

**è§„åˆ™**ï¼š
- ä¸€ä¸ªæµ‹è¯•æ–¹æ³• **åªèƒ½æ˜ å°„ä¸€ä¸ª ADR å­è§„åˆ™**
- ç¦æ­¢åœ¨åŒä¸€æ–¹æ³•ä¸­è¦†ç›–å¤šä¸ª ADR æ¡ç›®

**ç¤ºä¾‹**ï¼š
```csharp
ADR_240_1_HandlerMustNotCatchExceptionTests.Handle_ValidCommand_DoesNotCatchExceptions
```

---

### ADR-904.3:L2 æµ‹è¯•æ–­è¨€å¿…é¡»è¯­ä¹‰æ¸…æ™°å¯åå‘æº¯æº

**è§„åˆ™**ï¼š
- æ‰€æœ‰æ–­è¨€å¤±è´¥ä¿¡æ¯å¿…é¡»åŒ…å« ADR ç¼–å·ä¸è§„åˆ™æè¿°
- CI æ—¥å¿—å¿…é¡»å¯ä»¥ç›´æ¥å®šä½åˆ° ADR æ¡ç›®

**ç¤ºä¾‹**ï¼š

```csharp
.Should().BeTrue("è¿å ADR-240.1ï¼šHandler ä¸å…è®¸æ•è·å¼‚å¸¸");
```

**ç›®çš„**ï¼š
- å¤±è´¥å³è£å†³ï¼Œæ— éœ€äººå·¥è§£é‡Š
- æ”¯æŒç ´ä¾‹æœºåˆ¶å’Œå¿è¿˜è®¡åˆ’

---

### ADR-904.4:L2 ç¦æ­¢å¼±æ–­è¨€æˆ–å½¢å¼åŒ–æ–­è¨€

**è§„åˆ™**ï¼š
- ç¦æ­¢ä»…éªŒè¯ `true/false` æˆ–ç±»å‹å­˜åœ¨
- å¿…é¡»éªŒè¯ç»“æ„ã€ä¾èµ–å…³ç³»ã€çº¦æŸå†…å®¹

**ç¤ºä¾‹**ï¼š
- âœ… éªŒè¯ Handler æ˜¯å¦ä¸ºæ— çŠ¶æ€
- âœ… éªŒè¯äº‹ä»¶å¤„ç†é“¾æ˜¯å¦ç¬¦åˆ ADR-210.x
- âŒ ä»…å†™ `Assert.True(true)` æˆ– `Assert.NotNull(someObject)`

---

## Enforcementï¼ˆæ‰§æ³•æ¨¡å‹ï¼‰

|è§„åˆ™ç¼–å·|æ‰§è¡Œçº§|æ‰§æ³•æ–¹å¼|
|---|---|---|
|ADR-904.1|L1|CI è‡ªåŠ¨æ‰«ææµ‹è¯•ç±»æ–­è¨€æ•°é‡|
|ADR-904.2|L1|æµ‹è¯•æ–¹æ³•å‘½åæ˜ å°„ ADR å­è§„åˆ™|
|ADR-904.3|L2|æ–­è¨€æ¶ˆæ¯å†…å®¹æ‰«æ + Code Review|
|ADR-904.4|L2|å¼±æ–­è¨€æ£€æµ‹ + åŠè‡ªåŠ¨è¯­ä¹‰å®¡æŸ¥|

**æ‰§è¡Œæ—¶æœº**ï¼š
- CI é˜¶æ®µè‡ªåŠ¨é˜»æ–­ç©ºæˆ–å¼±æ–­è¨€
- Code Review å‘ç°è¯­ä¹‰ä¸æ¸…æ–­è¨€
- å®¡è®¡é˜¶æ®µç¡®ä¿ ADR æµ‹è¯•è¦†ç›–å®Œæ•´æ€§

---

## Non-Goalsï¼ˆæ˜ç¡®ä¸ç®¡ä»€ä¹ˆï¼‰

æœ¬ ADR æ˜ç¡®ä¸æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š

- **å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•çš„ç¼–å†™è§„èŒƒ**ï¼šä¸æ¶‰åŠä¸šåŠ¡é€»è¾‘æµ‹è¯•çš„å…·ä½“å®ç°æ–¹å¼å’Œæµ‹è¯•æ–¹æ³•è®º
- **æµ‹è¯•æ¡†æ¶çš„å…·ä½“APIä½¿ç”¨**ï¼šä¸è§„å®šå¦‚ä½•ä½¿ç”¨xUnitã€NUnitç­‰æ¡†æ¶çš„å…·ä½“API
- **æµ‹è¯•è¦†ç›–ç‡æŒ‡æ ‡**ï¼šä¸è®¾å®šä»£ç è¦†ç›–ç‡ã€åˆ†æ”¯è¦†ç›–ç‡ç­‰å…·ä½“æ•°å€¼ç›®æ ‡
- **æµ‹è¯•æ•°æ®ç”Ÿæˆç­–ç•¥**ï¼šä¸æ¶‰åŠæµ‹è¯•æ•°æ®çš„åˆ›å»ºã€Mockå¯¹è±¡çš„ä½¿ç”¨ç­‰å…·ä½“æŠ€æœ¯
- **æµ‹è¯•è¿è¡Œæ€§èƒ½ä¼˜åŒ–**ï¼šä¸æ¶‰åŠæµ‹è¯•å¹¶è¡ŒåŒ–ã€æµ‹è¯•ç¼“å­˜ç­‰æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ
- **æµ‹è¯•æŠ¥å‘Šçš„æ ¼å¼**ï¼šä¸è§„å®šæµ‹è¯•ç»“æœæŠ¥å‘Šçš„è§†è§‰å‘ˆç°å’Œè¾“å‡ºæ ¼å¼
- **æµ‹è¯•ç”¨ä¾‹çš„å‘½åè§„èŒƒ**ï¼šä¸çº¦æŸæµ‹è¯•æ–¹æ³•ã€æµ‹è¯•ç±»çš„å…·ä½“å‘½åé£æ ¼
- **æµ‹è¯•ä»£ç çš„ç»„ç»‡ç»“æ„**ï¼šä¸æ¶‰åŠæµ‹è¯•é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡æ–¹å¼

---

## Prohibitedï¼ˆç¦æ­¢è¡Œä¸ºï¼‰

- ç©ºæµ‹è¯•ç±»æˆ–ç©ºæ–¹æ³•
- å¼±æ–­è¨€ï¼ˆå¦‚ `Assert.True(true)`ï¼‰
- å•æ–¹æ³•è¦†ç›–å¤šä¸ª ADR
- æ–­è¨€ä¿¡æ¯ä¸åŒ…å« ADR ç¼–å·
- å¼ƒç”¨æˆ–åˆ é™¤çš„ ADR æµ‹è¯•æœªåŒæ­¥å¤„ç†

---

## Relationshipsï¼ˆå…³ç³»å£°æ˜ï¼‰

> ğŸ›ï¸ **å½’æ¡£æ–‡æ¡£å£°æ˜**ï¼š
> æœ¬èŠ‚ä»…ä¿ç•™å†å²è¿½æº¯æ‰€éœ€çš„æœ€å°å…³ç³»é›†ã€‚æ‰€æœ‰æ‰§æ³•ã€æµ‹è¯•ã€CI æ˜ å°„å…³ç³»å‡å·²å¤±æ•ˆã€‚

**è¢«æ›¿ä»£ï¼ˆSuperseded Byï¼‰**ï¼š

- [ADR-907ï¼šArchitectureTests æ‰§æ³•æ²»ç†ä½“ç³»](../../governance/ADR-907-architecture-tests-enforcement-governance.md)

**å†å²ä¾èµ–ï¼ˆHistorical Contextï¼‰**ï¼š

- [ADR-903ï¼šArchitectureTests å‘½åä¸ç»„ç»‡è§„èŒƒ](./ADR-903-architecture-tests-naming-organization.MD)
- [ADR-0000ï¼šæ¶æ„æµ‹è¯•ä¸ CI æ²»ç†å®ªæ³•](../../governance/ADR-0000-architecture-tests.md)
- [ADR-122ï¼šæµ‹è¯•ä»£ç ç»„ç»‡ä¸å‘½åè§„èŒƒ](../../structure/ADR-122-test-organization-naming.md)

---

## Referencesï¼ˆéè£å†³æ€§å‚è€ƒï¼‰

- NetArchTest.Rules
- xUnit / NUnit æ¶æ„æµ‹è¯•å®è·µ
- FluentAssertions æ–­è¨€è¯­ä¹‰è§„èŒƒ

---

## Historyï¼ˆç‰ˆæœ¬å†å²ï¼‰

|ç‰ˆæœ¬|æ—¥æœŸ|è¯´æ˜|ä¿®è®¢äºº|
|---|---|---|---|
|1.0|2026-01-28|åˆå§‹æ­£å¼ç‰ˆæœ¬|Architecture Board|
