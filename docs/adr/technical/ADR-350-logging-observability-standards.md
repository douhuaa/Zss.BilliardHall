---
adr: ADR-350
title: "æ—¥å¿—ä¸å¯è§‚æµ‹æ€§å­—æ®µæ ‡å‡†"
status: Final
level: Technical
version: "3.0"
deciders: "Architecture Board"
date: 2026-02-03
maintainer: "Architecture Board"
primary_enforcement: L1
reviewer: "GitHub Copilot"
supersedes: null
superseded_by: null
---


# ADR-350ï¼šæ—¥å¿—ä¸å¯è§‚æµ‹æ€§å­—æ®µæ ‡å‡†

**å½±å“èŒƒå›´**ï¼šæ‰€æœ‰æ—¥å¿—è¾“å‡ºã€ç»“æ„åŒ–æ—¥å¿—å­—æ®µ  
## Focusï¼ˆèšç„¦å†…å®¹ï¼‰

- æ—¥å¿—å­—æ®µå‘½åè§„èŒƒä¸ä¸€è‡´æ€§çº¦æŸ
- æ•æ„Ÿä¿¡æ¯æ—¥å¿—ä¿æŠ¤è§„åˆ™
- é”™è¯¯æ—¥å¿—å¿…éœ€å­—æ®µè¦æ±‚
- æ—¥å¿—çº§åˆ«ä½¿ç”¨æ ‡å‡†å®šä¹‰
- CorrelationId ä¼ æ’­çº¦æŸ

---

---

## Glossaryï¼ˆæœ¯è¯­è¡¨ï¼‰


| æœ¯è¯­ | å®šä¹‰ | è‹±æ–‡å¯¹ç…§ |
|------|------|----------|
| å¾…è¡¥å…… | å¾…è¡¥å…… | TBD |


---

---

## Decisionï¼ˆè£å†³ï¼‰

> âš ï¸ **æœ¬èŠ‚ä¸ºå”¯ä¸€è£å†³æ¥æºï¼Œæ‰€æœ‰æ¡æ¬¾å…·å¤‡æ‰§è¡Œçº§åˆ«ã€‚**

### ADR-350_1ï¼šè¯·æ±‚æ—¥å¿—æ ‡å‡†ï¼ˆRuleï¼‰

#### ADR-350_1_1ï¼šè¯·æ±‚æ—¥å¿—å¿…é¡»åŒ…å« CorrelationIdã€å¿…é¡»æ¶æ„æµ‹è¯•è¦†ç›–ã€‘

æ‰€æœ‰ä¸è¯·æ±‚ç›¸å…³çš„æ—¥å¿—**å¿…é¡»**åŒ…å« `CorrelationId` å­—æ®µã€‚

**è§„åˆ™**ï¼š
- æ¯ä¸ªè¯·æ±‚**å¿…é¡»**ç”Ÿæˆå”¯ä¸€ CorrelationId
- CorrelationId **å¿…é¡»**åœ¨è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­ä¼ æ’­
- æ‰€æœ‰è¯·æ±‚ç›¸å…³æ—¥å¿—**å¿…é¡»**åŒ…å«æ­¤å­—æ®µ
- **ç¦æ­¢**é—æ¼ CorrelationId

**åˆ¤å®š**ï¼š
- âŒ è¯·æ±‚æ—¥å¿—ç¼ºå°‘ CorrelationId
- âœ… æ‰€æœ‰è¯·æ±‚æ—¥å¿—åŒ…å« CorrelationId

**æ¨èå®ç°**ï¼šä½¿ç”¨ Serilog Enricher å…¨å±€æ³¨å…¥ï¼Œé¿å…æ‰‹åŠ¨ä¼ é€’ã€‚

---

#### ADR-350_1_2ï¼šæ—¥å¿—å­—æ®µå¿…é¡»ä½¿ç”¨ PascalCase å‘½åã€å¿…é¡»æ¶æ„æµ‹è¯•è¦†ç›–ã€‘

ç»“æ„åŒ–æ—¥å¿—å­—æ®µå**å¿…é¡»**ä½¿ç”¨ PascalCase å‘½åè§„èŒƒã€‚

**è§„åˆ™**ï¼š
- **å¿…é¡»**ä½¿ç”¨ PascalCaseï¼ˆå¦‚ `UserId`ã€`OrderId`ï¼‰
- **ç¦æ­¢**ä½¿ç”¨ snake_caseï¼ˆå¦‚ `user_id`ï¼‰
- **ç¦æ­¢**ä½¿ç”¨å…¨å°å†™ï¼ˆå¦‚ `userid`ï¼‰
- **ç¦æ­¢**ä½¿ç”¨å…¨å¤§å†™ï¼ˆå¦‚ `USER_ID`ï¼‰

**æ ‡å‡†å­—æ®µå‘½å**ï¼š
- `CorrelationId`ã€`UserId`ã€`TraceId`ã€`SpanId`
- `ServiceName`ã€`Environment`ã€`OrderId`

**åˆ¤å®š**ï¼š
- âŒ å­—æ®µå‘½å `user_id` æˆ– `userid`
- âœ… å­—æ®µå‘½å `UserId`

---

---

### ADR-350_2ï¼šæ•æ„Ÿä¿¡æ¯ä¿æŠ¤ä¸é”™è¯¯å¤„ç†ï¼ˆRuleï¼‰

#### ADR-350_2_1ï¼šç¦æ­¢è®°å½•æ•æ„Ÿä¿¡æ¯ã€å¿…é¡»æ¶æ„æµ‹è¯•è¦†ç›–ã€‘

æ—¥å¿—**ç¦æ­¢**åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚

**è§„åˆ™**ï¼š
- **ç¦æ­¢**è®°å½•å¯†ç ã€å¯†é’¥ã€Token
- **ç¦æ­¢**è®°å½•ä¿¡ç”¨å¡å·ã€èº«ä»½è¯å·
- **ç¦æ­¢**è®°å½•å®Œæ•´ä¸ªäººéšç§ä¿¡æ¯
- **ç¦æ­¢**è®°å½•åŠ å¯†å¯†é’¥ã€API Secret

**å…è®¸è®°å½•**ï¼š
- è„±æ•åçš„ä¿¡æ¯ï¼ˆå¦‚æ‰‹æœºå· 138****1234ï¼‰
- ç”¨æˆ· IDï¼ˆé PIIï¼‰
- ä¸šåŠ¡æ ‡è¯†ç¬¦

**åˆ¤å®š**ï¼š
- âŒ æ—¥å¿—åŒ…å«æ˜æ–‡å¯†ç æˆ–å¯†é’¥
- âŒ æ—¥å¿—åŒ…å«å®Œæ•´ä¿¡ç”¨å¡å·
- âœ… æ—¥å¿—ä»…åŒ…å«è„±æ•åçš„å®‰å…¨ä¿¡æ¯

---

#### ADR-350_2_2ï¼šé”™è¯¯æ—¥å¿—å¿…é¡»åŒ…å«å¼‚å¸¸è¯¦æƒ…ã€å¿…é¡»æ¶æ„æµ‹è¯•è¦†ç›–ã€‘

é”™è¯¯çº§åˆ«çš„æ—¥å¿—**å¿…é¡»**åŒ…å«å®Œæ•´çš„å¼‚å¸¸ä¿¡æ¯ã€‚

**è§„åˆ™**ï¼š
- **å¿…é¡»**ä¼ é€’ Exception å¯¹è±¡ç»™æ—¥å¿—æ–¹æ³•
- **å¿…é¡»**åŒ…å« ExceptionTypeï¼ˆå¼‚å¸¸ç±»å‹åï¼‰
- **å¿…é¡»**åŒ…å« ExceptionMessageï¼ˆå¼‚å¸¸æ¶ˆæ¯ï¼‰
- **å¿…é¡»**åŒ…å« StackTraceï¼ˆå †æ ˆè·Ÿè¸ªï¼‰
- **å¿…é¡»**åŒ…å« InnerExceptionï¼ˆå¦‚æœ‰ï¼‰

**åˆ¤å®š**ï¼š
- âŒ `_logger.LogError("Failed to create order {OrderId}", orderId)` - ç¼ºå°‘ Exception
- âœ… `_logger.LogError(exception, "Failed to create order {OrderId}", orderId)` - åŒ…å« Exception

**æ¨èå®ç°**ï¼šä½¿ç”¨ Roslyn Analyzer ç¦æ­¢ `LogError(string)` ç­¾åã€‚

---

#### ADR-350_2_3ï¼šæ—¥å¿—çº§åˆ«ä½¿ç”¨å¿…é¡»ç¬¦åˆæ ‡å‡†ã€å¿…é¡»æ¶æ„æµ‹è¯•è¦†ç›–ã€‘

æ—¥å¿—çº§åˆ«**å¿…é¡»**æŒ‰æ ‡å‡†å®šä¹‰ä½¿ç”¨ã€‚

**è§„åˆ™**ï¼š
- **Trace**ï¼šè¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼ˆç”Ÿäº§ç¯å¢ƒç¦ç”¨ï¼‰
- **Debug**ï¼šè°ƒè¯•ä¿¡æ¯ï¼ˆç”Ÿäº§ç¯å¢ƒç¦ç”¨ï¼‰
- **Information**ï¼šä¸€èˆ¬ä¿¡æ¯ï¼ˆå¦‚è¯·æ±‚å¼€å§‹/ç»“æŸï¼‰
- **Warning**ï¼šè­¦å‘Šä½†ä¸å½±å“åŠŸèƒ½
- **Error**ï¼šé”™è¯¯å¯¼è‡´æ“ä½œå¤±è´¥
- **Critical**ï¼šä¸¥é‡é”™è¯¯å½±å“ç³»ç»Ÿè¿è¡Œ

**åˆ¤å®š**ï¼š
- âŒ ä½¿ç”¨ Information è®°å½•é”™è¯¯
- âŒ ä½¿ç”¨ Error è®°å½•æ­£å¸¸ä¸šåŠ¡æµç¨‹
- âŒ è¿‡åº¦ä½¿ç”¨ Criticalï¼ˆä»…ç”¨äºç³»ç»Ÿçº§æ•…éšœï¼‰
- âœ… çº§åˆ«ä½¿ç”¨ç¬¦åˆå®šä¹‰

---

---

## Enforcementï¼ˆæ‰§æ³•æ¨¡å‹ï¼‰

> ğŸ“‹ **Enforcement æ˜ å°„è¯´æ˜**ï¼š
> 
> ä¸‹è¡¨å±•ç¤ºäº† ADR-350 å„æ¡æ¬¾ï¼ˆClauseï¼‰çš„æ‰§æ³•æ–¹å¼åŠæ‰§è¡Œçº§åˆ«ã€‚

| è§„åˆ™ç¼–å· | æ‰§è¡Œçº§ | æ‰§æ³•æ–¹å¼ | Decision æ˜ å°„ |
|---------|--------|---------|--------------|
| **ADR-350_1_1** | L1 | ArchitectureTests éªŒè¯ CorrelationId å‚æ•° | Â§ADR-350_1_1 |
| **ADR-350_1_2** | L1 | ArchitectureTests éªŒè¯å­—æ®µå‘½åè§„èŒƒ | Â§ADR-350_1_2 |
| **ADR-350_2_1** | L2 | Code Review + æ•æ„Ÿä¿¡æ¯æ‰«æå·¥å…· | Â§ADR-350_2_1 |
| **ADR-350_2_2** | L1 | Roslyn Analyzer å¼ºåˆ¶å¼‚å¸¸å‚æ•° | Â§ADR-350_2_2 |
| **ADR-350_2_3** | L2 | Code Review æ£€æŸ¥æ—¥å¿—çº§åˆ«ä½¿ç”¨ | Â§ADR-350_2_3 |

### æ‰§è¡Œçº§åˆ«è¯´æ˜
- **L1ï¼ˆé˜»æ–­çº§ï¼‰**ï¼šè¿è§„ç›´æ¥å¯¼è‡´ CI å¤±è´¥ã€é˜»æ­¢åˆå¹¶/éƒ¨ç½²
- **L2ï¼ˆè­¦å‘Šçº§ï¼‰**ï¼šè¿è§„è®°å½•å‘Šè­¦ï¼Œéœ€äººå·¥ Code Review è£å†³
- **L3ï¼ˆäººå·¥çº§ï¼‰**ï¼šéœ€è¦æ¶æ„å¸ˆäººå·¥è£å†³

---
---

## Non-Goalsï¼ˆæ˜ç¡®ä¸ç®¡ä»€ä¹ˆï¼‰

æœ¬ ADR æ˜ç¡®ä¸æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š

- å¾…è¡¥å……

---

## Prohibitedï¼ˆç¦æ­¢è¡Œä¸ºï¼‰


ä»¥ä¸‹è¡Œä¸ºæ˜ç¡®ç¦æ­¢ï¼š

- å¾…è¡¥å……


---

---

## Relationshipsï¼ˆå…³ç³»å£°æ˜ï¼‰

**ä¾èµ–ï¼ˆDepends Onï¼‰**ï¼š
- [ADR-340ï¼šç»“æ„åŒ–æ—¥å¿—ä¸ç›‘æ§çº¦æŸ](./ADR-340-structured-logging-monitoring-constraints.md) - å¯è§‚æµ‹æ€§æ ‡å‡†åŸºäºç»“æ„åŒ–æ—¥å¿—

**è¢«ä¾èµ–ï¼ˆDepended Byï¼‰**ï¼š
- æ— 

**æ›¿ä»£ï¼ˆSupersedesï¼‰**ï¼š
- æ— 

**è¢«æ›¿ä»£ï¼ˆSuperseded Byï¼‰**ï¼š
- æ— 

**ç›¸å…³ï¼ˆRelatedï¼‰**ï¼š
- [ADR-970ï¼šè‡ªåŠ¨åŒ–å·¥å…·æ—¥å¿—é›†æˆæ ‡å‡†](../governance/ADR-970-automation-log-integration-standard.md) - è‡ªåŠ¨åŒ–å·¥å…·æ—¥å¿—ä¸åº”ç”¨æ—¥å¿—ç›¸å…³

---

---

## Referencesï¼ˆéè£å†³æ€§å‚è€ƒï¼‰

### ç›¸å…³ ADR
- ADR-340ï¼šç»“æ„åŒ–æ—¥å¿—ä¸ç›‘æ§çº¦æŸ

### æŠ€æœ¯èµ„æº
- [Structured Logging](https://messagetemplates.org/)
- [OpenTelemetry Specification](https://opentelemetry.io/docs/reference/specification/)

### å®è·µæŒ‡å¯¼
- æ—¥å¿—é…ç½®ç¤ºä¾‹å‚è§ `docs/copilot/adr-350.prompts.md`ï¼ˆå¾…åˆ›å»ºï¼‰

---

---

## Historyï¼ˆç‰ˆæœ¬å†å²ï¼‰

| ç‰ˆæœ¬  | æ—¥æœŸ         | å˜æ›´è¯´æ˜   | ä¿®è®¢äºº |
|-----|------------|--------|-------|
| 3.0 | 2026-02-03 | å¯¹é½ ADR-907 v2.0ï¼Œå¼•å…¥ Rule/Clause åŒå±‚ç¼–å·ä½“ç³» | Architecture Board |
| 2.0 | 2026-01-26 | æ›´æ–°ç‰ˆæœ¬ | Architecture Board |
| 1.0 | 2026-01-29 | åˆå§‹ç‰ˆæœ¬ | Architecture Board |
