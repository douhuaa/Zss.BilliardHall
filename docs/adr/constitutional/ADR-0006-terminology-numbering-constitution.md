# ADR-0006：术语与编号宪法

> ⚖️ **本 ADR 是所有 ADR 的元规则，定义术语语义和编号体系的唯一裁决源。**

**状态**：✅ Final（宪法层，不可随意修改）  
**级别**：架构元规则 / 宪法层  
**适用范围**：所有 ADR（0000~999）及架构治理体系  
**生效时间**：即刻  
**版本**：1.0  
**修订日期**：2026-01-25

---

## 聚焦内容（Focus）

- 架构术语的唯一权威定义（Glossary）
- ADR 编号分层规则与语义约束
- 编号格式标准与一致性要求
- 编号语义边界与禁止跨界
- 违规处理与编号迁移机制

---

## 为什么需要 ADR-0006（Why This ADR Matters）

### 问题陈述

在 ADR-0006 之前：

- ❌ 术语定义散落在各个 ADR 中，无统一裁决源
- ❌ 编号体系依赖"约定俗成"，缺乏宪法级规范
- ❌ 编号不一致时，无法判定"何为正确"
- ❌ 新增 ADR 时，编号选择缺乏明确规则
- ❌ 架构测试、CI、PR 校验缺乏统一的语义基础

### ADR-0006 的定位

ADR-0006 是：

- 📌 **编号与术语的唯一裁决源**
- 📌 **所有 ADR 的元规则（Meta-Rule）**
- 📌 **架构测试、CI、PR 校验的语义基础**
- 📌 **防止"编号混乱"和"术语歧义"的宪法级约束**

一句话定位：

> **没有 ADR-0006，编号不一致只能算"意见"，不算"违规"。**

---

## 术语表（Glossary）

本节定义本架构体系中所有核心术语的**唯一权威含义**。

### 架构组织术语

| 术语            | 定义                                                   | 英文对照              |
|---------------|------------------------------------------------------|--------------------|
| ADR           | Architecture Decision Record，架构决策记录，定义架构约束的宪法级文档      | ADR                |
| 宪法层 ADR       | ADR-0001~0009，系统根基，不可推翻，只能细化，破例需特批                  | Constitutional ADR |
| 治理层 ADR       | ADR-0000, 900~999，架构过程、测试、CI、审批、破例管理                | Governance ADR     |
| 结构层 ADR       | ADR-100~199，对宪法层结构约束的细化和补充（命名、组织、静态边界）              | Structure ADR      |
| 运行层 ADR       | ADR-200~299，对宪法层运行时约束的细化和补充（生命周期、事件、异常）             | Runtime ADR        |
| 技术层 ADR       | ADR-300~399，技术选型和实现细节，可替换升级                           | Technical ADR      |
| RFC           | Request for Comments，架构决策草案，提交前需公示和讨论                 | RFC                |
| 架构委员会         | 宪法层 ADR 唯一审批主体，需全体一致同意                                | Architecture Board |
| Tech Lead     | 技术负责人，可审批非宪法层 ADR                                     | Tech Lead          |
| 架构师           | 系统架构师，可审批非宪法层 ADR                                     | Architect          |

### 架构模式术语

| 术语               | 定义                                            | 英文对照                |
|------------------|-----------------------------------------------|---------------------|
| 模块化单体            | 单进程部署，按业务能力划分独立模块，物理分离，逻辑松耦合                  | Modular Monolith    |
| 垂直切片             | 以单个业务用例为最小代码/目录/依赖单元，横穿端到端实现                  | Vertical Slice      |
| 横向分层             | 传统 Controller/Service/Repository 抽象，本架构禁止      | Horizontal Layering |
| Use Case         | 端到端业务用例，是业务功能的最小单元                            | Use Case            |
| Handler          | 业务用例的唯一决策实现，拥有全部业务决策权                         | Handler             |
| Command          | 代表"写操作"的单一职责消息，修改系统状态                         | Command             |
| Query            | 代表"读操作"的单一职责消息，不修改系统状态                        | Query               |
| CQRS             | Command-Query Responsibility Segregation，命令-查询职责分离 | CQRS                |
| 契约（Contract）     | 只读、单向、版本化的数据 DTO，只用于模块间信息传递，不含业务决策           | Contract            |
| 领域事件             | 描述已发生的业务事实，用于模块内或模块间异步通信                      | Domain Event        |
| 集成事件             | 跨界限上下文或外部系统的事件，用于系统间集成                        | Integration Event   |
| 领域模型/领域实体        | 业务内聚的复杂类型，封装业务不变量，不允许跨模块共享                   | Domain Model/Entity |
| 聚合根              | 领域驱动设计中的聚合根，保证一致性边界                           | Aggregate Root      |
| 值对象              | 无标识的不可变对象，通过值相等性判断                            | Value Object        |

### 技术实现术语

| 术语             | 定义                                      | 英文对照               |
|----------------|-----------------------------------------|---------------------|
| Platform 层     | 技术能力专属层，提供基础设施能力，不可感知业务                 | Platform Layer      |
| Application 层  | 应用层，负责模块装配、生命周期管理                       | Application Layer   |
| Host 层         | 宿主层，负责 HTTP/gRPC 等协议适配，不包含业务逻辑           | Host Layer          |
| Modules        | 业务模块层，按业务能力划分的独立模块                      | Modules             |
| BuildingBlocks | 技术构建块，可被多个模块复用的技术组件                     | Building Blocks     |
| Endpoint       | HTTP/gRPC 等协议的入口点，仅做请求适配，不含业务逻辑         | Endpoint            |
| Repository     | 数据访问抽象，负责聚合根的持久化和加载                     | Repository          |
| CPM            | Central Package Management，中央包管理，统一管理依赖版本 | CPM                 |

### 测试与治理术语

| 术语         | 定义                                             | 英文对照                    |
|------------|------------------------------------------------|-----------------------|
| 架构测试       | 可自动执行的结构约束型测试，验证 ADR 规则                       | Architecture Test     |
| ADR-测试映射   | 【必须架构测试覆盖】的 ADR 条款到测试用例的一一映射                  | ADR-Test Mapping      |
| CI 阻断      | 测试失败即阻断 PR 合并和发布                               | CI Blocking           |
| 破例         | 已批准的临时性违规，需记录到期时间和归还计划                         | Exception             |
| 偿还         | 破例到期后，修复违规代码使其符合 ADR                           | Payback               |
| L1 测试      | 静态可执行自动化测试（如 NetArchTest）                       | Level 1 Test          |
| L2 测试      | 语义半自动化测试（如 Roslyn Analyzer、启发式检查）             | Level 2 Test          |
| L3 测试      | 人工 Gate，需要人工审查判断                               | Level 3 Test          |
| Copilot 提示词 | 为 GitHub Copilot 准备的架构辅导材料，帮助理解和应用 ADR        | Copilot Prompts       |
| 三位一体交付     | ADR 正文 + 架构测试 + Copilot 提示词，三者必须同步交付          | Trinity Delivery      |

### 命名与组织术语

| 术语         | 定义                             | 英文对照                |
|------------|--------------------------------|--------------------|
| BaseNamespace | 项目根命名空间，固定为项目名称               | Base Namespace     |
| RootNamespace | 项目实际使用的根命名空间，由目录结构自动推导       | Root Namespace     |
| UseCases 目录 | 存放垂直切片用例的标准目录                | UseCases Directory |
| 模块边界       | 模块的物理隔离边界，通过程序集和命名空间实现       | Module Boundary    |
| 依赖方向       | 依赖只能单向流动，不允许循环依赖             | Dependency Direction |
| 层级隔离       | 上层可依赖下层，下层不可依赖上层             | Layer Isolation    |

---

## ADR 编号分层规则（Numbering Hierarchy）

### 编号段定义

本架构体系采用**分段编号**，每个编号段对应一个架构层级：

| 编号范围                | 层级      | 含义            | 目录                | 权威性  | 修订难度 |
|---------------------|---------|---------------|-------------------|------|------|
| `ADR-0001~0009`     | **宪法层** | 系统根基，不可推翻约束   | `constitutional/` | 最高   | 极难   |
| `ADR-0000, 900~999` | **治理层** | 治理、流程、破例管理    | `governance/`     | 高    | 难    |
| `ADR-100~199`       | **结构层** | 静态结构细化（命名、组织） | `structure/`      | 中    | 中    |
| `ADR-200~299`       | **运行层** | 运行时行为细化（生命周期） | `runtime/`        | 中    | 中    |
| `ADR-300~399`       | **技术层** | 技术选型、可替换实现    | `technical/`      | 低    | 易    |

### 特殊编号说明

#### ADR-0000：特殊地位

- **编号**：`ADR-0000`（保持不变）
- **归属**：治理层
- **地位**：架构测试元规则，定义"如何验证所有其他 ADR"
- **原因**：体现其特殊性和历史延续性
- **规则**：虽归类治理层，但编号不调整至 900 段

#### ADR-0006：本 ADR

- **编号**：`ADR-0006`（宪法层最后一个编号）
- **归属**：宪法层
- **地位**：术语与编号的元规则
- **原因**：编号体系本身属于宪法层
- **规则**：本 ADR 定义后，0007~0009 保留作为未来宪法层扩展

### 编号空间规划

| 编号段       | 已使用                                   | 可用空间    | 状态       |
|-----------|---------------------------------------|---------|----------|
| 0001~0009 | 0001, 0002, 0003, 0004, 0005, 0006    | 0007~0009 | ✅ 规划完成  |
| 0000      | 0000（特殊）                              | -       | ✅ 已确定   |
| 100~199   | 120, 121, 122, 123, 124               | 95+     | ✅ 充足    |
| 200~299   | 201, 210, 220, 240                    | 96+     | ✅ 充足    |
| 300~399   | 301, 340, 350, 360                    | 96+     | ✅ 充足    |
| 900~999   | 0900, 930                             | 98+     | ✅ 充足    |

---

## 编号格式规则（Numbering Format）

### 基本格式

- **标准格式**：`ADR-XXXX`
- **编号类型**：十进制整数
- **前导零规则**：
  - 宪法层（0001~0009）：**使用前导零**（如 ADR-0001）
  - 其他层（100+）：**不使用前导零**（如 ADR-100，而非 ADR-0100）
- **文件命名**：`ADR-XXXX-descriptive-title.md`

### 子规则编号

当需要对 ADR 内部规则进行编号时：

- **格式**：`ADR-XXXX.Y`（如 ADR-0001.1, ADR-0001.2）
- **用途**：在测试映射、违规记录、引用时使用
- **示例**：
  - `ADR-0001.1`：模块不可相互引用
  - `ADR-0001.2`：项目文件禁止引用其他模块
  - `ADR-0005.3`：跨模块同步禁止

### 版本编号

ADR 文档本身的版本：

- **格式**：`版本 X.Y`（如版本 3.2）
- **位置**：ADR 正文顶部元数据
- **规则**：
  - 重大修订：递增主版本号（如 3.0 → 4.0）
  - 细化补充：递增次版本号（如 3.1 → 3.2）

---

## 编号语义约束（Semantic Constraints）

### 约束 1：编号即层级

- **规则**：编号段直接对应架构层级，不得跨区间表达含义
- **示例**：
  - ✅ 正确：ADR-120（结构层）定义领域事件命名规范
  - ❌ 错误：ADR-120（结构层）定义模块隔离规则（应在宪法层）

### 约束 2：治理规则禁止使用 100~399

- **规则**：治理层 ADR 必须使用 0000 或 900~999
- **原因**：100~399 用于结构/运行/技术细化，不应包含治理规则
- **示例**：
  - ✅ 正确：ADR-930（治理层）定义代码审查流程
  - ❌ 错误：ADR-350（技术层）定义代码审查流程

### 约束 3：技术规则禁止使用 900~999

- **规则**：技术层 ADR 必须使用 300~399
- **原因**：900~999 保留给治理层
- **示例**：
  - ✅ 正确：ADR-301（技术层）定义集成测试自动化
  - ❌ 错误：ADR-930（治理层）定义集成测试自动化

### 约束 4：细化层不得引入宪法级约束

- **规则**：结构层/运行层/技术层 ADR 不得：
  - ❌ 引入新的跨模块强制约束
  - ❌ 改变既有依赖方向或层级关系
  - ❌ 修改模块隔离、通信模型或执行语义
  - ❌ 成为其他 ADR 的前置假设条件
  - ❌ 以"细化"为名削弱宪法层约束
- **处理**：如需上述变更，必须升级为宪法层提案，走 ADR-0900 流程

### 约束 5：编号一经分配不可更改

- **规则**：ADR 编号一旦分配并合并，不可更改
- **例外**：仅在以下情况允许重新编号（需特批）：
  - 编号严重违反语义约束（如治理规则误用 100 段）
  - 历史遗留问题（如 ADR-0000A → ADR-0900）
- **迁移要求**：
  - 必须记录映射关系（旧编号 → 新编号）
  - 必须更新所有引用（文档、测试、Prompts）
  - 必须保留重定向或说明文档

---

## 编号语义边界示例（Boundary Examples）

### ✅ 正确的编号使用

| ADR 编号   | 层级  | 内容示例               | 判定理由           |
|----------|-----|--------------------|--------------------|
| ADR-0001 | 宪法层 | 模块隔离与垂直切片          | 系统根基，不可推翻        |
| ADR-0005 | 宪法层 | Use Case 执行模型     | 根本交互约束           |
| ADR-0000 | 治理层 | 架构测试元规则            | 特殊地位，保持 0000      |
| ADR-0900 | 治理层 | ADR 新增与修订流程        | 治理流程，使用 900 段    |
| ADR-930  | 治理层 | 代码审查与合规自检          | 治理流程，使用 900 段    |
| ADR-120  | 结构层 | 领域事件命名规范           | 细化宪法层结构约束        |
| ADR-122  | 结构层 | 测试代码组织与命名          | 细化宪法层结构约束        |
| ADR-201  | 运行层 | Handler 生命周期管理     | 细化宪法层运行时约束       |
| ADR-210  | 运行层 | 领域事件版本化与兼容性        | 细化宪法层运行时约束       |
| ADR-301  | 技术层 | 集成测试环境自动化          | 技术选型，可替换         |
| ADR-350  | 技术层 | 日志与可观测性标准          | 技术选型，可替换         |

### ❌ 错误的编号使用

| 错误示例     | 层级  | 问题              | 正确做法             |
|----------|-----|-----------------|------------------|
| ADR-150  | 结构层 | 定义模块隔离规则        | 应升级为宪法层（0001~0009） |
| ADR-250  | 运行层 | 定义 ADR 审批流程     | 应移至治理层（900~999）   |
| ADR-950  | 治理层 | 定义日志格式          | 应移至技术层（300~399）   |
| ADR-0007 | 宪法层 | 定义 Logging 选型   | 应降级为技术层（300~399）  |

---

## 违规处理（Violation Handling）

### 新增 ADR 违规

当新增 ADR 不符合编号规则时：

- **处理**：PR 必须拒绝
- **原因**：说明编号违反了哪条规则（引用 ADR-0006）
- **建议**：提供正确的编号段和理由

### 既有 ADR 违规

当发现既有 ADR 编号不合规时：

- **允许迁移**：可申请重新编号（需特批）
- **迁移要求**：
  - 必须记录映射关系（在 README 或专门文档中）
  - 必须更新所有引用
  - 必须保留重定向说明
- **不强制迁移**：历史遗留问题可暂不处理，但不能作为新 ADR 的先例

### 术语冲突

当发现术语定义与 ADR-0006 冲突时：

- **裁决**：以 ADR-0006 为准
- **处理**：修正其他 ADR 或辅导材料中的术语使用
- **升级**：如 ADR-0006 术语定义不当，走宪法层修订流程

---

## 架构测试与执行（Enforcement）

### 必须架构测试覆盖

本 ADR 的以下规则必须有架构测试覆盖：

| 规则编号       | 规则描述                | 测试方式             | 级别  |
|------------|---------------------|------------------|-----|
| ADR-0006.1 | 新增 ADR 编号必须符合分段规则   | 脚本检查 ADR 文件编号    | L1  |
| ADR-0006.2 | ADR 文件名必须与编号一致      | 脚本检查文件命名         | L1  |
| ADR-0006.3 | 治理层 ADR 不使用 100~399 | 脚本检查编号段与目录映射     | L1  |
| ADR-0006.4 | 技术层 ADR 不使用 900~999 | 脚本检查编号段与目录映射     | L1  |
| ADR-0006.5 | ADR 编号不重复           | 脚本检查编号唯一性        | L1  |
| ADR-0006.6 | 术语使用一致性             | 人工审查 + Copilot 提示 | L3  |

### 测试实现位置

- **测试类**：`src/tests/ArchitectureTests/ADR/ADR_0006_Architecture_Tests.cs`
- **辅助脚本**：`scripts/validate-adr-numbering.ps1`（未来可选）

---

## 与其他 ADR 的关系（Related ADRs）

| 相关 ADR   | 关系          | 说明                         |
|----------|-------------|----------------------------|
| ADR-0000 | 补充关系        | ADR-0000 定义架构测试机制，本 ADR 定义编号规则 |
| ADR-0900 | 依赖关系        | ADR-0900 依赖本 ADR 定义的编号规则     |
| ADR-0001~0005 | 术语提供关系 | 宪法层 ADR 定义的术语被本 ADR 汇总       |
| 所有 ADR   | 元规则关系       | 本 ADR 是所有 ADR 的元规则           |

---

## 未来扩展（Future Extensions）

### 预留编号空间

- **宪法层**：0007~0009（保留给未来核心架构扩展）
- **结构层**：100~199（充足，95+ 可用）
- **运行层**：200~299（充足，96+ 可用）
- **技术层**：300~399（充足，96+ 可用）
- **治理层**：900~999（充足，98+ 可用）

### 术语演进

当需要新增术语定义时：

- **流程**：走宪法层修订流程（ADR-0900）
- **要求**：新术语必须与现有术语无冲突
- **记录**：更新本 ADR 术语表，记录版本历史

---

## 快速检查表（Checklist）

### 新增 ADR 时

- [ ] 编号是否符合分段规则？
- [ ] 编号是否与内容层级匹配？
- [ ] 文件名是否与编号一致？
- [ ] 是否更新了对应目录的 README？
- [ ] 是否更新了主 ADR README 的索引？
- [ ] 术语使用是否与 ADR-0006 一致？

### 修订 ADR-0006 时

- [ ] 是否走宪法层修订流程（架构委员会全体同意）？
- [ ] 术语修改是否会影响现有 ADR？
- [ ] 编号规则变更是否需要迁移现有 ADR？
- [ ] 是否更新了所有相关测试？
- [ ] 是否更新了 Copilot 提示词？

---

## 版本历史（Version History）

| 版本  | 日期         | 变更说明       | 修订人            |
|-----|------------|------------|-----------------|
| 1.0 | 2026-01-25 | 初始版本，定义术语与编号宪法 | GitHub Copilot  |

---

## 附录：术语引用表（Appendix: Terminology Reference）

本附录列出各宪法层 ADR 引入的核心术语，供快速查阅：

| 术语              | 定义来源    | 在 ADR-0006 中的位置 |
|-----------------|---------|------------------|
| 模块化单体           | ADR-0001 | 架构模式术语           |
| 垂直切片            | ADR-0001 | 架构模式术语           |
| Platform/Application/Host | ADR-0002 | 技术实现术语     |
| BaseNamespace   | ADR-0003 | 命名与组织术语          |
| CPM             | ADR-0004 | 技术实现术语           |
| Use Case/Handler | ADR-0005 | 架构模式术语          |
| CQRS            | ADR-0005 | 架构模式术语           |

---

## 结语（Conclusion）

ADR-0006 是本架构体系的**最后一块宪法拼图**。

有了它：

- ✅ 编号不再是"约定俗成"，而是"宪法级规则"
- ✅ 术语不再散落各处，而是有"唯一裁决源"
- ✅ 架构测试、CI、PR 校验有了"语义基础"
- ✅ 未来新增 ADR 有了"明确规则"

没有它：

- ❌ 编号不一致只能算"意见"，不算"违规"
- ❌ 术语歧义无法裁决
- ❌ 架构治理缺乏元规则支撑

**一句话总结**：

> **ADR-0006 让编号体系从"约定"升级为"宪法"。**

---

**审批记录**：

- 提议人：GitHub Copilot
- 审批人：待架构委员会全体确认
- 公示期：2 周（宪法层标准流程）
