# ADR-0006：术语与编号宪法

> ⚖️ **本 ADR 是所有 ADR 的元规则，定义术语语义和编号体系的唯一裁决源。**

**状态**：✅ Final（裁决型ADR）  
**级别**：架构元规则 / 宪法层  
**适用范围**：所有 ADR（0000~999）及架构治理体系  
**生效时间**：即刻

---

## 聚焦内容（Focus）

- 架构术语的唯一权威定义（Glossary）
- ADR 编号分层规则与语义约束
- 编号格式标准与一致性要求
- 编号语义边界与禁止跨界
- 违规判定依据

---

## 术语表（Glossary）

本节定义本架构体系中所有核心术语的**唯一权威含义**。

### 架构组织术语

| 术语            | 定义                                                   | 英文对照              |
|---------------|------------------------------------------------------|--------------------|
| ADR           | Architecture Decision Record，架构决策记录，定义架构约束的宪法级文档      | ADR                |
| 宪法层 ADR       | ADR-0001~0009，系统根基，不可推翻，只能细化，破例需特批                  | Constitutional ADR |
| 治理层 ADR       | ADR-0000, 900~999，架构过程、测试、CI、审批、破例管理 | Governance ADR     |
| 结构层 ADR       | ADR-100~199，对宪法层结构约束的细化和补充（命名、组织、静态边界）              | Structure ADR      |
| 运行层 ADR       | ADR-200~299，对宪法层运行时约束的细化和补充（生命周期、事件、异常）             | Runtime ADR        |
| 技术层 ADR       | ADR-300~399，技术选型和实现细节，可替换升级                           | Technical ADR      |
| 架构委员会         | 宪法层 ADR 唯一审批主体，需全体一致同意                                | Architecture Board |

### 架构模式术语

| 术语               | 定义                                            | 英文对照                |
|------------------|-----------------------------------------------|---------------------|
| 模块化单体            | 单进程部署，按业务能力划分独立模块，物理分离，逻辑松耦合                  | Modular Monolith    |
| 垂直切片             | 以单个业务用例为最小代码/目录/依赖单元，横穿端到端实现                  | Vertical Slice      |
| Use Case         | 端到端业务用例，是业务功能的最小单元                            | Use Case            |
| Handler          | 业务用例的唯一决策实现，拥有全部业务决策权                         | Handler             |
| Command          | 代表"写操作"的单一职责消息，修改系统状态                         | Command             |
| Query            | 代表"读操作"的单一职责消息，不修改系统状态                        | Query               |
| CQRS             | Command-Query Responsibility Segregation，命令-查询职责分离 | CQRS                |
| 契约（Contract）     | 只读、单向、版本化的数据 DTO，只用于模块间信息传递，不含业务决策           | Contract            |
| 领域事件             | 描述已发生的业务事实，用于模块内或模块间异步通信                      | Domain Event        |
| 领域模型/领域实体        | 业务内聚的复杂类型，封装业务不变量，不允许跨模块共享                   | Domain Model/Entity |

### 技术实现术语

| 术语             | 定义                                      | 英文对照               |
|----------------|-----------------------------------------|---------------------|
| Platform 层     | 技术能力专属层，提供基础设施能力，不可感知业务                 | Platform Layer      |
| Application 层  | 应用层，负责模块装配、生命周期管理                       | Application Layer   |
| Host 层         | 宿主层，负责 HTTP/gRPC 等协议适配，不包含业务逻辑           | Host Layer          |
| Modules        | 业务模块层，按业务能力划分的独立模块                      | Modules             |
| Endpoint       | HTTP/gRPC 等协议的入口点，仅做请求适配，不含业务逻辑         | Endpoint            |
| CPM            | Central Package Management，中央包管理，统一管理依赖版本 | CPM                 |

### 测试与治理术语

| 术语         | 定义                                             | 英文对照                    |
|------------|------------------------------------------------|-----------------------|
| 架构测试       | 可自动执行的结构约束型测试，验证 ADR 规则                       | Architecture Test     |
| L1 测试      | 静态可执行自动化测试（如 NetArchTest）                       | Level 1 Test          |
| L2 测试      | 语义半自动化测试（如 Roslyn Analyzer、启发式检查）             | Level 2 Test          |
| L3 测试      | 人工 Gate，需要人工审查判断                               | Level 3 Test          |

---

## 决策（Decision）

### 编号分层规则（ADR-0006.1）

**规则**：
- 编号段直接对应架构层级：
  - `ADR-0001~0009`：宪法层，系统根基
  - `ADR-0000, 900~999`：治理层，流程管理
  - `ADR-100~199`：结构层，静态结构细化
  - `ADR-200~299`：运行层，运行时行为细化
  - `ADR-300~399`：技术层，技术选型

**判定**：
- ❌ 编号段与内容层级不匹配（如治理内容用 100~399）
- ❌ 技术选型用 900~999
- ✅ 编号段正确对应架构层级

### 编号格式规则（ADR-0006.2）

**规则**：
- 标准格式：`ADR-XXXX`
- 文件命名：`ADR-XXXX-descriptive-title.md`
- 文件名必须与 ADR 编号一致

**判定**：
- ❌ 文件名格式不符合规范（如使用下划线或驼峰命名）
- ❌ 文件名与内部 ADR 编号不一致
- ✅ 格式与编号完全符合规范

### 前导零规则（ADR-0006.3）

**规则**：
- 宪法层（0001~0009）**必须**使用前导零
- 编号格式为 `ADR-000X`（X 为 1-9）

**判定**：
- ❌ 宪法层 ADR 不使用前导零（如 ADR-1）
- ✅ 宪法层正确使用前导零（如 ADR-0001）

### 前导零禁用规则（ADR-0006.4）

**规则**：
- 非宪法层（100+）**不应**使用多余前导零
- 特殊例外：ADR-0000 和 ADR-0900 允许使用前导零

**判定**：
- ❌ 非宪法层使用多余前导零（如 ADR-0120）
- ✅ 非宪法层不使用前导零（如 ADR-120）

### 目录归属规则（ADR-0006.5）

**规则**：
- ADR 文件必须位于与其编号段对应的正确目录
- 编号段与目录映射关系：
  - 0001~0009 → constitutional/
  - 0000, 900~999 → governance/
  - 100~199 → structure/
  - 200~299 → runtime/
  - 300~399 → technical/

**判定**：
- ❌ ADR 文件位于错误目录（如 ADR-120 在 governance/）
- ✅ ADR 文件位于正确目录

### 特殊编号（ADR-0006.6）

**规则**：
- ADR-0000：治理层，架构测试元规则，保持 0000 编号不变
- ADR-0006：宪法层，术语与编号元规则
- ADR-0007~0009：预留，非经架构委员会批准不得启用

**判定**：
- ❌ 未授权使用 0007~0009
- ❌ ADR-0000 添加非元机制内容
- ✅ 特殊编号按规则使用

---

## 快速参考表

| 约束编号       | 约束描述                | 测试方式             | 测试用例                                         | 必须遵守 |
|------------|---------------------|------------------|----------------------------------------------|------|
| ADR-0006.1 | 编号段必须匹配架构层级         | L1 - 脚本检查        | All_ADR_Files_Should_Match_Numbering_Rules   | ✅    |
| ADR-0006.2 | ADR 文件名必须与编号一致      | L1 - 脚本检查        | All_ADR_Files_Should_Have_Correct_Filename_Format | ✅    |
| ADR-0006.3 | 宪法层 ADR 应使用前导零      | L1 - 脚本检查        | Constitutional_ADRs_Should_Use_Leading_Zeros | ✅    |
| ADR-0006.4 | 非宪法层 ADR 不应使用多余前导零  | L1 - 脚本检查        | Non_Constitutional_ADRs_Should_Not_Use_Leading_Zeros | ✅    |
| ADR-0006.5 | ADR 文件应位于正确的目录      | L1 - 脚本检查        | All_ADR_Files_Should_Be_In_Correct_Directory | ✅    |
| ADR-0006.6 | 术语使用一致性             | L3 - 人工审查        | Terminology_Should_Be_Consistent             | ✅    |

> **级别说明**：L1=静态自动化（脚本检查），L3=人工Gate

---

## 必测/必拦架构测试（Enforcement）

所有规则通过 `src/tests/ArchitectureTests/ADR/ADR_0006_Architecture_Tests.cs` 强制验证：

- 编号段与层级匹配检查
- 文件名与编号一致性检查
- 编号唯一性检查
- 编号格式规范检查
- 术语使用一致性审查（人工）

**有一项违规视为架构违规，CI 自动阻断。**

---

## 检查清单

- [ ] 新增 ADR 编号是否符合分段规则？
- [ ] 编号是否与内容层级匹配？
- [ ] 文件名是否与编号一致？
- [ ] 治理层 ADR 是否正确使用 0000 或 900~999？
- [ ] 技术层 ADR 是否正确使用 300~399？
- [ ] 术语使用是否与 ADR-0006 一致？
- [ ] 是否更新了相关索引文件？

---

## 依赖与相关ADR

| 关联 ADR   | 关系          | 说明                         |
|----------|-------------|----------------------------|
| ADR-0000 | 补充关系        | ADR-0000 定义架构测试机制，本 ADR 定义编号规则 |
| ADR-0900 | 依赖关系        | ADR-0900 依赖本 ADR 定义的编号规则     |
| ADR-0001~0005 | 术语提供关系 | 宪法层 ADR 定义的术语被本 ADR 汇总       |
| 所有 ADR   | 元规则关系       | 本 ADR 是所有 ADR 的元规则           |

---

## 版本历史

| 版本  | 日期         | 变更说明       |
|-----|------------|------------|
| 2.0 | 2026-01-26 | 裁决型重构，移除冗余 |
| 1.0 | 2026-01-25 | 初始版本，定义术语与编号宪法 |

---

## 附注

本文件禁止添加示例/建议/FAQ/背景说明，仅维护自动化可判定的架构红线。

非裁决性参考（详细示例、编号边界案例、术语演进历史）请查阅：
- [ADR-0006 Copilot Prompts](../../copilot/adr-0006.prompts.md)
- 工程指南（如有）
