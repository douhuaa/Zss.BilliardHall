# ADR-0008：文档编写与维护宪法

> ⚖️ **本 ADR 是所有文档的元规则，定义文档分级、边界与裁决权力的唯一裁决源。**

**状态**：✅ Final（宪法层，不可随意修改）  
**级别**：架构元规则 / 宪法层  
**适用范围**：所有文档（ADR、Instructions、Agents、Skills、README、Guide）  
**生效时间**：即刻  
**版本**：1.0  
**修订日期**：2026-01-25

---

## 聚焦内容（Focus）

- 文档分级与唯一裁决权划分
- 各类文档允许表达的内容边界
- 非 ADR 文档的强制约束
- 文档结构与格式的宪法级规范
- 文档变更治理机制
- 违规处理与执行机制

---

## 为什么需要 ADR-0008（Why This ADR Matters）

### 问题陈述

在 ADR-0008 之前：

- ❌ 文档数量与类型快速增长，缺乏统一的编写规则
- ❌ 各类文档的边界模糊，可能反向侵蚀架构宪法权威
- ❌ 非 ADR 文档可能被误用为裁决依据
- ❌ 缺乏统一的文档变更治理机制
- ❌ 文档冲突时无明确的优先级规则

### ADR-0008 的定位

ADR-0008 是：

- 📌 **文档治理的唯一裁决源**
- 📌 **防止文档成为隐性规则源的宪法级约束**
- 📌 **确保 ADR 作为唯一裁决权威的根本保障**
- 📌 **所有文档编写的元规则（Meta-Rule）**

一句话定位：

> **文档不是"知识沉淀工具"，而是治理体系的一部分。**

---

## 术语表（Glossary）

| 术语         | 定义                                              | 英文对照                      |
|------------|------------------------------------------------|---------------------------|
| 裁决力        | 在架构冲突时能作为最终判定依据的权力                             | Decision Authority        |
| 宪法级文档      | 拥有最高裁决力的文档，即 ADR                               | Constitutional Document   |
| 治理级文档      | 定义行为规范和流程的文档，如 Instructions/Agents             | Governance Document       |
| 执行级文档      | 输出事实的文档，如 Skills                                | Execution Document        |
| 说明级文档      | 无裁决力的辅助文档，如 README/Guide                        | Descriptive Document      |
| 语义扩权       | 非 ADR 文档试图定义、修改或解释架构规则                          | Semantic Privilege Escalation |
| 文档越界       | 文档在其权限边界外定义规则或做出裁决                             | Document Boundary Violation |

---

## 核心决策（Decision）

### 决策 1：文档分级（唯一裁决）

**规则本体**：

| 级别    | 类型                     | 裁决力   | 示例                     | 权限边界                    |
|-------|------------------------|-------|------------------------|-------------------------|
| 宪法级   | ADR                    | **最高** | ADR-0001 ~ ADR-0099    | 定义规则、明确约束、裁决冲突          |
| 治理级   | Instructions / Agents  | 中     | copilot-instructions.md | 定义流程、行为规范、不得覆盖 ADR     |
| 执行级   | Skills                 | 低（事实） | scan-cross-module-refs | 仅输出事实、不得解释或判断           |
| 说明级   | README / Guide         | **无**  | docs/*.md              | 仅解释使用方法、必须声明无裁决力        |

**强制规则**：

- ✅ **只有 ADR 具备裁决力**
- ✅ 其他文档**不得**定义、修改或解释 ADR 语义
- ✅ 发现冲突时，**唯一以 ADR 正文为准**
- ❌ 任何试图在非 ADR 文档中定义架构规则的行为**必须被拒绝**
- ⚠️ **任何非 ADR 文档，即使全文逐字引用 ADR，也不具备裁决力**

**关键防御**：

> 防止"我没解释，我只是引用"的语义扩权行为。
> 引用 ADR 只能作为指引读者查阅权威依据，不能赋予引用文档任何裁决权。

---

### 决策 2：文档允许表达的内容边界

#### 2.1 ADR（允许）

ADR **仅允许**表达以下内容：

- ✅ 定义规则、术语、裁决逻辑
- ✅ 明确"允许 / 禁止 / 例外"
- ✅ 定义违规处理方式
- ✅ 定义执行机制（测试、CI、人工审查）
- ✅ 定义破例条件和归还机制

**核心原则**：

> **ADR 只回答：是否允许、为什么、如何裁决**

#### 2.2 ADR（禁止）

ADR **禁止**包含以下内容：

- ❌ 示例代码的实现细节（应移至 README/Guide）
- ❌ 操作步骤、How-to 指南（应移至 Guide）
- ❌ 工具参数、命令行细节（应移至 Guide）
- ❌ 教学示例和场景说明（应移至 Prompts）
- ❌ 长背景故事和方案对比（应移至设计文档）

#### 2.3 非 ADR 文档的内容边界

| 文档类型                | 允许                         | 禁止                       |
|---------------------|----------------------------|--------------------------|
| Instructions/Agents | 解释如何应用 ADR、定义行为规范          | 定义新规则、覆盖或弱化 ADR          |
| Skills              | 输出事实（如"发现 X 引用 Y"）        | 解释 ADR、判断"合规/不合规"        |
| README/Guide        | 解释使用方法、提供操作步骤、示例代码       | 定义架构规则、裁决架构问题            |
| Prompts             | 提供场景化示例、解释 ADR 在具体场景下的应用 | 修改 ADR 语义、引入新约束          |

---

### 决策 3：非 ADR 文档的强制约束

#### 3.1 Instructions / Agents

**强制要求**：

- ✅ **必须**显式声明所服从的 ADR 编号
- ✅ **必须**在冲突时以 ADR 正文为准
- ✅ **不得**引入新的规则或术语
- ✅ **不得**覆盖或弱化 ADR

**示例声明**（强制格式）：

```markdown
## 权威依据

本文档服从以下 ADR：
- ADR-0001：模块隔离
- ADR-0005：Handler 模式

**冲突裁决**：若本文档与 ADR 正文冲突，以 ADR 正文为准。
```

#### 3.2 Skills

**强制要求**：

- ✅ **只输出事实**，不输出判断
- ✅ **不得**解释 ADR
- ✅ **不得**给出"合规 / 不合规"的最终结论
- ✅ **不得**包含"建议"或"推荐"

**输出格式示例**：

```
事实：模块 Orders 引用了模块 Members 的类型 Customer
位置：Orders/UseCases/CreateOrder/CreateOrderHandler.cs:15
```

**禁止格式**：

```
❌ 违规：模块 Orders 不应引用模块 Members
❌ 建议：使用领域事件替代
```

#### 3.3 README / Guide

**强制要求**：

- ✅ **只允许**解释"如何使用"
- ✅ **必须**在首部声明"无裁决力"
- ✅ **不得**定义规则或做出架构判断

**声明格式**（强制）：

```markdown
> ⚠️ **无裁决力声明**：本文档仅供参考，不具备架构裁决权。
> 所有架构决策以相关 ADR 正文为准。
```

---

### 决策 4：文档结构与格式规范

#### 4.1 ADR 必须包含

所有 ADR **必须**包含以下章节：

- ✅ 状态（Proposed / Adopted / Final / Superseded）
- ✅ 级别（宪法层 / 结构层 / 运行层 / 技术层 / 治理层）
- ✅ 聚焦内容（Focus）
- ✅ 术语表（Glossary）- 如有新术语
- ✅ 核心决策（Decision）
- ✅ 规则本体（Rule）
- ✅ 执法模型（Enforcement）- 如需自动化测试

#### 4.2 ADR 禁止的语言

ADR 中**禁止**使用以下模糊词汇：

- ❌ "建议"（suggest）
- ❌ "推荐"（recommend）
- ❌ "通常"（usually）
- ❌ "可能"（might）
- ❌ "尽量"（try to）
- ❌ "我认为"（I think）
- ❌ "经验上"（in my experience）

**只允许使用裁决性语言**：

- ✅ "必须"（MUST）
- ✅ "禁止"（MUST NOT）
- ✅ "应当"（SHALL）
- ✅ "不应"（SHALL NOT）
- ✅ "允许"（MAY）

**原则**：

> **ADR 中没有"建议"，只有"规则"。**

---

### 决策 5：文档变更治理

#### 5.1 变更规则

| 文档类型                | 变更要求           | 审批流程       |
|---------------------|----------------|------------|
| ADR（宪法层）            | 架构修宪，需全体一致同意   | 架构委员会全票通过  |
| ADR（其他层）            | 需架构评审          | Tech Lead  |
| Instructions/Agents | 若影响规则理解，需回溯 ADR | Tech Lead  |
| Skills              | 若改变输出语义，需评审    | Code Review |
| README/Guide        | 自由修改，但需保持声明    | Code Review |

#### 5.2 冲突裁决优先级

当文档发生冲突时，**必须**按以下优先级裁决：

```
ADR 正文 > Instructions > Agents > Skills > Prompts > README/Guide
```

**强制规则**：

- ✅ 发现冲突时，**必须**修正低优先级文档
- ✅ **不得**以"辅导材料说了"为由违反 ADR
- ✅ **不得**以"README 更新"为由绕过 ADR 流程

#### 5.3 非 ADR 文档若影响规则理解的处理

**规则**：

若 Instructions/Agents/Prompts/README 的修改可能影响对 ADR 的理解，**必须**：

1. 首先评估是否需要修改 ADR 正文
2. 若需要，先提交 ADR 修订 PR
3. ADR 修订通过后，再同步更新辅导材料
4. **禁止**仅更新辅导材料而不修订 ADR

---

### 决策 6：违规处理

#### 6.1 违规类型与处理

| 违规行为                    | 处理方式      | 示例                         |
|-------------------------|-----------|----------------------------|
| 非 ADR 文档引入规则            | PR **必须拒绝** | README 定义"模块必须使用事件通信"     |
| README 试图裁决架构问题         | 标记为违规     | README 判定"这个设计不符合架构"       |
| Skills 输出判断性结论          | Agent 阻断   | Skills 输出"违反 ADR-0001"    |
| Instructions 覆盖 ADR 语义 | PR 必须拒绝   | Instructions 弱化"禁止"为"不推荐" |
| 文档缺失"无裁决力"声明           | CI 失败      | README 未声明无裁决力             |

#### 6.2 CI 强制检查

CI **必须**检查：

- ✅ 所有非 ADR 文档是否包含权威依据或无裁决力声明
- ✅ Skills 输出是否包含判断性词汇
- ✅ README/Guide 是否使用了裁决性语言（必须、禁止等）

**检查失败 = CI 阻断**

---

## 执法模型（Enforcement）

### 测试映射

| 规则编号       | 执行级 | 测试 / 手段                                        |
|------------|-----|------------------------------------------------|
| ADR-0008.1 | L2  | CI 脚本检查非 ADR 文档是否包含裁决性语言                       |
| ADR-0008.2 | L2  | CI 脚本检查 Skills 输出是否包含判断性词汇                    |
| ADR-0008.3 | L3  | Code Review 检查文档是否越界                          |
| ADR-0008.4 | L2  | CI 脚本检查 README/Guide 是否包含"无裁决力声明"             |
| ADR-0008.5 | L3  | Architecture Review 检查 Instructions/Agents 是否引入新规则 |

### 自动化检查工具

**建议实现**（非强制）：

```bash
# 检查非 ADR 文档是否包含裁决性语言
docs-lint check-authority docs/**/*.md

# 检查 Skills 输出是否包含判断性词汇
skills-lint check-judgment src/skills/**/*.md

# 检查文档是否包含必需声明
docs-lint check-declaration docs/**/*.md
```

---

## 破例与归还（Exception）

### 允许破例的前提

文档规则的破例**仅在以下情况允许**：

- 临时性 RFC 草案（需在标题标注 `[DRAFT]`）
- 历史遗留文档的迁移期
- 技术限制导致的无法自动检查

### 破例要求

每个破例**必须**：

- 记录在 `ARCH-VIOLATIONS.md` 的"文档治理破例"章节
- 指明破例的具体文档和原因
- 指定失效日期（不超过 3 个月）
- 给出归还计划

**未记录的破例 = 未授权违规。**

---

## 变更政策（Change Policy）

### 变更规则

- **宪法层 ADR（包括 ADR-0008）**
  - 修改 = 架构修宪
  - 需要架构委员会全票通过
  - 需要全量回归测试

- **非 ADR 文档**
  - 可自由修改
  - 但若影响规则理解，需回溯 ADR 修订

### 失效与替代

- Superseded ADR **必须**指向替代 ADR
- 不允许"隐性废弃"
- 废弃的 ADR 必须保留，标注 `[Superseded by ADR-XXXX]`

---

## 明确不管什么（Non-Goals）

本 ADR **不负责**：

- 文档的写作风格和美学
- 文档的版本控制策略
- 文档的国际化和本地化
- 文档工具的选择（Markdown、AsciiDoc 等）
- 文档的发布和分发机制

---

## 非裁决性参考（References）

- ADR-0000：架构测试与 CI 治理宪法
- ADR-0006：术语与编号宪法
- ADR-0007：Agent 行为与权限宪法
- ADR-0900：ADR 流程管理
- `docs/templates/adr-template.md`：ADR 编写模板
- `docs/copilot/adr-0008.prompts.md`：场景化示例

---

## 核心原则总结

> **没有裁决权的文档，只能解释；拥有裁决权的文档，只能立法。**

- 📌 ADR 是系统的法律条文，不是架构师的解释说明
- 📌 文档不是"知识沉淀工具"，而是治理体系的一部分
- 📌 防止文档成为隐性规则源，是本 ADR 的核心目标
- 📌 唯一裁决权归属 ADR 正文，无例外

---

## 版本历史

| 版本  | 日期         | 变更说明       |
|-----|------------|------------|
| 1.0 | 2026-01-25 | 初版，定义文档治理 |

---

**维护**：架构委员会  
**审核**：@douhuaa  
**状态**：✅ Final
