# 文档瘦身快速实施指南

> **目的**: 快速参考指南，用于执行文档瘦身建议
>
> **完整建议**: 详见 [文档瘦身归并建议清单.md](./文档瘦身归并建议清单.md)
>
> **版本**: 1.0.0
>
> **日期**: 2026-01-13

---

## 🚀 快速开始（1-2 天完成）

### Phase 1: P0 优先级（立即执行）

#### ✅ 任务 1: 归并架构强化总结

```bash
# 1. 重命名 v1.2.0 版本为变更历史
cd docs/03_系统架构设计/
git mv Wolverine架构蓝图v1.2.0强化总结.md Wolverine架构变更历史.md

# 2. 将 v1.1.0 内容合并到变更历史文档
# 手动编辑 Wolverine架构变更历史.md，添加 v1.1.0 章节

# 3. 删除旧文件
git rm Wolverine架构蓝图强化总结.md

# 4. 更新引用
# 搜索并替换所有对旧文件的引用
grep -r "Wolverine架构蓝图强化总结" docs/
```

**预期成果**: -1 文件, -359 行

---

#### ✅ 任务 2: 删除空占位符

```bash
# 删除空的分层约束文件
cd docs/06_开发规范/
git rm 分层约束.md

# 更新 README.md，移除该文件的引用
# 编辑 06_开发规范/README.md，删除分层约束相关行
```

**预期成果**: -1 文件

---

#### ✅ 任务 3: 清理 Legacy 文件夹

```bash
# 创建备份分支（可选）
git checkout -b archive/docs-legacy
git tag docs-backup-legacy-$(date +%Y%m%d)

# 切回工作分支
git checkout copilot/reduce-documentation-size

# 删除整个 legacy 文件夹
cd docs/04_模块设计/
git rm -r legacy/

# 更新 README.md
# 编辑 04_模块设计/README.md，删除 legacy 相关引用
```

**预期成果**: -6 文件, -4000 行

---

#### ✅ 任务 4: 归并导航文档

**步骤 1**: 更新根 README.md

```bash
# 备份当前 README
cp README.md README.md.backup

# 将项目总览内容合并到根 README
# 手动编辑 README.md，添加以下章节：
# - 文档结构导航
# - 学习路径（新人/架构师）
# - 常见问题（FAQ）
```

**步骤 2**: 精简架构文档 README

```bash
cd docs/03_系统架构设计/

# 备份
cp README.md README.md.backup

# 精简至 50 行，只保留：
# 1. 目录结构
# 2. 核心文档链接（3-5 个）
# 3. 学习路径（简化版）
```

**步骤 3**: 删除冗余文档

```bash
# 删除项目总览文档
git rm docs/自助台球系统项目文档.md

# 删除详细导航文档
git rm docs/03_系统架构设计/文档导航.md
```

**步骤 4**: 更新所有引用

```bash
# 搜索并替换引用
grep -r "自助台球系统项目文档" docs/
grep -r "文档导航" docs/
# 手动更新所有引用到新的路径
```

**预期成果**: -2 文件, -420 行

---

### Phase 1 检查清单

完成上述任务后，执行以下检查：

```bash
# 1. 统计文件数量（应该从 110 → 100）
find docs -name "*.md" | wc -l

# 2. 检查链接有效性
# 使用 markdown-link-check 或手动点击主要链接

# 3. 验证 Git 状态
git status
git diff --stat

# 4. 预览 README
# 在 GitHub 上预览根 README.md 的效果
```

**预期结果**:
- 文件数: 110 → 100 (-9%)
- 总行数: 约 -4,780 行 (-17%)
- 所有链接有效
- README 清晰易读

---

## 📋 Phase 2: P1 优先级（1 周内完成）

### 可选任务清单

| 任务 | 文件操作 | 预期收益 | 复杂度 |
|------|---------|---------|--------|
| 5. 归并架构说明 | -2 文件 | 整合架构知识 | 高 ⚠️ |
| 6. 精简规范 README | 编辑 1 文件 | -110 行 | 低 |
| 7. 归并数据库工作流 | -2 文件 | -800 行 | 中 |

#### 建议优先执行：任务 6 + 任务 7

**原因**: 任务 5（归并架构说明）需要团队讨论，可能导致单文件过大（3500 行）

---

### ✅ 任务 6: 精简规范 README

```bash
cd docs/06_开发规范/

# 精简 README.md 到 30 行
# 只保留：
# 1. 一句话说明
# 2. 规范清单表格
# 3. 快速开始链接
```

**编辑后的结构**:

```markdown
# 开发规范

本目录包含项目开发规范和最佳实践。

## 规范清单

| 规范 | 状态 | 说明 |
|------|------|------|
| [代码风格](代码风格.md) | ✅ 完成 | C# 代码规范、命名约定 |
| [切片约束](切片约束.md) | ✅ 完成 | 垂直切片架构约束 |
| [Saga 使用指南](Saga使用指南.md) | ✅ 完成 | 跨模块长事务编排 |
| ... | | |

## 快速开始

安装代码格式化工具：
\`\`\`bash
dotnet tool install --global dotnet-format
\`\`\`

详见各规范文档。
```

**预期成果**: -110 行

---

### ✅ 任务 7: 归并数据库工作流

**步骤 1**: 创建新文档

```bash
cd docs/05_数据库设计/

# 创建新文档
touch 数据访问最佳实践.md
```

**步骤 2**: 编辑新文档结构

```markdown
# 数据访问最佳实践

## 第一节: 选择持久化方案

### Marten vs EF Core 对比
（从两个文档中提取对比部分）

### 选择建议
- 使用 Marten: 文档数据库、事件溯源
- 使用 EF Core: 复杂关系、报表查询

---

## 第二节: Marten 开发工作流

（精简自 Marten开发工作流程.md，保留核心 400 行）

### 2.1 安装配置
### 2.2 基础 CRUD
### 2.3 查询优化
### 2.4 事件溯源
### 2.5 常见问题

---

## 第三节: EF Core 开发工作流

（精简自 EFCore开发工作流程.md，保留核心 400 行）

### 3.1 安装配置
### 3.2 迁移管理
### 3.3 查询优化
### 3.4 常见问题
```

**步骤 3**: 删除旧文档

```bash
git rm EFCore开发工作流程.md
git rm Marten开发工作流程.md
```

**步骤 4**: 更新引用

```bash
# 更新 README.md
# 更新其他引用这两个文档的地方
grep -r "EFCore开发工作流程" docs/
grep -r "Marten开发工作流程" docs/
```

**预期成果**: -2 文件, -800 行（去重后）

---

## 📊 Phase 2 检查清单

```bash
# 1. 文件数量（应该从 100 → 96）
find docs -name "*.md" | wc -l

# 2. 验证新文档质量
# - 数据访问最佳实践.md 是否完整？
# - 是否有遗漏的重要信息？

# 3. 链接检查
# 所有引用是否已更新？

# 4. 团队评审
# 让团队成员检查归并后的文档是否易用
```

---

## 🔧 工具与脚本

### 文档统计脚本

```bash
#!/bin/bash
# scripts/docs-stats.sh

echo "📊 文档统计"
echo "==========="
echo ""
echo "文件总数:"
find docs -name "*.md" | wc -l
echo ""
echo "总行数:"
find docs -name "*.md" -exec wc -l {} + | tail -1
echo ""
echo "最大文件:"
find docs -name "*.md" -exec wc -l {} + | sort -rn | head -5
echo ""
echo "目录大小:"
du -sh docs/*/ | sort -h
```

### 链接检查脚本

```bash
#!/bin/bash
# scripts/check-links.sh

echo "🔗 检查 Markdown 链接"
echo "==================="
echo ""

# 使用 markdown-link-check
# npm install -g markdown-link-check

find docs -name "*.md" | while read file; do
  echo "检查: $file"
  markdown-link-check "$file"
done
```

### 重复内容检测

```bash
#!/bin/bash
# scripts/find-duplicates.sh

echo "🔍 检测重复内容"
echo "=============="
echo ""

# 检查常见重复段落
keywords=("垂直切片" "Wolverine" "Handler" "Saga" "SSOT")

for keyword in "${keywords[@]}"; do
  echo "关键词: $keyword"
  grep -r "$keyword" docs/ --include="*.md" | wc -l
  echo ""
done
```

---

## ⚠️ 注意事项

### 删除文件前的检查清单

- [ ] 是否创建了 Git tag 备份？
- [ ] 是否有其他文档引用此文件？（搜索文件名）
- [ ] 是否有外部链接指向此文档？（GitHub Issues, PR）
- [ ] 内容是否已完整迁移到新位置？
- [ ] 团队成员是否已被告知？

### 归并文件的原则

1. **保留结构**: 使用清晰的章节划分
2. **去重内容**: 删除完全重复的段落
3. **保留差异**: 保留不同观点和用例
4. **添加导航**: 在文档开头添加目录
5. **更新元数据**: 修改文档头部的元信息

### 更新引用的技巧

```bash
# 使用 sed 批量替换
find docs -name "*.md" -exec sed -i 's|旧路径|新路径|g' {} +

# 或使用 VSCode 的全局搜索替换
# Ctrl+Shift+H → 搜索旧路径 → 替换为新路径
```

---

## 📝 执行记录模板

```markdown
## 文档瘦身执行记录

执行人: [姓名]
执行日期: [日期]

### Phase 1 执行情况

- [x] 任务 1: 归并架构强化总结
  - 完成时间: [时间]
  - 文件变化: -1
  - 备注: [备注]

- [x] 任务 2: 删除空占位符
  - 完成时间: [时间]
  - 文件变化: -1
  - 备注: [备注]

- [x] 任务 3: 清理 Legacy
  - 完成时间: [时间]
  - 文件变化: -6
  - 备注: [备注]

- [x] 任务 4: 归并导航文档
  - 完成时间: [时间]
  - 文件变化: -2
  - 备注: [备注]

### 成果统计

- 文件数: 110 → [实际数量]
- 总行数: 约 29,000 → [实际行数]
- 链接检查: [通过/失败]
- 团队反馈: [反馈摘要]

### 遇到的问题

1. [问题 1]
   - 解决方案: [方案]

2. [问题 2]
   - 解决方案: [方案]

### 下一步

- [ ] 执行 Phase 2
- [ ] 配置自动化检查
- [ ] 更新团队文档
```

---

## 🎯 成功标准

### Phase 1 完成标准

- [x] 文件数减少至 100 以下
- [x] 删除所有 Legacy 文件
- [x] 归并所有导航文档到 1 个
- [x] 所有链接有效（0 个 404）
- [x] README.md 清晰完整
- [x] 团队成员无异议

### Phase 2 完成标准

- [x] 文件数减少至 90 以下
- [x] 关键主题有唯一权威文档
- [x] 规范 README 精简至 30 行
- [x] 数据库工作流归并完成
- [x] 新文档质量评审通过

---

## 📚 参考资源

- [完整建议清单](./文档瘦身归并建议清单.md) - 详细的分析和建议
- [SSOT 原则](./文档瘦身归并建议清单.md#-单一真相源ssot原则) - 单一真相源实施指南
- [风险缓解](./文档瘦身归并建议清单.md#-风险与缓解) - 风险应对措施

---

**提示**: 执行前建议先阅读完整的建议清单，理解每个建议的背景和原因。
